function toUnsigned32bit(toConvert){return toConvert>>>0;}
function toSigned32bit(toConvert){return toConvert|0;}
let _log_level='warn';let Debug=()=>{};let Info=()=>{};let Warn=()=>{};let Error$1=()=>{};function init_logging(level){if(typeof level==='undefined'){level=_log_level;}else{_log_level=level;}
Debug=Info=Warn=Error$1=()=>{};if(typeof window.console!=="undefined"){switch(level){case 'debug':Debug=console.debug.bind(window.console);case 'info':Info=console.info.bind(window.console);case 'warn':Warn=console.warn.bind(window.console);case 'error':Error$1=console.error.bind(window.console);case 'none':break;default:throw new window.Error("invalid logging type '"+level+"'");}}}
init_logging();function decodeUTF8(utf8string,allowLatin1=false){try{return decodeURIComponent(escape(utf8string));}catch(e){if(e instanceof URIError){if(allowLatin1){return utf8string;}}
throw e;}}
function encodeUTF8(DOMString){return unescape(encodeURIComponent(DOMString));}
let isTouchDevice=('ontouchstart'in document.documentElement)||(document.ontouchstart!==undefined)||(navigator.maxTouchPoints>0)||(navigator.msMaxTouchPoints>0);window.addEventListener('touchstart',function onFirstTouch(){isTouchDevice=true;window.removeEventListener('touchstart',onFirstTouch,false);},false);let dragThreshold=10*(window.devicePixelRatio||1);let _supportsCursorURIs=false;try{const target=document.createElement('canvas');target.style.cursor='url("data:image/x-icon;base64,AAACAAEACAgAAAIAAgA4AQAAFgAAACgAAAAIAAAAEAAAAAEAIAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAA==") 2 2, default';if(target.style.cursor.indexOf("url")===0){Info("Data URI scheme cursor supported");_supportsCursorURIs=true;}else{Warn("Data URI scheme cursor not supported");}}catch(exc){Error$1("Data URI scheme cursor test exception: "+exc);}
const supportsCursorURIs=_supportsCursorURIs;let _supportsImageMetadata=false;try{new ImageData(new Uint8ClampedArray(4),1,1);_supportsImageMetadata=true;}catch(ex){}
const supportsImageMetadata=_supportsImageMetadata;let _hasScrollbarGutter=true;try{const container=document.createElement('div');container.style.visibility='hidden';container.style.overflow='scroll';document.body.appendChild(container);const child=document.createElement('div');container.appendChild(child);const scrollbarWidth=(container.offsetWidth-child.offsetWidth);container.parentNode.removeChild(container);_hasScrollbarGutter=scrollbarWidth!=0;}catch(exc){Error$1("Scrollbar test exception: "+exc);}
function isMac(){return navigator&&!!(/mac/i).exec(navigator.platform);}
function isWindows(){return navigator&&!!(/win/i).exec(navigator.platform);}
function isIOS(){return navigator&&(!!(/ipad/i).exec(navigator.platform)||!!(/iphone/i).exec(navigator.platform)||!!(/ipod/i).exec(navigator.platform));}
function isIE(){return navigator&&!!(/trident/i).exec(navigator.userAgent);}
function isEdge(){return navigator&&!!(/edge/i).exec(navigator.userAgent);}
function isFirefox(){return navigator&&!!(/firefox/i).exec(navigator.userAgent);}
class EventTargetMixin{constructor(){this._listeners=new Map();}
addEventListener(type,callback){if(!this._listeners.has(type)){this._listeners.set(type,new Set());}
this._listeners.get(type).add(callback);}
removeEventListener(type,callback){if(this._listeners.has(type)){this._listeners.get(type).delete(callback);}}
dispatchEvent(event){if(!this._listeners.has(event.type)){return true;}
this._listeners.get(event.type).forEach(callback=>callback.call(this,event));return!event.defaultPrevented;}}
var Base64={toBase64Table:'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='.split(''),base64Pad:'=',encode(data){let result='';const length=data.length;const lengthpad=(length%3);for(let i=0;i<(length-2);i+=3){result+=this.toBase64Table[data[i]>>2];result+=this.toBase64Table[((data[i]&0x03)<<4)+(data[i+1]>>4)];result+=this.toBase64Table[((data[i+1]&0x0f)<<2)+(data[i+2]>>6)];result+=this.toBase64Table[data[i+2]&0x3f];}
const j=length-lengthpad;if(lengthpad===2){result+=this.toBase64Table[data[j]>>2];result+=this.toBase64Table[((data[j]&0x03)<<4)+(data[j+1]>>4)];result+=this.toBase64Table[(data[j+1]&0x0f)<<2];result+=this.toBase64Table[64];}else if(lengthpad===1){result+=this.toBase64Table[data[j]>>2];result+=this.toBase64Table[(data[j]&0x03)<<4];result+=this.toBase64Table[64];result+=this.toBase64Table[64];}
return result;},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode(data,offset=0){let data_length=data.indexOf('=')-offset;if(data_length<0){data_length=data.length-offset;}
const result_length=(data_length>>2)*3+Math.floor((data_length%4)/1.5);const result=new Array(result_length);let leftbits=0;let leftdata=0;for(let idx=0,i=offset;i<data.length;i++){const c=this.toBinaryTable[data.charCodeAt(i)&0x7f];const padding=(data.charAt(i)===this.base64Pad);if(c===-1){Error$1("Illegal character code "+data.charCodeAt(i)+" at position "+i);continue;}
leftdata=(leftdata<<6)|c;leftbits+=6;if(leftbits>=8){leftbits-=8;if(!padding){result[idx++]=(leftdata>>leftbits)&0xff;}
leftdata&=(1<<leftbits)-1;}}
if(leftbits){const err=new Error('Corrupted base64 string');err.name='Base64-Error';throw err;}
return result;}};class Display{constructor(target){this._drawCtx=null;this._c_forceCanvas=false;this._renderQ=[];this._flushing=false;this._fb_width=0;this._fb_height=0;this._prevDrawStyle="";this._tile=null;this._tile16x16=null;this._tile_x=0;this._tile_y=0;Debug(">> Display.constructor");this._target=target;if(!this._target){throw new Error("Target must be set");}
if(typeof this._target==='string'){throw new Error('target must be a DOM element');}
if(!this._target.getContext){throw new Error("no getContext method");}
this._targetCtx=this._target.getContext('2d');this._viewportLoc={'x':0,'y':0,'w':this._target.width,'h':this._target.height};this._backbuffer=document.createElement('canvas');this._drawCtx=this._backbuffer.getContext('2d');this._damageBounds={left:0,top:0,right:this._backbuffer.width,bottom:this._backbuffer.height};Debug("User Agent: "+navigator.userAgent);if(!('createImageData'in this._drawCtx)){throw new Error("Canvas does not support createImageData");}
this._tile16x16=this._drawCtx.createImageData(16,16);Debug("<< Display.constructor");this._scale=1.0;this._clipViewport=false;this.onflush=()=>{};}
get scale(){return this._scale;}
set scale(scale){this._rescale(scale);}
get clipViewport(){return this._clipViewport;}
set clipViewport(viewport){this._clipViewport=viewport;const vp=this._viewportLoc;this.viewportChangeSize(vp.w,vp.h);this.viewportChangePos(0,0);}
get width(){return this._fb_width;}
get height(){return this._fb_height;}
viewportChangePos(deltaX,deltaY){const vp=this._viewportLoc;deltaX=Math.floor(deltaX);deltaY=Math.floor(deltaY);if(!this._clipViewport){deltaX=-vp.w;deltaY=-vp.h;}
const vx2=vp.x+vp.w-1;const vy2=vp.y+vp.h-1;if(deltaX<0&&vp.x+deltaX<0){deltaX=-vp.x;}
if(vx2+deltaX>=this._fb_width){deltaX-=vx2+deltaX-this._fb_width+1;}
if(vp.y+deltaY<0){deltaY=-vp.y;}
if(vy2+deltaY>=this._fb_height){deltaY-=(vy2+deltaY-this._fb_height+1);}
if(deltaX===0&&deltaY===0){return;}
Debug("viewportChange deltaX: "+deltaX+", deltaY: "+deltaY);vp.x+=deltaX;vp.y+=deltaY;this._damage(vp.x,vp.y,vp.w,vp.h);this.flip();}
viewportChangeSize(width,height){if(!this._clipViewport||typeof(width)==="undefined"||typeof(height)==="undefined"){Debug("Setting viewport to full display region");width=this._fb_width;height=this._fb_height;}
width=Math.floor(width);height=Math.floor(height);if(width>this._fb_width){width=this._fb_width;}
if(height>this._fb_height){height=this._fb_height;}
const vp=this._viewportLoc;if(vp.w!==width||vp.h!==height){vp.w=width;vp.h=height;const canvas=this._target;canvas.width=width;canvas.height=height;this.viewportChangePos(0,0);this._damage(vp.x,vp.y,vp.w,vp.h);this.flip();this._rescale(this._scale);}}
absX(x){if(this._scale===0){return 0;}
return x/this._scale+this._viewportLoc.x;}
absY(y){if(this._scale===0){return 0;}
return y/this._scale+this._viewportLoc.y;}
resize(width,height){this._prevDrawStyle="";this._fb_width=width;this._fb_height=height;const canvas=this._backbuffer;if(canvas.width!==width||canvas.height!==height){let saveImg=null;if(canvas.width>0&&canvas.height>0){saveImg=this._drawCtx.getImageData(0,0,canvas.width,canvas.height);}
if(canvas.width!==width){canvas.width=width;}
if(canvas.height!==height){canvas.height=height;}
if(saveImg){this._drawCtx.putImageData(saveImg,0,0);}}
const vp=this._viewportLoc;this.viewportChangeSize(vp.w,vp.h);this.viewportChangePos(0,0);}
_damage(x,y,w,h){if(x<this._damageBounds.left){this._damageBounds.left=x;}
if(y<this._damageBounds.top){this._damageBounds.top=y;}
if((x+w)>this._damageBounds.right){this._damageBounds.right=x+w;}
if((y+h)>this._damageBounds.bottom){this._damageBounds.bottom=y+h;}}
flip(from_queue){if(this._renderQ.length!==0&&!from_queue){this._renderQ_push({'type':'flip'});}else{let x=this._damageBounds.left;let y=this._damageBounds.top;let w=this._damageBounds.right-x;let h=this._damageBounds.bottom-y;let vx=x-this._viewportLoc.x;let vy=y-this._viewportLoc.y;if(vx<0){w+=vx;x-=vx;vx=0;}
if(vy<0){h+=vy;y-=vy;vy=0;}
if((vx+w)>this._viewportLoc.w){w=this._viewportLoc.w-vx;}
if((vy+h)>this._viewportLoc.h){h=this._viewportLoc.h-vy;}
if((w>0)&&(h>0)){this._targetCtx.drawImage(this._backbuffer,x,y,w,h,vx,vy,w,h);}
this._damageBounds.left=this._damageBounds.top=65535;this._damageBounds.right=this._damageBounds.bottom=0;}}
pending(){return this._renderQ.length>0;}
flush(){if(this._renderQ.length===0){this.onflush();}else{this._flushing=true;}}
fillRect(x,y,width,height,color,from_queue){if(this._renderQ.length!==0&&!from_queue){this._renderQ_push({'type':'fill','x':x,'y':y,'width':width,'height':height,'color':color});}else{this._setFillColor(color);this._drawCtx.fillRect(x,y,width,height);this._damage(x,y,width,height);}}
copyImage(old_x,old_y,new_x,new_y,w,h,from_queue){if(this._renderQ.length!==0&&!from_queue){this._renderQ_push({'type':'copy','old_x':old_x,'old_y':old_y,'x':new_x,'y':new_y,'width':w,'height':h,});}else{this._drawCtx.mozImageSmoothingEnabled=false;this._drawCtx.webkitImageSmoothingEnabled=false;this._drawCtx.msImageSmoothingEnabled=false;this._drawCtx.imageSmoothingEnabled=false;this._drawCtx.drawImage(this._backbuffer,old_x,old_y,w,h,new_x,new_y,w,h);this._damage(new_x,new_y,w,h);}}
imageRect(x,y,width,height,mime,arr){if((width===0)||(height===0)){return;}
const img=new Image();img.src="data: "+mime+";base64,"+Base64.encode(arr);this._renderQ_push({'type':'img','img':img,'x':x,'y':y,'width':width,'height':height});}
startTile(x,y,width,height,color){this._tile_x=x;this._tile_y=y;if(width===16&&height===16){this._tile=this._tile16x16;}else{this._tile=this._drawCtx.createImageData(width,height);}
const red=color[2];const green=color[1];const blue=color[0];const data=this._tile.data;for(let i=0;i<width*height*4;i+=4){data[i]=red;data[i+1]=green;data[i+2]=blue;data[i+3]=255;}}
subTile(x,y,w,h,color){const red=color[2];const green=color[1];const blue=color[0];const xend=x+w;const yend=y+h;const data=this._tile.data;const width=this._tile.width;for(let j=y;j<yend;j++){for(let i=x;i<xend;i++){const p=(i+(j*width))*4;data[p]=red;data[p+1]=green;data[p+2]=blue;data[p+3]=255;}}}
finishTile(){this._drawCtx.putImageData(this._tile,this._tile_x,this._tile_y);this._damage(this._tile_x,this._tile_y,this._tile.width,this._tile.height);}
blitImage(x,y,width,height,arr,offset,from_queue){if(this._renderQ.length!==0&&!from_queue){const new_arr=new Uint8Array(width*height*4);new_arr.set(new Uint8Array(arr.buffer,0,new_arr.length));this._renderQ_push({'type':'blit','data':new_arr,'x':x,'y':y,'width':width,'height':height,});}else{this._bgrxImageData(x,y,width,height,arr,offset);}}
blitRgbImage(x,y,width,height,arr,offset,from_queue){if(this._renderQ.length!==0&&!from_queue){const new_arr=new Uint8Array(width*height*3);new_arr.set(new Uint8Array(arr.buffer,0,new_arr.length));this._renderQ_push({'type':'blitRgb','data':new_arr,'x':x,'y':y,'width':width,'height':height,});}else{this._rgbImageData(x,y,width,height,arr,offset);}}
blitRgbxImage(x,y,width,height,arr,offset,from_queue){if(this._renderQ.length!==0&&!from_queue){const new_arr=new Uint8Array(width*height*4);new_arr.set(new Uint8Array(arr.buffer,0,new_arr.length));this._renderQ_push({'type':'blitRgbx','data':new_arr,'x':x,'y':y,'width':width,'height':height,});}else{this._rgbxImageData(x,y,width,height,arr,offset);}}
drawImage(img,x,y){this._drawCtx.drawImage(img,x,y);this._damage(x,y,img.width,img.height);}
autoscale(containerWidth,containerHeight){let scaleRatio;if(containerWidth===0||containerHeight===0){scaleRatio=0;}else{const vp=this._viewportLoc;const targetAspectRatio=containerWidth/containerHeight;const fbAspectRatio=vp.w/vp.h;if(fbAspectRatio>=targetAspectRatio){scaleRatio=containerWidth/vp.w;}else{scaleRatio=containerHeight/vp.h;}}
this._rescale(scaleRatio);}
_rescale(factor){this._scale=factor;const vp=this._viewportLoc;const width=factor*vp.w+'px';const height=factor*vp.h+'px';if((this._target.style.width!==width)||(this._target.style.height!==height)){this._target.style.width=width;this._target.style.height=height;}}
_setFillColor(color){const newStyle='rgb('+color[2]+','+color[1]+','+color[0]+')';if(newStyle!==this._prevDrawStyle){this._drawCtx.fillStyle=newStyle;this._prevDrawStyle=newStyle;}}
_rgbImageData(x,y,width,height,arr,offset){const img=this._drawCtx.createImageData(width,height);const data=img.data;for(let i=0,j=offset;i<width*height*4;i+=4,j+=3){data[i]=arr[j];data[i+1]=arr[j+1];data[i+2]=arr[j+2];data[i+3]=255;}
this._drawCtx.putImageData(img,x,y);this._damage(x,y,img.width,img.height);}
_bgrxImageData(x,y,width,height,arr,offset){const img=this._drawCtx.createImageData(width,height);const data=img.data;for(let i=0,j=offset;i<width*height*4;i+=4,j+=4){data[i]=arr[j+2];data[i+1]=arr[j+1];data[i+2]=arr[j];data[i+3]=255;}
this._drawCtx.putImageData(img,x,y);this._damage(x,y,img.width,img.height);}
_rgbxImageData(x,y,width,height,arr,offset){let img;if(supportsImageMetadata){img=new ImageData(new Uint8ClampedArray(arr.buffer,arr.byteOffset,width*height*4),width,height);}else{img=this._drawCtx.createImageData(width,height);img.data.set(new Uint8ClampedArray(arr.buffer,arr.byteOffset,width*height*4));}
this._drawCtx.putImageData(img,x,y);this._damage(x,y,img.width,img.height);}
_renderQ_push(action){this._renderQ.push(action);if(this._renderQ.length===1){this._scan_renderQ();}}
_resume_renderQ(){this.removeEventListener('load',this._noVNC_display._resume_renderQ);this._noVNC_display._scan_renderQ();}
_scan_renderQ(){let ready=true;while(ready&&this._renderQ.length>0){const a=this._renderQ[0];switch(a.type){case 'flip':this.flip(true);break;case 'copy':this.copyImage(a.old_x,a.old_y,a.x,a.y,a.width,a.height,true);break;case 'fill':this.fillRect(a.x,a.y,a.width,a.height,a.color,true);break;case 'blit':this.blitImage(a.x,a.y,a.width,a.height,a.data,0,true);break;case 'blitRgb':this.blitRgbImage(a.x,a.y,a.width,a.height,a.data,0,true);break;case 'blitRgbx':this.blitRgbxImage(a.x,a.y,a.width,a.height,a.data,0,true);break;case 'img':if(a.img.complete&&(a.img.width!==0)&&(a.img.height!==0)){if(a.img.width!==a.width||a.img.height!==a.height){Error$1("Decoded image has incorrect dimensions. Got "+
a.img.width+"x"+a.img.height+". Expected "+
a.width+"x"+a.height+".");return;}
this.drawImage(a.img,a.x,a.y);}else{a.img._noVNC_display=this;a.img.addEventListener('load',this._resume_renderQ);ready=false;}
break;}
if(ready){this._renderQ.shift();}}
if(this._renderQ.length===0&&this._flushing){this._flushing=false;this.onflush();}}}
function arraySet(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return;}
for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i];}}
var Buf8=Uint8Array;var Buf16=Uint16Array;var Buf32=Int32Array;function adler32(adler,buf,len,pos){var s1=(adler&0xffff)|0,s2=((adler>>>16)&0xffff)|0,n=0;while(len!==0){n=len>2000?2000:len;len-=n;do{s1=(s1+buf[pos++])|0;s2=(s2+s1)|0;}while(--n);s1%=65521;s2%=65521;}
return(s1|(s2<<16))|0;}
function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=((c&1)?(0xEDB88320^(c>>>1)):(c>>>1));}
table[n]=c;}
return table;}
makeTable();var BAD$1=30;var TYPE$1=12;function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var s_window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;s_window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8;}
here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=(here>>>16)&0xff;if(op===0){output[_out++]=here&0xffff;}
else if(op&16){len=here&0xffff;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8;}
len+=hold&((1<<op)-1);hold>>>=op;bits-=op;}
if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8;}
here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=(here>>>16)&0xff;if(op&16){dist=here&0xffff;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8;}}
dist+=hold&((1<<op)-1);if(dist>dmax){strm.msg='invalid distance too far back';state.mode=BAD$1;break top;}
hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg='invalid distance too far back';state.mode=BAD$1;break top;}}
from=0;from_source=s_window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=s_window[from++];}while(--op);from=_out-dist;from_source=output;}}
else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=s_window[from++];}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=s_window[from++];}while(--op);from=_out-dist;from_source=output;}}}
else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=s_window[from++];}while(--op);from=_out-dist;from_source=output;}}
while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3;}
if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++];}}}
else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3;}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++];}}}}
else if((op&64)===0){here=dcode[(here&0xffff)+(hold&((1<<op)-1))];continue dodist;}
else{strm.msg='invalid distance code';state.mode=BAD$1;break top;}
break;}}
else if((op&64)===0){here=lcode[(here&0xffff)+(hold&((1<<op)-1))];continue dolen;}
else if(op&32){state.mode=TYPE$1;break top;}
else{strm.msg='invalid literal/length code';state.mode=BAD$1;break top;}
break;}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=(_in<last?5+(last-_in):5-(_in-last));strm.avail_out=(_out<end?257+(end-_out):257-(_out-end));state.hold=hold;state.bits=bits;return;}
var MAXBITS=15;var ENOUGH_LENS$1=852;var ENOUGH_DISTS$1=592;var CODES$1=0;var LENS$1=1;var DISTS$1=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts)
{var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new Buf16(MAXBITS+1);var offs=new Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0;}
for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++;}
root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break;}}
if(root>max){root=max;}
if(max===0){table[table_index++]=(1<<24)|(64<<16)|0;table[table_index++]=(1<<24)|(64<<16)|0;opts.bits=1;return 0;}
for(min=1;min<max;min++){if(count[min]!==0){break;}}
if(root<min){root=min;}
left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1;}}
if(left>0&&(type===CODES$1||max!==1)){return-1;}
offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len];}
for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym;}}
if(type===CODES$1){base=extra=work;end=19;}else if(type===LENS$1){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256;}else{base=dbase;extra=dext;end=-1;}
huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if((type===LENS$1&&used>ENOUGH_LENS$1)||(type===DISTS$1&&used>ENOUGH_DISTS$1)){return 1;}
for(;;){here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym];}
else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]];}
else{here_op=32+64;here_val=0;}
incr=1<<(len-drop);fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=(here_bits<<24)|(here_op<<16)|here_val|0;}while(fill!==0);incr=1<<(len-1);while(huff&incr){incr>>=1;}
if(incr!==0){huff&=incr-1;huff+=incr;}else{huff=0;}
sym++;if(--count[len]===0){if(len===max){break;}
len=lens[lens_index+work[sym]];}
if(len>root&&(huff&mask)!==low){if(drop===0){drop=root;}
next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break;}
curr++;left<<=1;}
used+=1<<curr;if((type===LENS$1&&used>ENOUGH_LENS$1)||(type===DISTS$1&&used>ENOUGH_DISTS$1)){return 1;}
low=huff&mask;table[low]=(root<<24)|(curr<<16)|(next-table_index)|0;}}
if(huff!==0){table[next+huff]=((len-drop)<<24)|(64<<16)|0;}
opts.bits=root;return 0;}
var CODES=0;var LENS=1;var DISTS=2;const Z_FINISH$1=4;const Z_BLOCK$1=5;const Z_TREES=6;const Z_OK$1=0;const Z_STREAM_END$1=1;const Z_NEED_DICT=2;const Z_STREAM_ERROR$1=-2;const Z_DATA_ERROR=-3;const Z_MEM_ERROR=-4;const Z_BUF_ERROR$1=-5;const Z_DEFLATED$1=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS$1=15;var DEF_WBITS=MAX_WBITS$1;function zswap32(q){return(((q>>>24)&0xff)+
((q>>>8)&0xff00)+
((q&0xff00)<<8)+
((q&0xff)<<24));}
function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new Buf16(320);this.work=new Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0;}
function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR$1;}
state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg='';if(state.wrap){strm.adler=state.wrap&1;}
state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK$1;}
function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR$1;}
state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm);}
function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state){return Z_STREAM_ERROR$1;}
state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits;}
else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15;}}
if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR$1;}
if(state.window!==null&&state.wbits!==windowBits){state.window=null;}
state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm);}
function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR$1;}
state=new InflateState();strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK$1){strm.state=null;}
return ret;}
function inflateInit(strm){return inflateInit2(strm,DEF_WBITS);}
var virgin=true;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new Buf32(512);distfix=new Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8;}
while(sym<256){state.lens[sym++]=9;}
while(sym<280){state.lens[sym++]=7;}
while(sym<288){state.lens[sym++]=8;}
inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5;}
inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false;}
state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5;}
function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new Buf8(state.wsize);}
if(copy>=state.wsize){arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize;}
else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy;}
arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize;}
else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0;}
if(state.whave<state.wsize){state.whave+=dist;}}}
return 0;}
function inflate(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||(!strm.input&&strm.avail_in!==0)){return Z_STREAM_ERROR$1;}
state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO;}
put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK$1;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break;}
while(bits<16){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
if((state.wrap&2)&&hold===0x8b1f){state.check=0;hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;state.check=makeTable(state.check);hold=0;bits=0;state.mode=FLAGS;break;}
state.flags=0;if(state.head){state.head.done=false;}
if(!(state.wrap&1)||(((hold&0xff)<<8)+(hold>>8))%31){strm.msg='incorrect header check';state.mode=BAD;break;}
if((hold&0x0f)!==Z_DEFLATED$1){strm.msg='unknown compression method';state.mode=BAD;break;}
hold>>>=4;bits-=4;len=(hold&0x0f)+8;if(state.wbits===0){state.wbits=len;}
else if(len>state.wbits){strm.msg='invalid window size';state.mode=BAD;break;}
state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&0x200?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
state.flags=hold;if((state.flags&0xff)!==Z_DEFLATED$1){strm.msg='unknown compression method';state.mode=BAD;break;}
if(state.flags&0xe000){strm.msg='unknown header flags set';state.mode=BAD;break;}
if(state.head){state.head.text=((hold>>8)&1);}
if(state.flags&0x0200){hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;state.check=makeTable(state.check);}
hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
if(state.head){state.head.time=hold;}
if(state.flags&0x0200){hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;hbuf[2]=(hold>>>16)&0xff;hbuf[3]=(hold>>>24)&0xff;state.check=makeTable(state.check);}
hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
if(state.head){state.head.xflags=(hold&0xff);state.head.os=(hold>>8);}
if(state.flags&0x0200){hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;state.check=makeTable(state.check);}
hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&0x0400){while(bits<16){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
state.length=hold;if(state.head){state.head.extra_len=hold;}
if(state.flags&0x0200){hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;state.check=makeTable(state.check);}
hold=0;bits=0;}
else if(state.head){state.head.extra=null;}
state.mode=EXTRA;case EXTRA:if(state.flags&0x0400){copy=state.length;if(copy>have){copy=have;}
if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Array(state.head.extra_len);}
arraySet(state.head.extra,input,next,copy,len);}
if(state.flags&0x0200){state.check=makeTable(state.check);}
have-=copy;next+=copy;state.length-=copy;}
if(state.length){break inf_leave;}}
state.length=0;state.mode=NAME;case NAME:if(state.flags&0x0800){if(have===0){break inf_leave;}
copy=0;do{len=input[next+copy++];if(state.head&&len&&(state.length<65536)){state.head.name+=String.fromCharCode(len);}}while(len&&copy<have);if(state.flags&0x0200){state.check=makeTable(state.check);}
have-=copy;next+=copy;if(len){break inf_leave;}}
else if(state.head){state.head.name=null;}
state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&0x1000){if(have===0){break inf_leave;}
copy=0;do{len=input[next+copy++];if(state.head&&len&&(state.length<65536)){state.head.comment+=String.fromCharCode(len);}}while(len&&copy<have);if(state.flags&0x0200){state.check=makeTable(state.check);}
have-=copy;next+=copy;if(len){break inf_leave;}}
else if(state.head){state.head.comment=null;}
state.mode=HCRC;case HCRC:if(state.flags&0x0200){while(bits<16){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
if(hold!==(state.check&0xffff)){strm.msg='header crc mismatch';state.mode=BAD;break;}
hold=0;bits=0;}
if(state.head){state.head.hcrc=((state.flags>>9)&1);state.head.done=true;}
strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
strm.adler=state.check=zswap32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT;}
strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK$1||flush===Z_TREES){break inf_leave;}
case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break;}
while(bits<3){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
state.last=(hold&0x01);hold>>>=1;bits-=1;switch((hold&0x03)){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave;}
break;case 2:state.mode=TABLE;break;case 3:strm.msg='invalid block type';state.mode=BAD;}
hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
if((hold&0xffff)!==((hold>>>16)^0xffff)){strm.msg='invalid stored block lengths';state.mode=BAD;break;}
state.length=hold&0xffff;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave;}
case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have;}
if(copy>left){copy=left;}
if(copy===0){break inf_leave;}
arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break;}
state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
state.nlen=(hold&0x1f)+257;hold>>>=5;bits-=5;state.ndist=(hold&0x1f)+1;hold>>>=5;bits-=5;state.ncode=(hold&0x0f)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg='too many length or distance symbols';state.mode=BAD;break;}
state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
state.lens[order[state.have++]]=(hold&0x07);hold>>>=3;bits-=3;}
while(state.have<19){state.lens[order[state.have++]]=0;}
state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg='invalid code lengths set';state.mode=BAD;break;}
state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&((1<<state.lenbits)-1)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if((here_bits)<=bits){break;}
if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val;}
else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg='invalid bit length repeat';state.mode=BAD;break;}
len=state.lens[state.have-1];copy=3+(hold&0x03);hold>>>=2;bits-=2;}
else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&0x07);hold>>>=3;bits-=3;}
else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&0x7f);hold>>>=7;bits-=7;}
if(state.have+copy>state.nlen+state.ndist){strm.msg='invalid bit length repeat';state.mode=BAD;break;}
while(copy--){state.lens[state.have++]=len;}}}
if(state.mode===BAD){break;}
if(state.lens[256]===0){strm.msg='invalid code -- missing end-of-block';state.mode=BAD;break;}
state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg='invalid literal/lengths set';state.mode=BAD;break;}
state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg='invalid distances set';state.mode=BAD;break;}
state.mode=LEN_;if(flush===Z_TREES){break inf_leave;}
case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1;}
break;}
state.back=0;for(;;){here=state.lencode[hold&((1<<state.lenbits)-1)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if(here_bits<=bits){break;}
if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
if(here_op&&(here_op&0xf0)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+
((hold&((1<<(last_bits+last_op))-1))>>last_bits)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if((last_bits+here_bits)<=bits){break;}
if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
hold>>>=last_bits;bits-=last_bits;state.back+=last_bits;}
hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break;}
if(here_op&32){state.back=-1;state.mode=TYPE;break;}
if(here_op&64){strm.msg='invalid literal/length code';state.mode=BAD;break;}
state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
state.length+=hold&((1<<state.extra)-1);hold>>>=state.extra;bits-=state.extra;state.back+=state.extra;}
state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&((1<<state.distbits)-1)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if((here_bits)<=bits){break;}
if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
if((here_op&0xf0)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+
((hold&((1<<(last_bits+last_op))-1))>>last_bits)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if((last_bits+here_bits)<=bits){break;}
if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
hold>>>=last_bits;bits-=last_bits;state.back+=last_bits;}
hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg='invalid distance code';state.mode=BAD;break;}
state.offset=here_val;state.extra=(here_op)&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
state.offset+=hold&((1<<state.extra)-1);hold>>>=state.extra;bits-=state.extra;state.back+=state.extra;}
if(state.offset>state.dmax){strm.msg='invalid distance too far back';state.mode=BAD;break;}
state.mode=MATCH;case MATCH:if(left===0){break inf_leave;}
copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg='invalid distance too far back';state.mode=BAD;break;}}
if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy;}
else{from=state.wnext-copy;}
if(copy>state.length){copy=state.length;}
from_source=state.window;}
else{from_source=output;from=put-state.offset;copy=state.length;}
if(copy>left){copy=left;}
left-=copy;state.length-=copy;do{output[put++]=from_source[from++];}while(--copy);if(state.length===0){state.mode=LEN;}
break;case LIT:if(left===0){break inf_leave;}
output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave;}
have--;hold|=input[next++]<<bits;bits+=8;}
_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=(state.flags?makeTable(state.check):adler32(state.check,output,_out,put-_out));}
_out=left;if((state.flags?hold:zswap32(hold))!==state.check){strm.msg='incorrect data check';state.mode=BAD;break;}
hold=0;bits=0;}
state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave;}
have--;hold+=input[next++]<<bits;bits+=8;}
if(hold!==(state.total&0xffffffff)){strm.msg='incorrect length check';state.mode=BAD;break;}
hold=0;bits=0;}
state.mode=DONE;case DONE:ret=Z_STREAM_END$1;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR$1;}}
strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||(_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH$1))){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out));}
_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=(state.flags?makeTable(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out));}
strm.data_type=state.bits+(state.last?64:0)+
(state.mode===TYPE?128:0)+
(state.mode===LEN_||state.mode===COPY_?256:0);if(((_in===0&&_out===0)||flush===Z_FINISH$1)&&ret===Z_OK$1){ret=Z_BUF_ERROR$1;}
return ret;}
function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg='';this.state=null;this.data_type=2;this.adler=0;}
class Inflate{constructor(){this.strm=new ZStream();this.chunkSize=1024*10*10;this.strm.output=new Uint8Array(this.chunkSize);this.windowBits=5;inflateInit(this.strm,this.windowBits);}
setInput(data){if(!data){this.strm.input=null;this.strm.avail_in=0;this.strm.next_in=0;}else{this.strm.input=data;this.strm.avail_in=this.strm.input.length;this.strm.next_in=0;}}
inflate(expected){if(expected>this.chunkSize){this.chunkSize=expected;this.strm.output=new Uint8Array(this.chunkSize);}
this.strm.next_out=0;this.strm.avail_out=expected;let ret=inflate(this.strm,0);if(ret<0){throw new Error("zlib inflate failed");}
if(this.strm.next_out!=expected){throw new Error("Incomplete zlib block");}
return new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);}
reset(){inflateReset(this.strm);}}
var Z_FIXED$1=4;var Z_BINARY=0;var Z_TEXT=1;var Z_UNKNOWN$1=2;function zero$1(buf){var len=buf.length;while(--len>=0){buf[len]=0;}}
var STORED_BLOCK=0;var STATIC_TREES=1;var DYN_TREES=2;var MIN_MATCH$1=3;var MAX_MATCH$1=258;var LENGTH_CODES$1=29;var LITERALS$1=256;var L_CODES$1=LITERALS$1+1+LENGTH_CODES$1;var D_CODES$1=30;var BL_CODES$1=19;var HEAP_SIZE$1=2*L_CODES$1+1;var MAX_BITS$1=15;var Buf_size=16;var MAX_BL_BITS=7;var END_BLOCK=256;var REP_3_6=16;var REPZ_3_10=17;var REPZ_11_138=18;var extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var DIST_CODE_LEN=512;var static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);var static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);var _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);var base_length=new Array(LENGTH_CODES$1);zero$1(base_length);var base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree;this.extra_bits=extra_bits;this.extra_base=extra_base;this.elems=elems;this.max_length=max_length;this.has_stree=static_tree&&static_tree.length;}
var static_l_desc;var static_d_desc;var static_bl_desc;function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree;this.max_code=0;this.stat_desc=stat_desc;}
function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)];}
function put_short(s,w){s.pending_buf[s.pending++]=(w)&0xff;s.pending_buf[s.pending++]=(w>>>8)&0xff;}
function send_bits(s,value,length){if(s.bi_valid>(Buf_size-length)){s.bi_buf|=(value<<s.bi_valid)&0xffff;put_short(s,s.bi_buf);s.bi_buf=value>>(Buf_size-s.bi_valid);s.bi_valid+=length-Buf_size;}else{s.bi_buf|=(value<<s.bi_valid)&0xffff;s.bi_valid+=length;}}
function send_code(s,c,tree){send_bits(s,tree[c*2],tree[c*2+1]);}
function bi_reverse(code,len){var res=0;do{res|=code&1;code>>>=1;res<<=1;}while(--len>0);return res>>>1;}
function bi_flush(s){if(s.bi_valid===16){put_short(s,s.bi_buf);s.bi_buf=0;s.bi_valid=0;}else if(s.bi_valid>=8){s.pending_buf[s.pending++]=s.bi_buf&0xff;s.bi_buf>>=8;s.bi_valid-=8;}}
function gen_bitlen(s,desc)
{var tree=desc.dyn_tree;var max_code=desc.max_code;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var extra=desc.stat_desc.extra_bits;var base=desc.stat_desc.extra_base;var max_length=desc.stat_desc.max_length;var h;var n,m;var bits;var xbits;var f;var overflow=0;for(bits=0;bits<=MAX_BITS$1;bits++){s.bl_count[bits]=0;}
tree[s.heap[s.heap_max]*2+1]=0;for(h=s.heap_max+1;h<HEAP_SIZE$1;h++){n=s.heap[h];bits=tree[tree[n*2+1]*2+1]+1;if(bits>max_length){bits=max_length;overflow++;}
tree[n*2+1]=bits;if(n>max_code){continue;}
s.bl_count[bits]++;xbits=0;if(n>=base){xbits=extra[n-base];}
f=tree[n*2];s.opt_len+=f*(bits+xbits);if(has_stree){s.static_len+=f*(stree[n*2+1]+xbits);}}
if(overflow===0){return;}
do{bits=max_length-1;while(s.bl_count[bits]===0){bits--;}
s.bl_count[bits]--;s.bl_count[bits+1]+=2;s.bl_count[max_length]--;overflow-=2;}while(overflow>0);for(bits=max_length;bits!==0;bits--){n=s.bl_count[bits];while(n!==0){m=s.heap[--h];if(m>max_code){continue;}
if(tree[m*2+1]!==bits){s.opt_len+=(bits-tree[m*2+1])*tree[m*2];tree[m*2+1]=bits;}
n--;}}}
function gen_codes(tree,max_code,bl_count)
{var next_code=new Array(MAX_BITS$1+1);var code=0;var bits;var n;for(bits=1;bits<=MAX_BITS$1;bits++){next_code[bits]=code=(code+bl_count[bits-1])<<1;}
for(n=0;n<=max_code;n++){var len=tree[n*2+1];if(len===0){continue;}
tree[n*2]=bi_reverse(next_code[len]++,len);}}
function tr_static_init(){var n;var bits;var length;var code;var dist;var bl_count=new Array(MAX_BITS$1+1);length=0;for(code=0;code<LENGTH_CODES$1-1;code++){base_length[code]=length;for(n=0;n<(1<<extra_lbits[code]);n++){_length_code[length++]=code;}}
_length_code[length-1]=code;dist=0;for(code=0;code<16;code++){base_dist[code]=dist;for(n=0;n<(1<<extra_dbits[code]);n++){_dist_code[dist++]=code;}}
dist>>=7;for(;code<D_CODES$1;code++){base_dist[code]=dist<<7;for(n=0;n<(1<<(extra_dbits[code]-7));n++){_dist_code[256+dist++]=code;}}
for(bits=0;bits<=MAX_BITS$1;bits++){bl_count[bits]=0;}
n=0;while(n<=143){static_ltree[n*2+1]=8;n++;bl_count[8]++;}
while(n<=255){static_ltree[n*2+1]=9;n++;bl_count[9]++;}
while(n<=279){static_ltree[n*2+1]=7;n++;bl_count[7]++;}
while(n<=287){static_ltree[n*2+1]=8;n++;bl_count[8]++;}
gen_codes(static_ltree,L_CODES$1+1,bl_count);for(n=0;n<D_CODES$1;n++){static_dtree[n*2+1]=5;static_dtree[n*2]=bi_reverse(n,5);}
static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1);static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1);static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS);}
function init_block(s){var n;for(n=0;n<L_CODES$1;n++){s.dyn_ltree[n*2]=0;}
for(n=0;n<D_CODES$1;n++){s.dyn_dtree[n*2]=0;}
for(n=0;n<BL_CODES$1;n++){s.bl_tree[n*2]=0;}
s.dyn_ltree[END_BLOCK*2]=1;s.opt_len=s.static_len=0;s.last_lit=s.matches=0;}
function bi_windup(s)
{if(s.bi_valid>8){put_short(s,s.bi_buf);}else if(s.bi_valid>0){s.pending_buf[s.pending++]=s.bi_buf;}
s.bi_buf=0;s.bi_valid=0;}
function copy_block(s,buf,len,header)
{bi_windup(s);if(header){put_short(s,len);put_short(s,~len);}
arraySet(s.pending_buf,s.window,buf,len,s.pending);s.pending+=len;}
function smaller(tree,n,m,depth){var _n2=n*2;var _m2=m*2;return(tree[_n2]<tree[_m2]||(tree[_n2]===tree[_m2]&&depth[n]<=depth[m]));}
function pqdownheap(s,tree,k)
{var v=s.heap[k];var j=k<<1;while(j<=s.heap_len){if(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)){j++;}
if(smaller(tree,v,s.heap[j],s.depth)){break;}
s.heap[k]=s.heap[j];k=j;j<<=1;}
s.heap[k]=v;}
function compress_block(s,ltree,dtree)
{var dist;var lc;var lx=0;var code;var extra;if(s.last_lit!==0){do{dist=(s.pending_buf[s.d_buf+lx*2]<<8)|(s.pending_buf[s.d_buf+lx*2+1]);lc=s.pending_buf[s.l_buf+lx];lx++;if(dist===0){send_code(s,lc,ltree);}else{code=_length_code[lc];send_code(s,code+LITERALS$1+1,ltree);extra=extra_lbits[code];if(extra!==0){lc-=base_length[code];send_bits(s,lc,extra);}
dist--;code=d_code(dist);send_code(s,code,dtree);extra=extra_dbits[code];if(extra!==0){dist-=base_dist[code];send_bits(s,dist,extra);}}}while(lx<s.last_lit);}
send_code(s,END_BLOCK,ltree);}
function build_tree(s,desc)
{var tree=desc.dyn_tree;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var elems=desc.stat_desc.elems;var n,m;var max_code=-1;var node;s.heap_len=0;s.heap_max=HEAP_SIZE$1;for(n=0;n<elems;n++){if(tree[n*2]!==0){s.heap[++s.heap_len]=max_code=n;s.depth[n]=0;}else{tree[n*2+1]=0;}}
while(s.heap_len<2){node=s.heap[++s.heap_len]=(max_code<2?++max_code:0);tree[node*2]=1;s.depth[node]=0;s.opt_len--;if(has_stree){s.static_len-=stree[node*2+1];}}
desc.max_code=max_code;for(n=(s.heap_len>>1);n>=1;n--){pqdownheap(s,tree,n);}
node=elems;do{n=s.heap[1];s.heap[1]=s.heap[s.heap_len--];pqdownheap(s,tree,1);m=s.heap[1];s.heap[--s.heap_max]=n;s.heap[--s.heap_max]=m;tree[node*2]=tree[n*2]+tree[m*2];s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1;tree[n*2+1]=tree[m*2+1]=node;s.heap[1]=node++;pqdownheap(s,tree,1);}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1];gen_bitlen(s,desc);gen_codes(tree,max_code,s.bl_count);}
function scan_tree(s,tree,max_code)
{var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3;}
tree[(max_code+1)*2+1]=0xffff;for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue;}else if(count<min_count){s.bl_tree[curlen*2]+=count;}else if(curlen!==0){if(curlen!==prevlen){s.bl_tree[curlen*2]++;}
s.bl_tree[REP_3_6*2]++;}else if(count<=10){s.bl_tree[REPZ_3_10*2]++;}else{s.bl_tree[REPZ_11_138*2]++;}
count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3;}else if(curlen===nextlen){max_count=6;min_count=3;}else{max_count=7;min_count=4;}}}
function send_tree(s,tree,max_code)
{var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3;}
for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue;}else if(count<min_count){do{send_code(s,curlen,s.bl_tree);}while(--count!==0);}else if(curlen!==0){if(curlen!==prevlen){send_code(s,curlen,s.bl_tree);count--;}
send_code(s,REP_3_6,s.bl_tree);send_bits(s,count-3,2);}else if(count<=10){send_code(s,REPZ_3_10,s.bl_tree);send_bits(s,count-3,3);}else{send_code(s,REPZ_11_138,s.bl_tree);send_bits(s,count-11,7);}
count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3;}else if(curlen===nextlen){max_count=6;min_count=3;}else{max_count=7;min_count=4;}}}
function build_bl_tree(s){var max_blindex;scan_tree(s,s.dyn_ltree,s.l_desc.max_code);scan_tree(s,s.dyn_dtree,s.d_desc.max_code);build_tree(s,s.bl_desc);for(max_blindex=BL_CODES$1-1;max_blindex>=3;max_blindex--){if(s.bl_tree[bl_order[max_blindex]*2+1]!==0){break;}}
s.opt_len+=3*(max_blindex+1)+5+5+4;return max_blindex;}
function send_all_trees(s,lcodes,dcodes,blcodes)
{var rank;send_bits(s,lcodes-257,5);send_bits(s,dcodes-1,5);send_bits(s,blcodes-4,4);for(rank=0;rank<blcodes;rank++){send_bits(s,s.bl_tree[bl_order[rank]*2+1],3);}
send_tree(s,s.dyn_ltree,lcodes-1);send_tree(s,s.dyn_dtree,dcodes-1);}
function detect_data_type(s){var black_mask=0xf3ffc07f;var n;for(n=0;n<=31;n++,black_mask>>>=1){if((black_mask&1)&&(s.dyn_ltree[n*2]!==0)){return Z_BINARY;}}
if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0){return Z_TEXT;}
for(n=32;n<LITERALS$1;n++){if(s.dyn_ltree[n*2]!==0){return Z_TEXT;}}
return Z_BINARY;}
var static_init_done=false;function _tr_init(s)
{if(!static_init_done){tr_static_init();static_init_done=true;}
s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc);s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc);s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc);s.bi_buf=0;s.bi_valid=0;init_block(s);}
function _tr_stored_block(s,buf,stored_len,last)
{send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3);copy_block(s,buf,stored_len,true);}
function _tr_align(s){send_bits(s,STATIC_TREES<<1,3);send_code(s,END_BLOCK,static_ltree);bi_flush(s);}
function _tr_flush_block(s,buf,stored_len,last)
{var opt_lenb,static_lenb;var max_blindex=0;if(s.level>0){if(s.strm.data_type===Z_UNKNOWN$1){s.strm.data_type=detect_data_type(s);}
build_tree(s,s.l_desc);build_tree(s,s.d_desc);max_blindex=build_bl_tree(s);opt_lenb=(s.opt_len+3+7)>>>3;static_lenb=(s.static_len+3+7)>>>3;if(static_lenb<=opt_lenb){opt_lenb=static_lenb;}}else{opt_lenb=static_lenb=stored_len+5;}
if((stored_len+4<=opt_lenb)&&(buf!==-1)){_tr_stored_block(s,buf,stored_len,last);}else if(s.strategy===Z_FIXED$1||static_lenb===opt_lenb){send_bits(s,(STATIC_TREES<<1)+(last?1:0),3);compress_block(s,static_ltree,static_dtree);}else{send_bits(s,(DYN_TREES<<1)+(last?1:0),3);send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1);compress_block(s,s.dyn_ltree,s.dyn_dtree);}
init_block(s);if(last){bi_windup(s);}}
function _tr_tally(s,dist,lc)
{s.pending_buf[s.d_buf+s.last_lit*2]=(dist>>>8)&0xff;s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&0xff;s.pending_buf[s.l_buf+s.last_lit]=lc&0xff;s.last_lit++;if(dist===0){s.dyn_ltree[lc*2]++;}else{s.matches++;dist--;s.dyn_ltree[(_length_code[lc]+LITERALS$1+1)*2]++;s.dyn_dtree[d_code(dist)*2]++;}
return(s.last_lit===s.lit_bufsize-1);}
var msg={2:'need dictionary',1:'stream end',0:'','-1':'file error','-2':'stream error','-3':'data error','-4':'insufficient memory','-5':'buffer error','-6':'incompatible version'};const Z_NO_FLUSH=0;const Z_PARTIAL_FLUSH=1;const Z_FULL_FLUSH=3;const Z_FINISH=4;const Z_BLOCK=5;const Z_OK=0;const Z_STREAM_END=1;const Z_STREAM_ERROR=-2;const Z_BUF_ERROR=-5;const Z_DEFAULT_COMPRESSION=-1;const Z_FILTERED=1;const Z_HUFFMAN_ONLY=2;const Z_RLE=3;const Z_FIXED=4;const Z_DEFAULT_STRATEGY=0;const Z_UNKNOWN=2;const Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var MAX_WBITS=15;var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var MIN_MATCH=3;var MAX_MATCH=258;var MIN_LOOKAHEAD=(MAX_MATCH+MIN_MATCH+1);var PRESET_DICT=0x20;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=1;var BS_BLOCK_DONE=2;var BS_FINISH_STARTED=3;var BS_FINISH_DONE=4;var OS_CODE=0x03;function err(strm,errorCode){strm.msg=msg[errorCode];return errorCode;}
function rank(f){return((f)<<1)-((f)>4?9:0);}
function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0;}}
function flush_pending(strm){var s=strm.state;var len=s.pending;if(len>strm.avail_out){len=strm.avail_out;}
if(len===0){return;}
arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out);strm.next_out+=len;s.pending_out+=len;strm.total_out+=len;strm.avail_out-=len;s.pending-=len;if(s.pending===0){s.pending_out=0;}}
function flush_block_only(s,last){_tr_flush_block(s,(s.block_start>=0?s.block_start:-1),s.strstart-s.block_start,last);s.block_start=s.strstart;flush_pending(s.strm);}
function put_byte(s,b){s.pending_buf[s.pending++]=b;}
function putShortMSB(s,b){s.pending_buf[s.pending++]=(b>>>8)&0xff;s.pending_buf[s.pending++]=b&0xff;}
function read_buf(strm,buf,start,size){var len=strm.avail_in;if(len>size){len=size;}
if(len===0){return 0;}
strm.avail_in-=len;arraySet(buf,strm.input,strm.next_in,len,start);if(strm.state.wrap===1){strm.adler=adler32(strm.adler,buf,len,start);}
else if(strm.state.wrap===2){strm.adler=makeTable(strm.adler);}
strm.next_in+=len;strm.total_in+=len;return len;}
function longest_match(s,cur_match){var chain_length=s.max_chain_length;var scan=s.strstart;var match;var len;var best_len=s.prev_length;var nice_match=s.nice_match;var limit=(s.strstart>(s.w_size-MIN_LOOKAHEAD))?s.strstart-(s.w_size-MIN_LOOKAHEAD):0;var _win=s.window;var wmask=s.w_mask;var prev=s.prev;var strend=s.strstart+MAX_MATCH;var scan_end1=_win[scan+best_len-1];var scan_end=_win[scan+best_len];if(s.prev_length>=s.good_match){chain_length>>=2;}
if(nice_match>s.lookahead){nice_match=s.lookahead;}
do{match=cur_match;if(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1]){continue;}
scan+=2;match++;do{}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);len=MAX_MATCH-(strend-scan);scan=strend-MAX_MATCH;if(len>best_len){s.match_start=cur_match;best_len=len;if(len>=nice_match){break;}
scan_end1=_win[scan+best_len-1];scan_end=_win[scan+best_len];}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!==0);if(best_len<=s.lookahead){return best_len;}
return s.lookahead;}
function fill_window(s){var _w_size=s.w_size;var p,n,m,more,str;do{more=s.window_size-s.lookahead-s.strstart;if(s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){arraySet(s.window,s.window,_w_size,_w_size,0);s.match_start-=_w_size;s.strstart-=_w_size;s.block_start-=_w_size;n=s.hash_size;p=n;do{m=s.head[--p];s.head[p]=(m>=_w_size?m-_w_size:0);}while(--n);n=_w_size;p=n;do{m=s.prev[--p];s.prev[p]=(m>=_w_size?m-_w_size:0);}while(--n);more+=_w_size;}
if(s.strm.avail_in===0){break;}
n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more);s.lookahead+=n;if(s.lookahead+s.insert>=MIN_MATCH){str=s.strstart-s.insert;s.ins_h=s.window[str];s.ins_h=((s.ins_h<<s.hash_shift)^s.window[str+1])&s.hash_mask;while(s.insert){s.ins_h=((s.ins_h<<s.hash_shift)^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;s.insert--;if(s.lookahead+s.insert<MIN_MATCH){break;}}}}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0);}
function deflate_stored(s,flush){var max_block_size=0xffff;if(max_block_size>s.pending_buf_size-5){max_block_size=s.pending_buf_size-5;}
for(;;){if(s.lookahead<=1){fill_window(s);if(s.lookahead===0&&flush===Z_NO_FLUSH){return BS_NEED_MORE;}
if(s.lookahead===0){break;}}
s.strstart+=s.lookahead;s.lookahead=0;var max_start=s.block_start+max_block_size;if(s.strstart===0||s.strstart>=max_start){s.lookahead=s.strstart-max_start;s.strstart=max_start;flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}
if(s.strstart-s.block_start>=(s.w_size-MIN_LOOKAHEAD)){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}}
s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}
return BS_FINISH_DONE;}
if(s.strstart>s.block_start){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}
return BS_NEED_MORE;}
function deflate_fast(s,flush){var hash_head;var bflush;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE;}
if(s.lookahead===0){break;}}
hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart;}
if(hash_head!==0&&((s.strstart-hash_head)<=(s.w_size-MIN_LOOKAHEAD))){s.match_length=longest_match(s,hash_head);}
if(s.match_length>=MIN_MATCH){bflush=_tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;if(s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do{s.strstart++;s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart;}while(--s.match_length!==0);s.strstart++;}else
{s.strstart+=s.match_length;s.match_length=0;s.ins_h=s.window[s.strstart];s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+1])&s.hash_mask;}}else{bflush=_tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;}
if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}}
s.insert=((s.strstart<(MIN_MATCH-1))?s.strstart:MIN_MATCH-1);if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}
return BS_FINISH_DONE;}
if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}
return BS_BLOCK_DONE;}
function deflate_slow(s,flush){var hash_head;var bflush;var max_insert;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE;}
if(s.lookahead===0){break;}}
hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart;}
s.prev_length=s.match_length;s.prev_match=s.match_start;s.match_length=MIN_MATCH-1;if(hash_head!==0&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=(s.w_size-MIN_LOOKAHEAD)){s.match_length=longest_match(s,hash_head);if(s.match_length<=5&&(s.strategy===Z_FILTERED||(s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096))){s.match_length=MIN_MATCH-1;}}
if(s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH;bflush=_tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH);s.lookahead-=s.prev_length-1;s.prev_length-=2;do{if(++s.strstart<=max_insert){s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart;}}while(--s.prev_length!==0);s.match_available=0;s.match_length=MIN_MATCH-1;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}}else if(s.match_available){bflush=_tr_tally(s,0,s.window[s.strstart-1]);if(bflush){flush_block_only(s,false);}
s.strstart++;s.lookahead--;if(s.strm.avail_out===0){return BS_NEED_MORE;}}else{s.match_available=1;s.strstart++;s.lookahead--;}}
if(s.match_available){bflush=_tr_tally(s,0,s.window[s.strstart-1]);s.match_available=0;}
s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}
return BS_FINISH_DONE;}
if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}
return BS_BLOCK_DONE;}
function deflate_rle(s,flush){var bflush;var prev;var scan,strend;var _win=s.window;for(;;){if(s.lookahead<=MAX_MATCH){fill_window(s);if(s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH){return BS_NEED_MORE;}
if(s.lookahead===0){break;}}
s.match_length=0;if(s.lookahead>=MIN_MATCH&&s.strstart>0){scan=s.strstart-1;prev=_win[scan];if(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do{}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan);if(s.match_length>s.lookahead){s.match_length=s.lookahead;}}}
if(s.match_length>=MIN_MATCH){bflush=_tr_tally(s,1,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;s.strstart+=s.match_length;s.match_length=0;}else{bflush=_tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;}
if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}}
s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}
return BS_FINISH_DONE;}
if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}
return BS_BLOCK_DONE;}
function deflate_huff(s,flush){var bflush;for(;;){if(s.lookahead===0){fill_window(s);if(s.lookahead===0){if(flush===Z_NO_FLUSH){return BS_NEED_MORE;}
break;}}
s.match_length=0;bflush=_tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}}
s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}
return BS_FINISH_DONE;}
if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}}
return BS_BLOCK_DONE;}
function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length;this.max_lazy=max_lazy;this.nice_length=nice_length;this.max_chain=max_chain;this.func=func;}
var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(s){s.window_size=2*s.w_size;zero(s.head);s.max_lazy_match=configuration_table[s.level].max_lazy;s.good_match=configuration_table[s.level].good_length;s.nice_match=configuration_table[s.level].nice_length;s.max_chain_length=configuration_table[s.level].max_chain;s.strstart=0;s.block_start=0;s.lookahead=0;s.insert=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;s.ins_h=0;}
function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Z_DEFLATED;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new Buf16(HEAP_SIZE*2);this.dyn_dtree=new Buf16((2*D_CODES+1)*2);this.bl_tree=new Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new Buf16(MAX_BITS+1);this.heap=new Buf16(2*L_CODES+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new Buf16(2*L_CODES+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0;}
function deflateResetKeep(strm){var s;if(!strm||!strm.state){return err(strm,Z_STREAM_ERROR);}
strm.total_in=strm.total_out=0;strm.data_type=Z_UNKNOWN;s=strm.state;s.pending=0;s.pending_out=0;if(s.wrap<0){s.wrap=-s.wrap;}
s.status=(s.wrap?INIT_STATE:BUSY_STATE);strm.adler=(s.wrap===2)?0:1;s.last_flush=Z_NO_FLUSH;_tr_init(s);return Z_OK;}
function deflateReset(strm){var ret=deflateResetKeep(strm);if(ret===Z_OK){lm_init(strm.state);}
return ret;}
function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm){return Z_STREAM_ERROR;}
var wrap=1;if(level===Z_DEFAULT_COMPRESSION){level=6;}
if(windowBits<0){wrap=0;windowBits=-windowBits;}
else if(windowBits>15){wrap=2;windowBits-=16;}
if(memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED){return err(strm,Z_STREAM_ERROR);}
if(windowBits===8){windowBits=9;}
var s=new DeflateState();strm.state=s;s.strm=strm;s.wrap=wrap;s.gzhead=null;s.w_bits=windowBits;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=memLevel+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH);s.window=new Buf8(s.w_size*2);s.head=new Buf16(s.hash_size);s.prev=new Buf16(s.w_size);s.lit_bufsize=1<<(memLevel+6);s.pending_buf_size=s.lit_bufsize*4;s.pending_buf=new Buf8(s.pending_buf_size);s.d_buf=1*s.lit_bufsize;s.l_buf=(1+2)*s.lit_bufsize;s.level=level;s.strategy=strategy;s.method=method;return deflateReset(strm);}
function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY);}
function deflate(strm,flush){var old_flush,s;var beg,val;if(!strm||!strm.state||flush>Z_BLOCK||flush<0){return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR;}
s=strm.state;if(!strm.output||(!strm.input&&strm.avail_in!==0)||(s.status===FINISH_STATE&&flush!==Z_FINISH)){return err(strm,(strm.avail_out===0)?Z_BUF_ERROR:Z_STREAM_ERROR);}
s.strm=strm;old_flush=s.last_flush;s.last_flush=flush;if(s.status===INIT_STATE){if(s.wrap===2){strm.adler=0;put_byte(s,31);put_byte(s,139);put_byte(s,8);if(!s.gzhead){put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,s.level===9?2:(s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0));put_byte(s,OS_CODE);s.status=BUSY_STATE;}
else{put_byte(s,(s.gzhead.text?1:0)+
(s.gzhead.hcrc?2:0)+
(!s.gzhead.extra?0:4)+
(!s.gzhead.name?0:8)+
(!s.gzhead.comment?0:16));put_byte(s,s.gzhead.time&0xff);put_byte(s,(s.gzhead.time>>8)&0xff);put_byte(s,(s.gzhead.time>>16)&0xff);put_byte(s,(s.gzhead.time>>24)&0xff);put_byte(s,s.level===9?2:(s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0));put_byte(s,s.gzhead.os&0xff);if(s.gzhead.extra&&s.gzhead.extra.length){put_byte(s,s.gzhead.extra.length&0xff);put_byte(s,(s.gzhead.extra.length>>8)&0xff);}
if(s.gzhead.hcrc){strm.adler=makeTable(strm.adler,s.pending_buf,s.pending);}
s.gzindex=0;s.status=EXTRA_STATE;}}
else
{var header=(Z_DEFLATED+((s.w_bits-8)<<4))<<8;var level_flags=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2){level_flags=0;}else if(s.level<6){level_flags=1;}else if(s.level===6){level_flags=2;}else{level_flags=3;}
header|=(level_flags<<6);if(s.strstart!==0){header|=PRESET_DICT;}
header+=31-(header%31);s.status=BUSY_STATE;putShortMSB(s,header);if(s.strstart!==0){putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&0xffff);}
strm.adler=1;}}
if(s.status===EXTRA_STATE){if(s.gzhead.extra){beg=s.pending;while(s.gzindex<(s.gzhead.extra.length&0xffff)){if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=makeTable(strm.adler,s.pending_buf,s.pending-beg);}
flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){break;}}
put_byte(s,s.gzhead.extra[s.gzindex]&0xff);s.gzindex++;}
if(s.gzhead.hcrc&&s.pending>beg){strm.adler=makeTable(strm.adler,s.pending_buf,s.pending-beg);}
if(s.gzindex===s.gzhead.extra.length){s.gzindex=0;s.status=NAME_STATE;}}
else{s.status=NAME_STATE;}}
if(s.status===NAME_STATE){if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=makeTable(strm.adler,s.pending_buf,s.pending-beg);}
flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break;}}
if(s.gzindex<s.gzhead.name.length){val=s.gzhead.name.charCodeAt(s.gzindex++)&0xff;}else{val=0;}
put_byte(s,val);}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=makeTable(strm.adler,s.pending_buf,s.pending-beg);}
if(val===0){s.gzindex=0;s.status=COMMENT_STATE;}}
else{s.status=COMMENT_STATE;}}
if(s.status===COMMENT_STATE){if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=makeTable(strm.adler,s.pending_buf,s.pending-beg);}
flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break;}}
if(s.gzindex<s.gzhead.comment.length){val=s.gzhead.comment.charCodeAt(s.gzindex++)&0xff;}else{val=0;}
put_byte(s,val);}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=makeTable(strm.adler,s.pending_buf,s.pending-beg);}
if(val===0){s.status=HCRC_STATE;}}
else{s.status=HCRC_STATE;}}
if(s.status===HCRC_STATE){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size){flush_pending(strm);}
if(s.pending+2<=s.pending_buf_size){put_byte(s,strm.adler&0xff);put_byte(s,(strm.adler>>8)&0xff);strm.adler=0;s.status=BUSY_STATE;}}
else{s.status=BUSY_STATE;}}
if(s.pending!==0){flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK;}}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH){return err(strm,Z_BUF_ERROR);}
if(s.status===FINISH_STATE&&strm.avail_in!==0){return err(strm,Z_BUF_ERROR);}
if(strm.avail_in!==0||s.lookahead!==0||(flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE)){var bstate=(s.strategy===Z_HUFFMAN_ONLY)?deflate_huff(s,flush):(s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush));if(bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE){s.status=FINISH_STATE;}
if(bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED){if(strm.avail_out===0){s.last_flush=-1;}
return Z_OK;}
if(bstate===BS_BLOCK_DONE){if(flush===Z_PARTIAL_FLUSH){_tr_align(s);}
else if(flush!==Z_BLOCK){_tr_stored_block(s,0,0,false);if(flush===Z_FULL_FLUSH){zero(s.head);if(s.lookahead===0){s.strstart=0;s.block_start=0;s.insert=0;}}}
flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK;}}}
if(flush!==Z_FINISH){return Z_OK;}
if(s.wrap<=0){return Z_STREAM_END;}
if(s.wrap===2){put_byte(s,strm.adler&0xff);put_byte(s,(strm.adler>>8)&0xff);put_byte(s,(strm.adler>>16)&0xff);put_byte(s,(strm.adler>>24)&0xff);put_byte(s,strm.total_in&0xff);put_byte(s,(strm.total_in>>8)&0xff);put_byte(s,(strm.total_in>>16)&0xff);put_byte(s,(strm.total_in>>24)&0xff);}
else
{putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&0xffff);}
flush_pending(strm);if(s.wrap>0){s.wrap=-s.wrap;}
return s.pending!==0?Z_OK:Z_STREAM_END;}
class Deflator{constructor(){this.strm=new ZStream();this.chunkSize=1024*10*10;this.outputBuffer=new Uint8Array(this.chunkSize);this.windowBits=5;deflateInit(this.strm,this.windowBits);}
deflate(inData){this.strm.input=inData;this.strm.avail_in=this.strm.input.length;this.strm.next_in=0;this.strm.output=this.outputBuffer;this.strm.avail_out=this.chunkSize;this.strm.next_out=0;let lastRet=deflate(this.strm,Z_FULL_FLUSH);let outData=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);if(lastRet<0){throw new Error("zlib deflate failed");}
if(this.strm.avail_in>0){let chunks=[outData];let totalLen=outData.length;do{this.strm.output=new Uint8Array(this.chunkSize);this.strm.next_out=0;this.strm.avail_out=this.chunkSize;lastRet=deflate(this.strm,Z_FULL_FLUSH);if(lastRet<0){throw new Error("zlib deflate failed");}
let chunk=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);totalLen+=chunk.length;chunks.push(chunk);}while(this.strm.avail_in>0);let newData=new Uint8Array(totalLen);let offset=0;for(let i=0;i<chunks.length;i++){newData.set(chunks[i],offset);offset+=chunks[i].length;}
outData=newData;}
this.strm.input=null;this.strm.avail_in=0;this.strm.next_in=0;return outData;}}
function getPointerEvent(e){return e.changedTouches?e.changedTouches[0]:e.touches?e.touches[0]:e;}
function stopEvent(e){e.stopPropagation();e.preventDefault();}
let _captureRecursion=false;let _elementForUnflushedEvents=null;document.captureElement=null;function _captureProxy(e){if(_captureRecursion)return;const newEv=new e.constructor(e.type,e);_captureRecursion=true;if(document.captureElement){document.captureElement.dispatchEvent(newEv);}else{_elementForUnflushedEvents.dispatchEvent(newEv);}
_captureRecursion=false;e.stopPropagation();if(newEv.defaultPrevented){e.preventDefault();}
if(e.type==="mouseup"){releaseCapture();}}
function _capturedElemChanged(){const proxyElem=document.getElementById("noVNC_mouse_capture_elem");proxyElem.style.cursor=window.getComputedStyle(document.captureElement).cursor;}
const _captureObserver=new MutationObserver(_capturedElemChanged);function setCapture(target){if(target.setCapture){target.setCapture();document.captureElement=target;target.addEventListener('mouseup',releaseCapture);}else{releaseCapture();let proxyElem=document.getElementById("noVNC_mouse_capture_elem");if(proxyElem===null){proxyElem=document.createElement("div");proxyElem.id="noVNC_mouse_capture_elem";proxyElem.style.position="fixed";proxyElem.style.top="0px";proxyElem.style.left="0px";proxyElem.style.width="100%";proxyElem.style.height="100%";proxyElem.style.zIndex=10000;proxyElem.style.display="none";document.body.appendChild(proxyElem);proxyElem.addEventListener('contextmenu',_captureProxy);proxyElem.addEventListener('mousemove',_captureProxy);proxyElem.addEventListener('mouseup',_captureProxy);}
document.captureElement=target;_captureObserver.observe(target,{attributes:true});_capturedElemChanged();proxyElem.style.display="";window.addEventListener('mousemove',_captureProxy);window.addEventListener('mouseup',_captureProxy);}}
function releaseCapture(){if(document.releaseCapture){document.releaseCapture();document.captureElement=null;}else{if(!document.captureElement){return;}
_elementForUnflushedEvents=document.captureElement;document.captureElement=null;_captureObserver.disconnect();const proxyElem=document.getElementById("noVNC_mouse_capture_elem");proxyElem.style.display="none";window.removeEventListener('mousemove',_captureProxy);window.removeEventListener('mouseup',_captureProxy);}}
var KeyTable={XK_VoidSymbol:0xffffff,XK_BackSpace:0xff08,XK_Tab:0xff09,XK_Linefeed:0xff0a,XK_Clear:0xff0b,XK_Return:0xff0d,XK_Pause:0xff13,XK_Scroll_Lock:0xff14,XK_Sys_Req:0xff15,XK_Escape:0xff1b,XK_Delete:0xffff,XK_Multi_key:0xff20,XK_Codeinput:0xff37,XK_SingleCandidate:0xff3c,XK_MultipleCandidate:0xff3d,XK_PreviousCandidate:0xff3e,XK_Kanji:0xff21,XK_Muhenkan:0xff22,XK_Henkan_Mode:0xff23,XK_Henkan:0xff23,XK_Romaji:0xff24,XK_Hiragana:0xff25,XK_Katakana:0xff26,XK_Hiragana_Katakana:0xff27,XK_Zenkaku:0xff28,XK_Hankaku:0xff29,XK_Zenkaku_Hankaku:0xff2a,XK_Touroku:0xff2b,XK_Massyo:0xff2c,XK_Kana_Lock:0xff2d,XK_Kana_Shift:0xff2e,XK_Eisu_Shift:0xff2f,XK_Eisu_toggle:0xff30,XK_Kanji_Bangou:0xff37,XK_Zen_Koho:0xff3d,XK_Mae_Koho:0xff3e,XK_Home:0xff50,XK_Left:0xff51,XK_Up:0xff52,XK_Right:0xff53,XK_Down:0xff54,XK_Prior:0xff55,XK_Page_Up:0xff55,XK_Next:0xff56,XK_Page_Down:0xff56,XK_End:0xff57,XK_Begin:0xff58,XK_Select:0xff60,XK_Print:0xff61,XK_Execute:0xff62,XK_Insert:0xff63,XK_Undo:0xff65,XK_Redo:0xff66,XK_Menu:0xff67,XK_Find:0xff68,XK_Cancel:0xff69,XK_Help:0xff6a,XK_Break:0xff6b,XK_Mode_switch:0xff7e,XK_script_switch:0xff7e,XK_Num_Lock:0xff7f,XK_KP_Space:0xff80,XK_KP_Tab:0xff89,XK_KP_Enter:0xff8d,XK_KP_F1:0xff91,XK_KP_F2:0xff92,XK_KP_F3:0xff93,XK_KP_F4:0xff94,XK_KP_Home:0xff95,XK_KP_Left:0xff96,XK_KP_Up:0xff97,XK_KP_Right:0xff98,XK_KP_Down:0xff99,XK_KP_Prior:0xff9a,XK_KP_Page_Up:0xff9a,XK_KP_Next:0xff9b,XK_KP_Page_Down:0xff9b,XK_KP_End:0xff9c,XK_KP_Begin:0xff9d,XK_KP_Insert:0xff9e,XK_KP_Delete:0xff9f,XK_KP_Equal:0xffbd,XK_KP_Multiply:0xffaa,XK_KP_Add:0xffab,XK_KP_Separator:0xffac,XK_KP_Subtract:0xffad,XK_KP_Decimal:0xffae,XK_KP_Divide:0xffaf,XK_KP_0:0xffb0,XK_KP_1:0xffb1,XK_KP_2:0xffb2,XK_KP_3:0xffb3,XK_KP_4:0xffb4,XK_KP_5:0xffb5,XK_KP_6:0xffb6,XK_KP_7:0xffb7,XK_KP_8:0xffb8,XK_KP_9:0xffb9,XK_F1:0xffbe,XK_F2:0xffbf,XK_F3:0xffc0,XK_F4:0xffc1,XK_F5:0xffc2,XK_F6:0xffc3,XK_F7:0xffc4,XK_F8:0xffc5,XK_F9:0xffc6,XK_F10:0xffc7,XK_F11:0xffc8,XK_L1:0xffc8,XK_F12:0xffc9,XK_L2:0xffc9,XK_F13:0xffca,XK_L3:0xffca,XK_F14:0xffcb,XK_L4:0xffcb,XK_F15:0xffcc,XK_L5:0xffcc,XK_F16:0xffcd,XK_L6:0xffcd,XK_F17:0xffce,XK_L7:0xffce,XK_F18:0xffcf,XK_L8:0xffcf,XK_F19:0xffd0,XK_L9:0xffd0,XK_F20:0xffd1,XK_L10:0xffd1,XK_F21:0xffd2,XK_R1:0xffd2,XK_F22:0xffd3,XK_R2:0xffd3,XK_F23:0xffd4,XK_R3:0xffd4,XK_F24:0xffd5,XK_R4:0xffd5,XK_F25:0xffd6,XK_R5:0xffd6,XK_F26:0xffd7,XK_R6:0xffd7,XK_F27:0xffd8,XK_R7:0xffd8,XK_F28:0xffd9,XK_R8:0xffd9,XK_F29:0xffda,XK_R9:0xffda,XK_F30:0xffdb,XK_R10:0xffdb,XK_F31:0xffdc,XK_R11:0xffdc,XK_F32:0xffdd,XK_R12:0xffdd,XK_F33:0xffde,XK_R13:0xffde,XK_F34:0xffdf,XK_R14:0xffdf,XK_F35:0xffe0,XK_R15:0xffe0,XK_Shift_L:0xffe1,XK_Shift_R:0xffe2,XK_Control_L:0xffe3,XK_Control_R:0xffe4,XK_Caps_Lock:0xffe5,XK_Shift_Lock:0xffe6,XK_Meta_L:0xffe7,XK_Meta_R:0xffe8,XK_Alt_L:0xffe9,XK_Alt_R:0xffea,XK_Super_L:0xffeb,XK_Super_R:0xffec,XK_Hyper_L:0xffed,XK_Hyper_R:0xffee,XK_ISO_Level3_Shift:0xfe03,XK_ISO_Next_Group:0xfe08,XK_ISO_Prev_Group:0xfe0a,XK_ISO_First_Group:0xfe0c,XK_ISO_Last_Group:0xfe0e,XK_space:0x0020,XK_exclam:0x0021,XK_quotedbl:0x0022,XK_numbersign:0x0023,XK_dollar:0x0024,XK_percent:0x0025,XK_ampersand:0x0026,XK_apostrophe:0x0027,XK_quoteright:0x0027,XK_parenleft:0x0028,XK_parenright:0x0029,XK_asterisk:0x002a,XK_plus:0x002b,XK_comma:0x002c,XK_minus:0x002d,XK_period:0x002e,XK_slash:0x002f,XK_0:0x0030,XK_1:0x0031,XK_2:0x0032,XK_3:0x0033,XK_4:0x0034,XK_5:0x0035,XK_6:0x0036,XK_7:0x0037,XK_8:0x0038,XK_9:0x0039,XK_colon:0x003a,XK_semicolon:0x003b,XK_less:0x003c,XK_equal:0x003d,XK_greater:0x003e,XK_question:0x003f,XK_at:0x0040,XK_A:0x0041,XK_B:0x0042,XK_C:0x0043,XK_D:0x0044,XK_E:0x0045,XK_F:0x0046,XK_G:0x0047,XK_H:0x0048,XK_I:0x0049,XK_J:0x004a,XK_K:0x004b,XK_L:0x004c,XK_M:0x004d,XK_N:0x004e,XK_O:0x004f,XK_P:0x0050,XK_Q:0x0051,XK_R:0x0052,XK_S:0x0053,XK_T:0x0054,XK_U:0x0055,XK_V:0x0056,XK_W:0x0057,XK_X:0x0058,XK_Y:0x0059,XK_Z:0x005a,XK_bracketleft:0x005b,XK_backslash:0x005c,XK_bracketright:0x005d,XK_asciicircum:0x005e,XK_underscore:0x005f,XK_grave:0x0060,XK_quoteleft:0x0060,XK_a:0x0061,XK_b:0x0062,XK_c:0x0063,XK_d:0x0064,XK_e:0x0065,XK_f:0x0066,XK_g:0x0067,XK_h:0x0068,XK_i:0x0069,XK_j:0x006a,XK_k:0x006b,XK_l:0x006c,XK_m:0x006d,XK_n:0x006e,XK_o:0x006f,XK_p:0x0070,XK_q:0x0071,XK_r:0x0072,XK_s:0x0073,XK_t:0x0074,XK_u:0x0075,XK_v:0x0076,XK_w:0x0077,XK_x:0x0078,XK_y:0x0079,XK_z:0x007a,XK_braceleft:0x007b,XK_bar:0x007c,XK_braceright:0x007d,XK_asciitilde:0x007e,XK_nobreakspace:0x00a0,XK_exclamdown:0x00a1,XK_cent:0x00a2,XK_sterling:0x00a3,XK_currency:0x00a4,XK_yen:0x00a5,XK_brokenbar:0x00a6,XK_section:0x00a7,XK_diaeresis:0x00a8,XK_copyright:0x00a9,XK_ordfeminine:0x00aa,XK_guillemotleft:0x00ab,XK_notsign:0x00ac,XK_hyphen:0x00ad,XK_registered:0x00ae,XK_macron:0x00af,XK_degree:0x00b0,XK_plusminus:0x00b1,XK_twosuperior:0x00b2,XK_threesuperior:0x00b3,XK_acute:0x00b4,XK_mu:0x00b5,XK_paragraph:0x00b6,XK_periodcentered:0x00b7,XK_cedilla:0x00b8,XK_onesuperior:0x00b9,XK_masculine:0x00ba,XK_guillemotright:0x00bb,XK_onequarter:0x00bc,XK_onehalf:0x00bd,XK_threequarters:0x00be,XK_questiondown:0x00bf,XK_Agrave:0x00c0,XK_Aacute:0x00c1,XK_Acircumflex:0x00c2,XK_Atilde:0x00c3,XK_Adiaeresis:0x00c4,XK_Aring:0x00c5,XK_AE:0x00c6,XK_Ccedilla:0x00c7,XK_Egrave:0x00c8,XK_Eacute:0x00c9,XK_Ecircumflex:0x00ca,XK_Ediaeresis:0x00cb,XK_Igrave:0x00cc,XK_Iacute:0x00cd,XK_Icircumflex:0x00ce,XK_Idiaeresis:0x00cf,XK_ETH:0x00d0,XK_Eth:0x00d0,XK_Ntilde:0x00d1,XK_Ograve:0x00d2,XK_Oacute:0x00d3,XK_Ocircumflex:0x00d4,XK_Otilde:0x00d5,XK_Odiaeresis:0x00d6,XK_multiply:0x00d7,XK_Oslash:0x00d8,XK_Ooblique:0x00d8,XK_Ugrave:0x00d9,XK_Uacute:0x00da,XK_Ucircumflex:0x00db,XK_Udiaeresis:0x00dc,XK_Yacute:0x00dd,XK_THORN:0x00de,XK_Thorn:0x00de,XK_ssharp:0x00df,XK_agrave:0x00e0,XK_aacute:0x00e1,XK_acircumflex:0x00e2,XK_atilde:0x00e3,XK_adiaeresis:0x00e4,XK_aring:0x00e5,XK_ae:0x00e6,XK_ccedilla:0x00e7,XK_egrave:0x00e8,XK_eacute:0x00e9,XK_ecircumflex:0x00ea,XK_ediaeresis:0x00eb,XK_igrave:0x00ec,XK_iacute:0x00ed,XK_icircumflex:0x00ee,XK_idiaeresis:0x00ef,XK_eth:0x00f0,XK_ntilde:0x00f1,XK_ograve:0x00f2,XK_oacute:0x00f3,XK_ocircumflex:0x00f4,XK_otilde:0x00f5,XK_odiaeresis:0x00f6,XK_division:0x00f7,XK_oslash:0x00f8,XK_ooblique:0x00f8,XK_ugrave:0x00f9,XK_uacute:0x00fa,XK_ucircumflex:0x00fb,XK_udiaeresis:0x00fc,XK_yacute:0x00fd,XK_thorn:0x00fe,XK_ydiaeresis:0x00ff,XK_Hangul:0xff31,XK_Hangul_Hanja:0xff34,XK_Hangul_Jeonja:0xff38,XF86XK_ModeLock:0x1008FF01,XF86XK_MonBrightnessUp:0x1008FF02,XF86XK_MonBrightnessDown:0x1008FF03,XF86XK_KbdLightOnOff:0x1008FF04,XF86XK_KbdBrightnessUp:0x1008FF05,XF86XK_KbdBrightnessDown:0x1008FF06,XF86XK_Standby:0x1008FF10,XF86XK_AudioLowerVolume:0x1008FF11,XF86XK_AudioMute:0x1008FF12,XF86XK_AudioRaiseVolume:0x1008FF13,XF86XK_AudioPlay:0x1008FF14,XF86XK_AudioStop:0x1008FF15,XF86XK_AudioPrev:0x1008FF16,XF86XK_AudioNext:0x1008FF17,XF86XK_HomePage:0x1008FF18,XF86XK_Mail:0x1008FF19,XF86XK_Start:0x1008FF1A,XF86XK_Search:0x1008FF1B,XF86XK_AudioRecord:0x1008FF1C,XF86XK_Calculator:0x1008FF1D,XF86XK_Memo:0x1008FF1E,XF86XK_ToDoList:0x1008FF1F,XF86XK_Calendar:0x1008FF20,XF86XK_PowerDown:0x1008FF21,XF86XK_ContrastAdjust:0x1008FF22,XF86XK_RockerUp:0x1008FF23,XF86XK_RockerDown:0x1008FF24,XF86XK_RockerEnter:0x1008FF25,XF86XK_Back:0x1008FF26,XF86XK_Forward:0x1008FF27,XF86XK_Stop:0x1008FF28,XF86XK_Refresh:0x1008FF29,XF86XK_PowerOff:0x1008FF2A,XF86XK_WakeUp:0x1008FF2B,XF86XK_Eject:0x1008FF2C,XF86XK_ScreenSaver:0x1008FF2D,XF86XK_WWW:0x1008FF2E,XF86XK_Sleep:0x1008FF2F,XF86XK_Favorites:0x1008FF30,XF86XK_AudioPause:0x1008FF31,XF86XK_AudioMedia:0x1008FF32,XF86XK_MyComputer:0x1008FF33,XF86XK_VendorHome:0x1008FF34,XF86XK_LightBulb:0x1008FF35,XF86XK_Shop:0x1008FF36,XF86XK_History:0x1008FF37,XF86XK_OpenURL:0x1008FF38,XF86XK_AddFavorite:0x1008FF39,XF86XK_HotLinks:0x1008FF3A,XF86XK_BrightnessAdjust:0x1008FF3B,XF86XK_Finance:0x1008FF3C,XF86XK_Community:0x1008FF3D,XF86XK_AudioRewind:0x1008FF3E,XF86XK_BackForward:0x1008FF3F,XF86XK_Launch0:0x1008FF40,XF86XK_Launch1:0x1008FF41,XF86XK_Launch2:0x1008FF42,XF86XK_Launch3:0x1008FF43,XF86XK_Launch4:0x1008FF44,XF86XK_Launch5:0x1008FF45,XF86XK_Launch6:0x1008FF46,XF86XK_Launch7:0x1008FF47,XF86XK_Launch8:0x1008FF48,XF86XK_Launch9:0x1008FF49,XF86XK_LaunchA:0x1008FF4A,XF86XK_LaunchB:0x1008FF4B,XF86XK_LaunchC:0x1008FF4C,XF86XK_LaunchD:0x1008FF4D,XF86XK_LaunchE:0x1008FF4E,XF86XK_LaunchF:0x1008FF4F,XF86XK_ApplicationLeft:0x1008FF50,XF86XK_ApplicationRight:0x1008FF51,XF86XK_Book:0x1008FF52,XF86XK_CD:0x1008FF53,XF86XK_Calculater:0x1008FF54,XF86XK_Clear:0x1008FF55,XF86XK_Close:0x1008FF56,XF86XK_Copy:0x1008FF57,XF86XK_Cut:0x1008FF58,XF86XK_Display:0x1008FF59,XF86XK_DOS:0x1008FF5A,XF86XK_Documents:0x1008FF5B,XF86XK_Excel:0x1008FF5C,XF86XK_Explorer:0x1008FF5D,XF86XK_Game:0x1008FF5E,XF86XK_Go:0x1008FF5F,XF86XK_iTouch:0x1008FF60,XF86XK_LogOff:0x1008FF61,XF86XK_Market:0x1008FF62,XF86XK_Meeting:0x1008FF63,XF86XK_MenuKB:0x1008FF65,XF86XK_MenuPB:0x1008FF66,XF86XK_MySites:0x1008FF67,XF86XK_New:0x1008FF68,XF86XK_News:0x1008FF69,XF86XK_OfficeHome:0x1008FF6A,XF86XK_Open:0x1008FF6B,XF86XK_Option:0x1008FF6C,XF86XK_Paste:0x1008FF6D,XF86XK_Phone:0x1008FF6E,XF86XK_Q:0x1008FF70,XF86XK_Reply:0x1008FF72,XF86XK_Reload:0x1008FF73,XF86XK_RotateWindows:0x1008FF74,XF86XK_RotationPB:0x1008FF75,XF86XK_RotationKB:0x1008FF76,XF86XK_Save:0x1008FF77,XF86XK_ScrollUp:0x1008FF78,XF86XK_ScrollDown:0x1008FF79,XF86XK_ScrollClick:0x1008FF7A,XF86XK_Send:0x1008FF7B,XF86XK_Spell:0x1008FF7C,XF86XK_SplitScreen:0x1008FF7D,XF86XK_Support:0x1008FF7E,XF86XK_TaskPane:0x1008FF7F,XF86XK_Terminal:0x1008FF80,XF86XK_Tools:0x1008FF81,XF86XK_Travel:0x1008FF82,XF86XK_UserPB:0x1008FF84,XF86XK_User1KB:0x1008FF85,XF86XK_User2KB:0x1008FF86,XF86XK_Video:0x1008FF87,XF86XK_WheelButton:0x1008FF88,XF86XK_Word:0x1008FF89,XF86XK_Xfer:0x1008FF8A,XF86XK_ZoomIn:0x1008FF8B,XF86XK_ZoomOut:0x1008FF8C,XF86XK_Away:0x1008FF8D,XF86XK_Messenger:0x1008FF8E,XF86XK_WebCam:0x1008FF8F,XF86XK_MailForward:0x1008FF90,XF86XK_Pictures:0x1008FF91,XF86XK_Music:0x1008FF92,XF86XK_Battery:0x1008FF93,XF86XK_Bluetooth:0x1008FF94,XF86XK_WLAN:0x1008FF95,XF86XK_UWB:0x1008FF96,XF86XK_AudioForward:0x1008FF97,XF86XK_AudioRepeat:0x1008FF98,XF86XK_AudioRandomPlay:0x1008FF99,XF86XK_Subtitle:0x1008FF9A,XF86XK_AudioCycleTrack:0x1008FF9B,XF86XK_CycleAngle:0x1008FF9C,XF86XK_FrameBack:0x1008FF9D,XF86XK_FrameForward:0x1008FF9E,XF86XK_Time:0x1008FF9F,XF86XK_Select:0x1008FFA0,XF86XK_View:0x1008FFA1,XF86XK_TopMenu:0x1008FFA2,XF86XK_Red:0x1008FFA3,XF86XK_Green:0x1008FFA4,XF86XK_Yellow:0x1008FFA5,XF86XK_Blue:0x1008FFA6,XF86XK_Suspend:0x1008FFA7,XF86XK_Hibernate:0x1008FFA8,XF86XK_TouchpadToggle:0x1008FFA9,XF86XK_TouchpadOn:0x1008FFB0,XF86XK_TouchpadOff:0x1008FFB1,XF86XK_AudioMicMute:0x1008FFB2,XF86XK_Switch_VT_1:0x1008FE01,XF86XK_Switch_VT_2:0x1008FE02,XF86XK_Switch_VT_3:0x1008FE03,XF86XK_Switch_VT_4:0x1008FE04,XF86XK_Switch_VT_5:0x1008FE05,XF86XK_Switch_VT_6:0x1008FE06,XF86XK_Switch_VT_7:0x1008FE07,XF86XK_Switch_VT_8:0x1008FE08,XF86XK_Switch_VT_9:0x1008FE09,XF86XK_Switch_VT_10:0x1008FE0A,XF86XK_Switch_VT_11:0x1008FE0B,XF86XK_Switch_VT_12:0x1008FE0C,XF86XK_Ungrab:0x1008FE20,XF86XK_ClearGrab:0x1008FE21,XF86XK_Next_VMode:0x1008FE22,XF86XK_Prev_VMode:0x1008FE23,XF86XK_LogWindowTree:0x1008FE24,XF86XK_LogGrabInfo:0x1008FE25,};const codepoints={0x0100:0x03c0,0x0101:0x03e0,0x0102:0x01c3,0x0103:0x01e3,0x0104:0x01a1,0x0105:0x01b1,0x0106:0x01c6,0x0107:0x01e6,0x0108:0x02c6,0x0109:0x02e6,0x010a:0x02c5,0x010b:0x02e5,0x010c:0x01c8,0x010d:0x01e8,0x010e:0x01cf,0x010f:0x01ef,0x0110:0x01d0,0x0111:0x01f0,0x0112:0x03aa,0x0113:0x03ba,0x0116:0x03cc,0x0117:0x03ec,0x0118:0x01ca,0x0119:0x01ea,0x011a:0x01cc,0x011b:0x01ec,0x011c:0x02d8,0x011d:0x02f8,0x011e:0x02ab,0x011f:0x02bb,0x0120:0x02d5,0x0121:0x02f5,0x0122:0x03ab,0x0123:0x03bb,0x0124:0x02a6,0x0125:0x02b6,0x0126:0x02a1,0x0127:0x02b1,0x0128:0x03a5,0x0129:0x03b5,0x012a:0x03cf,0x012b:0x03ef,0x012e:0x03c7,0x012f:0x03e7,0x0130:0x02a9,0x0131:0x02b9,0x0134:0x02ac,0x0135:0x02bc,0x0136:0x03d3,0x0137:0x03f3,0x0138:0x03a2,0x0139:0x01c5,0x013a:0x01e5,0x013b:0x03a6,0x013c:0x03b6,0x013d:0x01a5,0x013e:0x01b5,0x0141:0x01a3,0x0142:0x01b3,0x0143:0x01d1,0x0144:0x01f1,0x0145:0x03d1,0x0146:0x03f1,0x0147:0x01d2,0x0148:0x01f2,0x014a:0x03bd,0x014b:0x03bf,0x014c:0x03d2,0x014d:0x03f2,0x0150:0x01d5,0x0151:0x01f5,0x0152:0x13bc,0x0153:0x13bd,0x0154:0x01c0,0x0155:0x01e0,0x0156:0x03a3,0x0157:0x03b3,0x0158:0x01d8,0x0159:0x01f8,0x015a:0x01a6,0x015b:0x01b6,0x015c:0x02de,0x015d:0x02fe,0x015e:0x01aa,0x015f:0x01ba,0x0160:0x01a9,0x0161:0x01b9,0x0162:0x01de,0x0163:0x01fe,0x0164:0x01ab,0x0165:0x01bb,0x0166:0x03ac,0x0167:0x03bc,0x0168:0x03dd,0x0169:0x03fd,0x016a:0x03de,0x016b:0x03fe,0x016c:0x02dd,0x016d:0x02fd,0x016e:0x01d9,0x016f:0x01f9,0x0170:0x01db,0x0171:0x01fb,0x0172:0x03d9,0x0173:0x03f9,0x0178:0x13be,0x0179:0x01ac,0x017a:0x01bc,0x017b:0x01af,0x017c:0x01bf,0x017d:0x01ae,0x017e:0x01be,0x0192:0x08f6,0x01d2:0x10001d1,0x02c7:0x01b7,0x02d8:0x01a2,0x02d9:0x01ff,0x02db:0x01b2,0x02dd:0x01bd,0x0385:0x07ae,0x0386:0x07a1,0x0388:0x07a2,0x0389:0x07a3,0x038a:0x07a4,0x038c:0x07a7,0x038e:0x07a8,0x038f:0x07ab,0x0390:0x07b6,0x0391:0x07c1,0x0392:0x07c2,0x0393:0x07c3,0x0394:0x07c4,0x0395:0x07c5,0x0396:0x07c6,0x0397:0x07c7,0x0398:0x07c8,0x0399:0x07c9,0x039a:0x07ca,0x039b:0x07cb,0x039c:0x07cc,0x039d:0x07cd,0x039e:0x07ce,0x039f:0x07cf,0x03a0:0x07d0,0x03a1:0x07d1,0x03a3:0x07d2,0x03a4:0x07d4,0x03a5:0x07d5,0x03a6:0x07d6,0x03a7:0x07d7,0x03a8:0x07d8,0x03a9:0x07d9,0x03aa:0x07a5,0x03ab:0x07a9,0x03ac:0x07b1,0x03ad:0x07b2,0x03ae:0x07b3,0x03af:0x07b4,0x03b0:0x07ba,0x03b1:0x07e1,0x03b2:0x07e2,0x03b3:0x07e3,0x03b4:0x07e4,0x03b5:0x07e5,0x03b6:0x07e6,0x03b7:0x07e7,0x03b8:0x07e8,0x03b9:0x07e9,0x03ba:0x07ea,0x03bb:0x07eb,0x03bc:0x07ec,0x03bd:0x07ed,0x03be:0x07ee,0x03bf:0x07ef,0x03c0:0x07f0,0x03c1:0x07f1,0x03c2:0x07f3,0x03c3:0x07f2,0x03c4:0x07f4,0x03c5:0x07f5,0x03c6:0x07f6,0x03c7:0x07f7,0x03c8:0x07f8,0x03c9:0x07f9,0x03ca:0x07b5,0x03cb:0x07b9,0x03cc:0x07b7,0x03cd:0x07b8,0x03ce:0x07bb,0x0401:0x06b3,0x0402:0x06b1,0x0403:0x06b2,0x0404:0x06b4,0x0405:0x06b5,0x0406:0x06b6,0x0407:0x06b7,0x0408:0x06b8,0x0409:0x06b9,0x040a:0x06ba,0x040b:0x06bb,0x040c:0x06bc,0x040e:0x06be,0x040f:0x06bf,0x0410:0x06e1,0x0411:0x06e2,0x0412:0x06f7,0x0413:0x06e7,0x0414:0x06e4,0x0415:0x06e5,0x0416:0x06f6,0x0417:0x06fa,0x0418:0x06e9,0x0419:0x06ea,0x041a:0x06eb,0x041b:0x06ec,0x041c:0x06ed,0x041d:0x06ee,0x041e:0x06ef,0x041f:0x06f0,0x0420:0x06f2,0x0421:0x06f3,0x0422:0x06f4,0x0423:0x06f5,0x0424:0x06e6,0x0425:0x06e8,0x0426:0x06e3,0x0427:0x06fe,0x0428:0x06fb,0x0429:0x06fd,0x042a:0x06ff,0x042b:0x06f9,0x042c:0x06f8,0x042d:0x06fc,0x042e:0x06e0,0x042f:0x06f1,0x0430:0x06c1,0x0431:0x06c2,0x0432:0x06d7,0x0433:0x06c7,0x0434:0x06c4,0x0435:0x06c5,0x0436:0x06d6,0x0437:0x06da,0x0438:0x06c9,0x0439:0x06ca,0x043a:0x06cb,0x043b:0x06cc,0x043c:0x06cd,0x043d:0x06ce,0x043e:0x06cf,0x043f:0x06d0,0x0440:0x06d2,0x0441:0x06d3,0x0442:0x06d4,0x0443:0x06d5,0x0444:0x06c6,0x0445:0x06c8,0x0446:0x06c3,0x0447:0x06de,0x0448:0x06db,0x0449:0x06dd,0x044a:0x06df,0x044b:0x06d9,0x044c:0x06d8,0x044d:0x06dc,0x044e:0x06c0,0x044f:0x06d1,0x0451:0x06a3,0x0452:0x06a1,0x0453:0x06a2,0x0454:0x06a4,0x0455:0x06a5,0x0456:0x06a6,0x0457:0x06a7,0x0458:0x06a8,0x0459:0x06a9,0x045a:0x06aa,0x045b:0x06ab,0x045c:0x06ac,0x045e:0x06ae,0x045f:0x06af,0x0490:0x06bd,0x0491:0x06ad,0x05d0:0x0ce0,0x05d1:0x0ce1,0x05d2:0x0ce2,0x05d3:0x0ce3,0x05d4:0x0ce4,0x05d5:0x0ce5,0x05d6:0x0ce6,0x05d7:0x0ce7,0x05d8:0x0ce8,0x05d9:0x0ce9,0x05da:0x0cea,0x05db:0x0ceb,0x05dc:0x0cec,0x05dd:0x0ced,0x05de:0x0cee,0x05df:0x0cef,0x05e0:0x0cf0,0x05e1:0x0cf1,0x05e2:0x0cf2,0x05e3:0x0cf3,0x05e4:0x0cf4,0x05e5:0x0cf5,0x05e6:0x0cf6,0x05e7:0x0cf7,0x05e8:0x0cf8,0x05e9:0x0cf9,0x05ea:0x0cfa,0x060c:0x05ac,0x061b:0x05bb,0x061f:0x05bf,0x0621:0x05c1,0x0622:0x05c2,0x0623:0x05c3,0x0624:0x05c4,0x0625:0x05c5,0x0626:0x05c6,0x0627:0x05c7,0x0628:0x05c8,0x0629:0x05c9,0x062a:0x05ca,0x062b:0x05cb,0x062c:0x05cc,0x062d:0x05cd,0x062e:0x05ce,0x062f:0x05cf,0x0630:0x05d0,0x0631:0x05d1,0x0632:0x05d2,0x0633:0x05d3,0x0634:0x05d4,0x0635:0x05d5,0x0636:0x05d6,0x0637:0x05d7,0x0638:0x05d8,0x0639:0x05d9,0x063a:0x05da,0x0640:0x05e0,0x0641:0x05e1,0x0642:0x05e2,0x0643:0x05e3,0x0644:0x05e4,0x0645:0x05e5,0x0646:0x05e6,0x0647:0x05e7,0x0648:0x05e8,0x0649:0x05e9,0x064a:0x05ea,0x064b:0x05eb,0x064c:0x05ec,0x064d:0x05ed,0x064e:0x05ee,0x064f:0x05ef,0x0650:0x05f0,0x0651:0x05f1,0x0652:0x05f2,0x0e01:0x0da1,0x0e02:0x0da2,0x0e03:0x0da3,0x0e04:0x0da4,0x0e05:0x0da5,0x0e06:0x0da6,0x0e07:0x0da7,0x0e08:0x0da8,0x0e09:0x0da9,0x0e0a:0x0daa,0x0e0b:0x0dab,0x0e0c:0x0dac,0x0e0d:0x0dad,0x0e0e:0x0dae,0x0e0f:0x0daf,0x0e10:0x0db0,0x0e11:0x0db1,0x0e12:0x0db2,0x0e13:0x0db3,0x0e14:0x0db4,0x0e15:0x0db5,0x0e16:0x0db6,0x0e17:0x0db7,0x0e18:0x0db8,0x0e19:0x0db9,0x0e1a:0x0dba,0x0e1b:0x0dbb,0x0e1c:0x0dbc,0x0e1d:0x0dbd,0x0e1e:0x0dbe,0x0e1f:0x0dbf,0x0e20:0x0dc0,0x0e21:0x0dc1,0x0e22:0x0dc2,0x0e23:0x0dc3,0x0e24:0x0dc4,0x0e25:0x0dc5,0x0e26:0x0dc6,0x0e27:0x0dc7,0x0e28:0x0dc8,0x0e29:0x0dc9,0x0e2a:0x0dca,0x0e2b:0x0dcb,0x0e2c:0x0dcc,0x0e2d:0x0dcd,0x0e2e:0x0dce,0x0e2f:0x0dcf,0x0e30:0x0dd0,0x0e31:0x0dd1,0x0e32:0x0dd2,0x0e33:0x0dd3,0x0e34:0x0dd4,0x0e35:0x0dd5,0x0e36:0x0dd6,0x0e37:0x0dd7,0x0e38:0x0dd8,0x0e39:0x0dd9,0x0e3a:0x0dda,0x0e3f:0x0ddf,0x0e40:0x0de0,0x0e41:0x0de1,0x0e42:0x0de2,0x0e43:0x0de3,0x0e44:0x0de4,0x0e45:0x0de5,0x0e46:0x0de6,0x0e47:0x0de7,0x0e48:0x0de8,0x0e49:0x0de9,0x0e4a:0x0dea,0x0e4b:0x0deb,0x0e4c:0x0dec,0x0e4d:0x0ded,0x0e50:0x0df0,0x0e51:0x0df1,0x0e52:0x0df2,0x0e53:0x0df3,0x0e54:0x0df4,0x0e55:0x0df5,0x0e56:0x0df6,0x0e57:0x0df7,0x0e58:0x0df8,0x0e59:0x0df9,0x2002:0x0aa2,0x2003:0x0aa1,0x2004:0x0aa3,0x2005:0x0aa4,0x2007:0x0aa5,0x2008:0x0aa6,0x2009:0x0aa7,0x200a:0x0aa8,0x2012:0x0abb,0x2013:0x0aaa,0x2014:0x0aa9,0x2015:0x07af,0x2017:0x0cdf,0x2018:0x0ad0,0x2019:0x0ad1,0x201a:0x0afd,0x201c:0x0ad2,0x201d:0x0ad3,0x201e:0x0afe,0x2020:0x0af1,0x2021:0x0af2,0x2022:0x0ae6,0x2025:0x0aaf,0x2026:0x0aae,0x2030:0x0ad5,0x2032:0x0ad6,0x2033:0x0ad7,0x2038:0x0afc,0x203e:0x047e,0x20a9:0x0eff,0x20ac:0x20ac,0x2105:0x0ab8,0x2116:0x06b0,0x2117:0x0afb,0x211e:0x0ad4,0x2122:0x0ac9,0x2153:0x0ab0,0x2154:0x0ab1,0x2155:0x0ab2,0x2156:0x0ab3,0x2157:0x0ab4,0x2158:0x0ab5,0x2159:0x0ab6,0x215a:0x0ab7,0x215b:0x0ac3,0x215c:0x0ac4,0x215d:0x0ac5,0x215e:0x0ac6,0x2190:0x08fb,0x2191:0x08fc,0x2192:0x08fd,0x2193:0x08fe,0x21d2:0x08ce,0x21d4:0x08cd,0x2202:0x08ef,0x2207:0x08c5,0x2218:0x0bca,0x221a:0x08d6,0x221d:0x08c1,0x221e:0x08c2,0x2227:0x08de,0x2228:0x08df,0x2229:0x08dc,0x222a:0x08dd,0x222b:0x08bf,0x2234:0x08c0,0x223c:0x08c8,0x2243:0x08c9,0x2245:0x1002248,0x2260:0x08bd,0x2261:0x08cf,0x2264:0x08bc,0x2265:0x08be,0x2282:0x08da,0x2283:0x08db,0x22a2:0x0bfc,0x22a3:0x0bdc,0x22a4:0x0bc2,0x22a5:0x0bce,0x2308:0x0bd3,0x230a:0x0bc4,0x2315:0x0afa,0x2320:0x08a4,0x2321:0x08a5,0x2395:0x0bcc,0x239b:0x08ab,0x239d:0x08ac,0x239e:0x08ad,0x23a0:0x08ae,0x23a1:0x08a7,0x23a3:0x08a8,0x23a4:0x08a9,0x23a6:0x08aa,0x23a8:0x08af,0x23ac:0x08b0,0x23b7:0x08a1,0x23ba:0x09ef,0x23bb:0x09f0,0x23bc:0x09f2,0x23bd:0x09f3,0x2409:0x09e2,0x240a:0x09e5,0x240b:0x09e9,0x240c:0x09e3,0x240d:0x09e4,0x2423:0x0aac,0x2424:0x09e8,0x2500:0x08a3,0x2502:0x08a6,0x250c:0x08a2,0x2510:0x09eb,0x2514:0x09ed,0x2518:0x09ea,0x251c:0x09f4,0x2524:0x09f5,0x252c:0x09f7,0x2534:0x09f6,0x253c:0x09ee,0x2592:0x09e1,0x25aa:0x0ae7,0x25ab:0x0ae1,0x25ac:0x0adb,0x25ad:0x0ae2,0x25ae:0x0adf,0x25af:0x0acf,0x25b2:0x0ae8,0x25b3:0x0ae3,0x25b6:0x0add,0x25b7:0x0acd,0x25bc:0x0ae9,0x25bd:0x0ae4,0x25c0:0x0adc,0x25c1:0x0acc,0x25c6:0x09e0,0x25cb:0x0ace,0x25cf:0x0ade,0x25e6:0x0ae0,0x2606:0x0ae5,0x260e:0x0af9,0x2613:0x0aca,0x261c:0x0aea,0x261e:0x0aeb,0x2640:0x0af8,0x2642:0x0af7,0x2663:0x0aec,0x2665:0x0aee,0x2666:0x0aed,0x266d:0x0af6,0x266f:0x0af5,0x2713:0x0af3,0x2717:0x0af4,0x271d:0x0ad9,0x2720:0x0af0,0x27e8:0x0abc,0x27e9:0x0abe,0x3001:0x04a4,0x3002:0x04a1,0x300c:0x04a2,0x300d:0x04a3,0x309b:0x04de,0x309c:0x04df,0x30a1:0x04a7,0x30a2:0x04b1,0x30a3:0x04a8,0x30a4:0x04b2,0x30a5:0x04a9,0x30a6:0x04b3,0x30a7:0x04aa,0x30a8:0x04b4,0x30a9:0x04ab,0x30aa:0x04b5,0x30ab:0x04b6,0x30ad:0x04b7,0x30af:0x04b8,0x30b1:0x04b9,0x30b3:0x04ba,0x30b5:0x04bb,0x30b7:0x04bc,0x30b9:0x04bd,0x30bb:0x04be,0x30bd:0x04bf,0x30bf:0x04c0,0x30c1:0x04c1,0x30c3:0x04af,0x30c4:0x04c2,0x30c6:0x04c3,0x30c8:0x04c4,0x30ca:0x04c5,0x30cb:0x04c6,0x30cc:0x04c7,0x30cd:0x04c8,0x30ce:0x04c9,0x30cf:0x04ca,0x30d2:0x04cb,0x30d5:0x04cc,0x30d8:0x04cd,0x30db:0x04ce,0x30de:0x04cf,0x30df:0x04d0,0x30e0:0x04d1,0x30e1:0x04d2,0x30e2:0x04d3,0x30e3:0x04ac,0x30e4:0x04d4,0x30e5:0x04ad,0x30e6:0x04d5,0x30e7:0x04ae,0x30e8:0x04d6,0x30e9:0x04d7,0x30ea:0x04d8,0x30eb:0x04d9,0x30ec:0x04da,0x30ed:0x04db,0x30ef:0x04dc,0x30f2:0x04a6,0x30f3:0x04dd,0x30fb:0x04a5,0x30fc:0x04b0,};var keysyms={lookup(u){if((u>=0x20)&&(u<=0xff)){return u;}
const keysym=codepoints[u];if(keysym!==undefined){return keysym;}
return 0x01000000|u;},};var vkeys={0x08:'Backspace',0x09:'Tab',0x0a:'NumpadClear',0x0c:'Numpad5',0x0d:'Enter',0x10:'ShiftLeft',0x11:'ControlLeft',0x12:'AltLeft',0x13:'Pause',0x14:'CapsLock',0x15:'Lang1',0x19:'Lang2',0x1b:'Escape',0x1c:'Convert',0x1d:'NonConvert',0x20:'Space',0x21:'PageUp',0x22:'PageDown',0x23:'End',0x24:'Home',0x25:'ArrowLeft',0x26:'ArrowUp',0x27:'ArrowRight',0x28:'ArrowDown',0x29:'Select',0x2c:'PrintScreen',0x2d:'Insert',0x2e:'Delete',0x2f:'Help',0x30:'Digit0',0x31:'Digit1',0x32:'Digit2',0x33:'Digit3',0x34:'Digit4',0x35:'Digit5',0x36:'Digit6',0x37:'Digit7',0x38:'Digit8',0x39:'Digit9',0x5b:'MetaLeft',0x5c:'MetaRight',0x5d:'ContextMenu',0x5f:'Sleep',0x60:'Numpad0',0x61:'Numpad1',0x62:'Numpad2',0x63:'Numpad3',0x64:'Numpad4',0x65:'Numpad5',0x66:'Numpad6',0x67:'Numpad7',0x68:'Numpad8',0x69:'Numpad9',0x6a:'NumpadMultiply',0x6b:'NumpadAdd',0x6c:'NumpadDecimal',0x6d:'NumpadSubtract',0x6e:'NumpadDecimal',0x6f:'NumpadDivide',0x70:'F1',0x71:'F2',0x72:'F3',0x73:'F4',0x74:'F5',0x75:'F6',0x76:'F7',0x77:'F8',0x78:'F9',0x79:'F10',0x7a:'F11',0x7b:'F12',0x7c:'F13',0x7d:'F14',0x7e:'F15',0x7f:'F16',0x80:'F17',0x81:'F18',0x82:'F19',0x83:'F20',0x84:'F21',0x85:'F22',0x86:'F23',0x87:'F24',0x90:'NumLock',0x91:'ScrollLock',0xa6:'BrowserBack',0xa7:'BrowserForward',0xa8:'BrowserRefresh',0xa9:'BrowserStop',0xaa:'BrowserSearch',0xab:'BrowserFavorites',0xac:'BrowserHome',0xad:'AudioVolumeMute',0xae:'AudioVolumeDown',0xaf:'AudioVolumeUp',0xb0:'MediaTrackNext',0xb1:'MediaTrackPrevious',0xb2:'MediaStop',0xb3:'MediaPlayPause',0xb4:'LaunchMail',0xb5:'MediaSelect',0xb6:'LaunchApp1',0xb7:'LaunchApp2',0xe1:'AltRight',};var fixedkeys={'Backspace':'Backspace','AltLeft':'Alt','AltRight':'Alt','CapsLock':'CapsLock','ContextMenu':'ContextMenu','ControlLeft':'Control','ControlRight':'Control','Enter':'Enter','MetaLeft':'Meta','MetaRight':'Meta','ShiftLeft':'Shift','ShiftRight':'Shift','Tab':'Tab','Delete':'Delete','End':'End','Help':'Help','Home':'Home','Insert':'Insert','PageDown':'PageDown','PageUp':'PageUp','ArrowDown':'ArrowDown','ArrowLeft':'ArrowLeft','ArrowRight':'ArrowRight','ArrowUp':'ArrowUp','NumLock':'NumLock','NumpadBackspace':'Backspace','NumpadClear':'Clear','Escape':'Escape','F1':'F1','F2':'F2','F3':'F3','F4':'F4','F5':'F5','F6':'F6','F7':'F7','F8':'F8','F9':'F9','F10':'F10','F11':'F11','F12':'F12','F13':'F13','F14':'F14','F15':'F15','F16':'F16','F17':'F17','F18':'F18','F19':'F19','F20':'F20','F21':'F21','F22':'F22','F23':'F23','F24':'F24','F25':'F25','F26':'F26','F27':'F27','F28':'F28','F29':'F29','F30':'F30','F31':'F31','F32':'F32','F33':'F33','F34':'F34','F35':'F35','PrintScreen':'PrintScreen','ScrollLock':'ScrollLock','Pause':'Pause','BrowserBack':'BrowserBack','BrowserFavorites':'BrowserFavorites','BrowserForward':'BrowserForward','BrowserHome':'BrowserHome','BrowserRefresh':'BrowserRefresh','BrowserSearch':'BrowserSearch','BrowserStop':'BrowserStop','Eject':'Eject','LaunchApp1':'LaunchMyComputer','LaunchApp2':'LaunchCalendar','LaunchMail':'LaunchMail','MediaPlayPause':'MediaPlay','MediaStop':'MediaStop','MediaTrackNext':'MediaTrackNext','MediaTrackPrevious':'MediaTrackPrevious','Power':'Power','Sleep':'Sleep','AudioVolumeDown':'AudioVolumeDown','AudioVolumeMute':'AudioVolumeMute','AudioVolumeUp':'AudioVolumeUp','WakeUp':'WakeUp',};const DOMKeyTable={};function addStandard(key,standard){if(standard===undefined)throw new Error("Undefined keysym for key \""+key+"\"");if(key in DOMKeyTable)throw new Error("Duplicate entry for key \""+key+"\"");DOMKeyTable[key]=[standard,standard,standard,standard];}
function addLeftRight(key,left,right){if(left===undefined)throw new Error("Undefined keysym for key \""+key+"\"");if(right===undefined)throw new Error("Undefined keysym for key \""+key+"\"");if(key in DOMKeyTable)throw new Error("Duplicate entry for key \""+key+"\"");DOMKeyTable[key]=[left,left,right,left];}
function addNumpad(key,standard,numpad){if(standard===undefined)throw new Error("Undefined keysym for key \""+key+"\"");if(numpad===undefined)throw new Error("Undefined keysym for key \""+key+"\"");if(key in DOMKeyTable)throw new Error("Duplicate entry for key \""+key+"\"");DOMKeyTable[key]=[standard,standard,standard,numpad];}
addLeftRight("Alt",KeyTable.XK_Alt_L,KeyTable.XK_Alt_R);addStandard("AltGraph",KeyTable.XK_ISO_Level3_Shift);addStandard("CapsLock",KeyTable.XK_Caps_Lock);addLeftRight("Control",KeyTable.XK_Control_L,KeyTable.XK_Control_R);addLeftRight("Meta",KeyTable.XK_Super_L,KeyTable.XK_Super_R);addStandard("NumLock",KeyTable.XK_Num_Lock);addStandard("ScrollLock",KeyTable.XK_Scroll_Lock);addLeftRight("Shift",KeyTable.XK_Shift_L,KeyTable.XK_Shift_R);addNumpad("Enter",KeyTable.XK_Return,KeyTable.XK_KP_Enter);addStandard("Tab",KeyTable.XK_Tab);addNumpad(" ",KeyTable.XK_space,KeyTable.XK_KP_Space);addNumpad("ArrowDown",KeyTable.XK_Down,KeyTable.XK_KP_Down);addNumpad("ArrowUp",KeyTable.XK_Up,KeyTable.XK_KP_Up);addNumpad("ArrowLeft",KeyTable.XK_Left,KeyTable.XK_KP_Left);addNumpad("ArrowRight",KeyTable.XK_Right,KeyTable.XK_KP_Right);addNumpad("End",KeyTable.XK_End,KeyTable.XK_KP_End);addNumpad("Home",KeyTable.XK_Home,KeyTable.XK_KP_Home);addNumpad("PageDown",KeyTable.XK_Next,KeyTable.XK_KP_Next);addNumpad("PageUp",KeyTable.XK_Prior,KeyTable.XK_KP_Prior);addStandard("Backspace",KeyTable.XK_BackSpace);addNumpad("Clear",KeyTable.XK_Clear,KeyTable.XK_KP_Begin);addStandard("Copy",KeyTable.XF86XK_Copy);addStandard("Cut",KeyTable.XF86XK_Cut);addNumpad("Delete",KeyTable.XK_Delete,KeyTable.XK_KP_Delete);addNumpad("Insert",KeyTable.XK_Insert,KeyTable.XK_KP_Insert);addStandard("Paste",KeyTable.XF86XK_Paste);addStandard("Redo",KeyTable.XK_Redo);addStandard("Undo",KeyTable.XK_Undo);addStandard("Cancel",KeyTable.XK_Cancel);addStandard("ContextMenu",KeyTable.XK_Menu);addStandard("Escape",KeyTable.XK_Escape);addStandard("Execute",KeyTable.XK_Execute);addStandard("Find",KeyTable.XK_Find);addStandard("Help",KeyTable.XK_Help);addStandard("Pause",KeyTable.XK_Pause);addStandard("Select",KeyTable.XK_Select);addStandard("ZoomIn",KeyTable.XF86XK_ZoomIn);addStandard("ZoomOut",KeyTable.XF86XK_ZoomOut);addStandard("BrightnessDown",KeyTable.XF86XK_MonBrightnessDown);addStandard("BrightnessUp",KeyTable.XF86XK_MonBrightnessUp);addStandard("Eject",KeyTable.XF86XK_Eject);addStandard("LogOff",KeyTable.XF86XK_LogOff);addStandard("Power",KeyTable.XF86XK_PowerOff);addStandard("PowerOff",KeyTable.XF86XK_PowerDown);addStandard("PrintScreen",KeyTable.XK_Print);addStandard("Hibernate",KeyTable.XF86XK_Hibernate);addStandard("Standby",KeyTable.XF86XK_Standby);addStandard("WakeUp",KeyTable.XF86XK_WakeUp);addStandard("AllCandidates",KeyTable.XK_MultipleCandidate);addStandard("Alphanumeric",KeyTable.XK_Eisu_Shift);addStandard("CodeInput",KeyTable.XK_Codeinput);addStandard("Compose",KeyTable.XK_Multi_key);addStandard("Convert",KeyTable.XK_Henkan);addStandard("GroupFirst",KeyTable.XK_ISO_First_Group);addStandard("GroupLast",KeyTable.XK_ISO_Last_Group);addStandard("GroupNext",KeyTable.XK_ISO_Next_Group);addStandard("GroupPrevious",KeyTable.XK_ISO_Prev_Group);addStandard("NonConvert",KeyTable.XK_Muhenkan);addStandard("PreviousCandidate",KeyTable.XK_PreviousCandidate);addStandard("SingleCandidate",KeyTable.XK_SingleCandidate);addStandard("HangulMode",KeyTable.XK_Hangul);addStandard("HanjaMode",KeyTable.XK_Hangul_Hanja);addStandard("JunjuaMode",KeyTable.XK_Hangul_Jeonja);addStandard("Eisu",KeyTable.XK_Eisu_toggle);addStandard("Hankaku",KeyTable.XK_Hankaku);addStandard("Hiragana",KeyTable.XK_Hiragana);addStandard("HiraganaKatakana",KeyTable.XK_Hiragana_Katakana);addStandard("KanaMode",KeyTable.XK_Kana_Shift);addStandard("KanjiMode",KeyTable.XK_Kanji);addStandard("Katakana",KeyTable.XK_Katakana);addStandard("Romaji",KeyTable.XK_Romaji);addStandard("Zenkaku",KeyTable.XK_Zenkaku);addStandard("ZenkakuHanaku",KeyTable.XK_Zenkaku_Hankaku);addStandard("F1",KeyTable.XK_F1);addStandard("F2",KeyTable.XK_F2);addStandard("F3",KeyTable.XK_F3);addStandard("F4",KeyTable.XK_F4);addStandard("F5",KeyTable.XK_F5);addStandard("F6",KeyTable.XK_F6);addStandard("F7",KeyTable.XK_F7);addStandard("F8",KeyTable.XK_F8);addStandard("F9",KeyTable.XK_F9);addStandard("F10",KeyTable.XK_F10);addStandard("F11",KeyTable.XK_F11);addStandard("F12",KeyTable.XK_F12);addStandard("F13",KeyTable.XK_F13);addStandard("F14",KeyTable.XK_F14);addStandard("F15",KeyTable.XK_F15);addStandard("F16",KeyTable.XK_F16);addStandard("F17",KeyTable.XK_F17);addStandard("F18",KeyTable.XK_F18);addStandard("F19",KeyTable.XK_F19);addStandard("F20",KeyTable.XK_F20);addStandard("F21",KeyTable.XK_F21);addStandard("F22",KeyTable.XK_F22);addStandard("F23",KeyTable.XK_F23);addStandard("F24",KeyTable.XK_F24);addStandard("F25",KeyTable.XK_F25);addStandard("F26",KeyTable.XK_F26);addStandard("F27",KeyTable.XK_F27);addStandard("F28",KeyTable.XK_F28);addStandard("F29",KeyTable.XK_F29);addStandard("F30",KeyTable.XK_F30);addStandard("F31",KeyTable.XK_F31);addStandard("F32",KeyTable.XK_F32);addStandard("F33",KeyTable.XK_F33);addStandard("F34",KeyTable.XK_F34);addStandard("F35",KeyTable.XK_F35);addStandard("Close",KeyTable.XF86XK_Close);addStandard("MailForward",KeyTable.XF86XK_MailForward);addStandard("MailReply",KeyTable.XF86XK_Reply);addStandard("MailSend",KeyTable.XF86XK_Send);addStandard("MediaFastForward",KeyTable.XF86XK_AudioForward);addStandard("MediaPause",KeyTable.XF86XK_AudioPause);addStandard("MediaPlay",KeyTable.XF86XK_AudioPlay);addStandard("MediaRecord",KeyTable.XF86XK_AudioRecord);addStandard("MediaRewind",KeyTable.XF86XK_AudioRewind);addStandard("MediaStop",KeyTable.XF86XK_AudioStop);addStandard("MediaTrackNext",KeyTable.XF86XK_AudioNext);addStandard("MediaTrackPrevious",KeyTable.XF86XK_AudioPrev);addStandard("New",KeyTable.XF86XK_New);addStandard("Open",KeyTable.XF86XK_Open);addStandard("Print",KeyTable.XK_Print);addStandard("Save",KeyTable.XF86XK_Save);addStandard("SpellCheck",KeyTable.XF86XK_Spell);addStandard("AudioVolumeDown",KeyTable.XF86XK_AudioLowerVolume);addStandard("AudioVolumeUp",KeyTable.XF86XK_AudioRaiseVolume);addStandard("AudioVolumeMute",KeyTable.XF86XK_AudioMute);addStandard("MicrophoneVolumeMute",KeyTable.XF86XK_AudioMicMute);addStandard("LaunchApplication1",KeyTable.XF86XK_MyComputer);addStandard("LaunchApplication2",KeyTable.XF86XK_Calculator);addStandard("LaunchCalendar",KeyTable.XF86XK_Calendar);addStandard("LaunchMail",KeyTable.XF86XK_Mail);addStandard("LaunchMediaPlayer",KeyTable.XF86XK_AudioMedia);addStandard("LaunchMusicPlayer",KeyTable.XF86XK_Music);addStandard("LaunchPhone",KeyTable.XF86XK_Phone);addStandard("LaunchScreenSaver",KeyTable.XF86XK_ScreenSaver);addStandard("LaunchSpreadsheet",KeyTable.XF86XK_Excel);addStandard("LaunchWebBrowser",KeyTable.XF86XK_WWW);addStandard("LaunchWebCam",KeyTable.XF86XK_WebCam);addStandard("LaunchWordProcessor",KeyTable.XF86XK_Word);addStandard("BrowserBack",KeyTable.XF86XK_Back);addStandard("BrowserFavorites",KeyTable.XF86XK_Favorites);addStandard("BrowserForward",KeyTable.XF86XK_Forward);addStandard("BrowserHome",KeyTable.XF86XK_HomePage);addStandard("BrowserRefresh",KeyTable.XF86XK_Refresh);addStandard("BrowserSearch",KeyTable.XF86XK_Search);addStandard("BrowserStop",KeyTable.XF86XK_Stop);addStandard("Dimmer",KeyTable.XF86XK_BrightnessAdjust);addStandard("MediaAudioTrack",KeyTable.XF86XK_AudioCycleTrack);addStandard("RandomToggle",KeyTable.XF86XK_AudioRandomPlay);addStandard("SplitScreenToggle",KeyTable.XF86XK_SplitScreen);addStandard("Subtitle",KeyTable.XF86XK_Subtitle);addStandard("VideoModeNext",KeyTable.XF86XK_Next_VMode);addNumpad("=",KeyTable.XK_equal,KeyTable.XK_KP_Equal);addNumpad("+",KeyTable.XK_plus,KeyTable.XK_KP_Add);addNumpad("-",KeyTable.XK_minus,KeyTable.XK_KP_Subtract);addNumpad("*",KeyTable.XK_asterisk,KeyTable.XK_KP_Multiply);addNumpad("/",KeyTable.XK_slash,KeyTable.XK_KP_Divide);addNumpad(".",KeyTable.XK_period,KeyTable.XK_KP_Decimal);addNumpad(",",KeyTable.XK_comma,KeyTable.XK_KP_Separator);addNumpad("0",KeyTable.XK_0,KeyTable.XK_KP_0);addNumpad("1",KeyTable.XK_1,KeyTable.XK_KP_1);addNumpad("2",KeyTable.XK_2,KeyTable.XK_KP_2);addNumpad("3",KeyTable.XK_3,KeyTable.XK_KP_3);addNumpad("4",KeyTable.XK_4,KeyTable.XK_KP_4);addNumpad("5",KeyTable.XK_5,KeyTable.XK_KP_5);addNumpad("6",KeyTable.XK_6,KeyTable.XK_KP_6);addNumpad("7",KeyTable.XK_7,KeyTable.XK_KP_7);addNumpad("8",KeyTable.XK_8,KeyTable.XK_KP_8);addNumpad("9",KeyTable.XK_9,KeyTable.XK_KP_9);function getKeycode(evt){if(evt.code){switch(evt.code){case 'OSLeft':return 'MetaLeft';case 'OSRight':return 'MetaRight';}
return evt.code;}
if((evt.type!=='keypress')&&(evt.keyCode in vkeys)){let code=vkeys[evt.keyCode];if(isMac()&&(code==='ContextMenu')){code='MetaRight';}
if(evt.location===2){switch(code){case 'ShiftLeft':return 'ShiftRight';case 'ControlLeft':return 'ControlRight';case 'AltLeft':return 'AltRight';}}
if(evt.location===3){switch(code){case 'Delete':return 'NumpadDecimal';case 'Insert':return 'Numpad0';case 'End':return 'Numpad1';case 'ArrowDown':return 'Numpad2';case 'PageDown':return 'Numpad3';case 'ArrowLeft':return 'Numpad4';case 'ArrowRight':return 'Numpad6';case 'Home':return 'Numpad7';case 'ArrowUp':return 'Numpad8';case 'PageUp':return 'Numpad9';case 'Enter':return 'NumpadEnter';}}
return code;}
return 'Unidentified';}
function getKey(evt){if(evt.key!==undefined){switch(evt.key){case 'Spacebar':return ' ';case 'Esc':return 'Escape';case 'Scroll':return 'ScrollLock';case 'Win':return 'Meta';case 'Apps':return 'ContextMenu';case 'Up':return 'ArrowUp';case 'Left':return 'ArrowLeft';case 'Right':return 'ArrowRight';case 'Down':return 'ArrowDown';case 'Del':return 'Delete';case 'Divide':return '/';case 'Multiply':return '*';case 'Subtract':return '-';case 'Add':return '+';case 'Decimal':return evt.char;}
switch(evt.key){case 'OS':return 'Meta';case 'LaunchMyComputer':return 'LaunchApplication1';case 'LaunchCalculator':return 'LaunchApplication2';}
switch(evt.key){case 'UIKeyInputUpArrow':return 'ArrowUp';case 'UIKeyInputDownArrow':return 'ArrowDown';case 'UIKeyInputLeftArrow':return 'ArrowLeft';case 'UIKeyInputRightArrow':return 'ArrowRight';case 'UIKeyInputEscape':return 'Escape';}
if((evt.key==='\x00')&&(evt.code==='NumpadDecimal')){return 'Delete';}
if(!isIE()&&!isEdge()){return evt.key;}
if((evt.key.length!==1)&&(evt.key!=='Unidentified')){return evt.key;}}
const code=getKeycode(evt);if(code in fixedkeys){return fixedkeys[code];}
if(evt.charCode){return String.fromCharCode(evt.charCode);}
return 'Unidentified';}
function getKeysym(evt){const key=getKey(evt);if(key==='Unidentified'){return null;}
if(key in DOMKeyTable){let location=evt.location;if((key==='Meta')&&(location===0)){location=2;}
if((key==='Clear')&&(location===3)){let code=getKeycode(evt);if(code==='NumLock'){location=0;}}
if((location===undefined)||(location>3)){location=0;}
if(key==='Meta'){let code=getKeycode(evt);if(code==='AltLeft'){return KeyTable.XK_Meta_L;}else if(code==='AltRight'){return KeyTable.XK_Meta_R;}}
if(key==='Clear'){let code=getKeycode(evt);if(code==='NumLock'){return KeyTable.XK_Num_Lock;}}
return DOMKeyTable[key][location];}
if(key.length!==1){return null;}
const codepoint=key.charCodeAt();if(codepoint){return keysyms.lookup(codepoint);}
return null;}
class Keyboard{constructor(target){this._target=target||null;this._keyDownList={};this._pendingKey=null;this._altGrArmed=false;this._eventHandlers={'keyup':this._handleKeyUp.bind(this),'keydown':this._handleKeyDown.bind(this),'keypress':this._handleKeyPress.bind(this),'blur':this._allKeysUp.bind(this),'checkalt':this._checkAlt.bind(this),};this.onkeyevent=()=>{};}
_sendKeyEvent(keysym,code,down){if(down){this._keyDownList[code]=keysym;}else{if(!(code in this._keyDownList)){return;}
delete this._keyDownList[code];}
Debug("onkeyevent "+(down?"down":"up")+
", keysym: "+keysym,", code: "+code);this.onkeyevent(keysym,code,down);}
_getKeyCode(e){const code=getKeycode(e);if(code!=='Unidentified'){return code;}
if(e.keyCode&&(e.type!=='keypress')){if(e.keyCode!==229){return 'Platform'+e.keyCode;}}
if(e.keyIdentifier){if(e.keyIdentifier.substr(0,2)!=='U+'){return e.keyIdentifier;}
const codepoint=parseInt(e.keyIdentifier.substr(2),16);const char=String.fromCharCode(codepoint).toUpperCase();return 'Platform'+char.charCodeAt();}
return 'Unidentified';}
_handleKeyDown(e){const code=this._getKeyCode(e);let keysym=getKeysym(e);if(this._altGrArmed){this._altGrArmed=false;clearTimeout(this._altGrTimeout);if((code==="AltRight")&&((e.timeStamp-this._altGrCtrlTime)<50)){keysym=KeyTable.XK_ISO_Level3_Shift;}else{this._sendKeyEvent(KeyTable.XK_Control_L,"ControlLeft",true);}}
if(code==='Unidentified'){if(keysym){this._sendKeyEvent(keysym,code,true);this._sendKeyEvent(keysym,code,false);}
stopEvent(e);return;}
if(isMac()||isIOS()){switch(keysym){case KeyTable.XK_Super_L:keysym=KeyTable.XK_Alt_L;break;case KeyTable.XK_Super_R:keysym=KeyTable.XK_Super_L;break;case KeyTable.XK_Alt_L:keysym=KeyTable.XK_Mode_switch;break;case KeyTable.XK_Alt_R:keysym=KeyTable.XK_ISO_Level3_Shift;break;}}
if(code in this._keyDownList){keysym=this._keyDownList[code];}
if((isMac()||isIOS())&&(code==='CapsLock')){this._sendKeyEvent(KeyTable.XK_Caps_Lock,'CapsLock',true);this._sendKeyEvent(KeyTable.XK_Caps_Lock,'CapsLock',false);stopEvent(e);return;}
if(!keysym&&(!e.key||isIE()||isEdge())){this._pendingKey=code;setTimeout(this._handleKeyPressTimeout.bind(this),10,e);return;}
this._pendingKey=null;stopEvent(e);if((code==="ControlLeft")&&isWindows()&&!("ControlLeft"in this._keyDownList)){this._altGrArmed=true;this._altGrTimeout=setTimeout(this._handleAltGrTimeout.bind(this),100);this._altGrCtrlTime=e.timeStamp;return;}
this._sendKeyEvent(keysym,code,true);}
_handleKeyPress(e){stopEvent(e);if(this._pendingKey===null){return;}
let code=this._getKeyCode(e);const keysym=getKeysym(e);if((code!=='Unidentified')&&(code!=this._pendingKey)){return;}
code=this._pendingKey;this._pendingKey=null;if(!keysym){Info('keypress with no keysym:',e);return;}
this._sendKeyEvent(keysym,code,true);}
_handleKeyPressTimeout(e){if(this._pendingKey===null){return;}
let keysym;const code=this._pendingKey;this._pendingKey=null;if((e.keyCode>=0x30)&&(e.keyCode<=0x39)){keysym=e.keyCode;}else if((e.keyCode>=0x41)&&(e.keyCode<=0x5a)){let char=String.fromCharCode(e.keyCode);if(e.shiftKey){char=char.toUpperCase();}else{char=char.toLowerCase();}
keysym=char.charCodeAt();}else{keysym=0;}
this._sendKeyEvent(keysym,code,true);}
_handleKeyUp(e){stopEvent(e);const code=this._getKeyCode(e);if(this._altGrArmed){this._altGrArmed=false;clearTimeout(this._altGrTimeout);this._sendKeyEvent(KeyTable.XK_Control_L,"ControlLeft",true);}
if((isMac()||isIOS())&&(code==='CapsLock')){this._sendKeyEvent(KeyTable.XK_Caps_Lock,'CapsLock',true);this._sendKeyEvent(KeyTable.XK_Caps_Lock,'CapsLock',false);return;}
this._sendKeyEvent(this._keyDownList[code],code,false);if(isWindows()&&((code==='ShiftLeft')||(code==='ShiftRight'))){if('ShiftRight'in this._keyDownList){this._sendKeyEvent(this._keyDownList['ShiftRight'],'ShiftRight',false);}
if('ShiftLeft'in this._keyDownList){this._sendKeyEvent(this._keyDownList['ShiftLeft'],'ShiftLeft',false);}}}
_handleAltGrTimeout(){this._altGrArmed=false;clearTimeout(this._altGrTimeout);this._sendKeyEvent(KeyTable.XK_Control_L,"ControlLeft",true);}
_allKeysUp(){Debug(">> Keyboard.allKeysUp");for(let code in this._keyDownList){this._sendKeyEvent(this._keyDownList[code],code,false);}
Debug("<< Keyboard.allKeysUp");}
_checkAlt(e){if(e.skipCheckAlt){return;}
if(e.altKey){return;}
const target=this._target;const downList=this._keyDownList;['AltLeft','AltRight'].forEach((code)=>{if(!(code in downList)){return;}
const event=new KeyboardEvent('keyup',{key:downList[code],code:code});event.skipCheckAlt=true;target.dispatchEvent(event);});}
grab(){this._target.addEventListener('keydown',this._eventHandlers.keydown);this._target.addEventListener('keyup',this._eventHandlers.keyup);this._target.addEventListener('keypress',this._eventHandlers.keypress);window.addEventListener('blur',this._eventHandlers.blur);if(isWindows()&&isFirefox()){const handler=this._eventHandlers.checkalt;['mousedown','mouseup','mousemove','wheel','touchstart','touchend','touchmove','keydown','keyup'].forEach(type=>document.addEventListener(type,handler,{capture:true,passive:true}));}}
ungrab(){if(isWindows()&&isFirefox()){const handler=this._eventHandlers.checkalt;['mousedown','mouseup','mousemove','wheel','touchstart','touchend','touchmove','keydown','keyup'].forEach(type=>document.removeEventListener(type,handler));}
this._target.removeEventListener('keydown',this._eventHandlers.keydown);this._target.removeEventListener('keyup',this._eventHandlers.keyup);this._target.removeEventListener('keypress',this._eventHandlers.keypress);window.removeEventListener('blur',this._eventHandlers.blur);this._allKeysUp();}}
const WHEEL_STEP=10;const WHEEL_STEP_TIMEOUT=50;const WHEEL_LINE_HEIGHT=19;class Mouse{constructor(target){this._target=target||document;this._doubleClickTimer=null;this._lastTouchPos=null;this._pos=null;this._wheelStepXTimer=null;this._wheelStepYTimer=null;this._accumulatedWheelDeltaX=0;this._accumulatedWheelDeltaY=0;this._eventHandlers={'mousedown':this._handleMouseDown.bind(this),'mouseup':this._handleMouseUp.bind(this),'mousemove':this._handleMouseMove.bind(this),'mousewheel':this._handleMouseWheel.bind(this),'mousedisable':this._handleMouseDisable.bind(this)};this.touchButton=1;this.onmousebutton=()=>{};this.onmousemove=()=>{};}
_resetDoubleClickTimer(){this._doubleClickTimer=null;}
_handleMouseButton(e,down){this._updateMousePosition(e);let pos=this._pos;let bmask;if(e.touches||e.changedTouches){if(down==1){if(this._doubleClickTimer===null){this._lastTouchPos=pos;}else{clearTimeout(this._doubleClickTimer);const xs=this._lastTouchPos.x-pos.x;const ys=this._lastTouchPos.y-pos.y;const d=Math.sqrt((xs*xs)+(ys*ys));const threshold=20*(window.devicePixelRatio||1);if(d<threshold){pos=this._lastTouchPos;}}
this._doubleClickTimer=setTimeout(this._resetDoubleClickTimer.bind(this),500);}
bmask=this.touchButton;}else if(e.which){bmask=1<<e.button;}else{bmask=(e.button&0x1)+
(e.button&0x2)*2+
(e.button&0x4)/2;}
Debug("onmousebutton "+(down?"down":"up")+
", x: "+pos.x+", y: "+pos.y+", bmask: "+bmask);this.onmousebutton(pos.x,pos.y,down,bmask);stopEvent(e);}
_handleMouseDown(e){if(e.type==="mousedown"){setCapture(this._target);}
this._handleMouseButton(e,1);}
_handleMouseUp(e){this._handleMouseButton(e,0);}
_generateWheelStepX(){if(this._accumulatedWheelDeltaX<0){this.onmousebutton(this._pos.x,this._pos.y,1,1<<5);this.onmousebutton(this._pos.x,this._pos.y,0,1<<5);}else if(this._accumulatedWheelDeltaX>0){this.onmousebutton(this._pos.x,this._pos.y,1,1<<6);this.onmousebutton(this._pos.x,this._pos.y,0,1<<6);}
this._accumulatedWheelDeltaX=0;}
_generateWheelStepY(){if(this._accumulatedWheelDeltaY<0){this.onmousebutton(this._pos.x,this._pos.y,1,1<<3);this.onmousebutton(this._pos.x,this._pos.y,0,1<<3);}else if(this._accumulatedWheelDeltaY>0){this.onmousebutton(this._pos.x,this._pos.y,1,1<<4);this.onmousebutton(this._pos.x,this._pos.y,0,1<<4);}
this._accumulatedWheelDeltaY=0;}
_resetWheelStepTimers(){window.clearTimeout(this._wheelStepXTimer);window.clearTimeout(this._wheelStepYTimer);this._wheelStepXTimer=null;this._wheelStepYTimer=null;}
_handleMouseWheel(e){this._resetWheelStepTimers();this._updateMousePosition(e);let dX=e.deltaX;let dY=e.deltaY;if(e.deltaMode!==0){dX*=WHEEL_LINE_HEIGHT;dY*=WHEEL_LINE_HEIGHT;}
this._accumulatedWheelDeltaX+=dX;this._accumulatedWheelDeltaY+=dY;if(Math.abs(this._accumulatedWheelDeltaX)>WHEEL_STEP){this._generateWheelStepX();}else{this._wheelStepXTimer=window.setTimeout(this._generateWheelStepX.bind(this),WHEEL_STEP_TIMEOUT);}
if(Math.abs(this._accumulatedWheelDeltaY)>WHEEL_STEP){this._generateWheelStepY();}else{this._wheelStepYTimer=window.setTimeout(this._generateWheelStepY.bind(this),WHEEL_STEP_TIMEOUT);}
stopEvent(e);}
_handleMouseMove(e){this._updateMousePosition(e);this.onmousemove(this._pos.x,this._pos.y);stopEvent(e);}
_handleMouseDisable(e){if(e.target==this._target){stopEvent(e);}}
_updateMousePosition(e){e=getPointerEvent(e);const bounds=this._target.getBoundingClientRect();let x;let y;if(e.clientX<bounds.left){x=0;}else if(e.clientX>=bounds.right){x=bounds.width-1;}else{x=e.clientX-bounds.left;}
if(e.clientY<bounds.top){y=0;}else if(e.clientY>=bounds.bottom){y=bounds.height-1;}else{y=e.clientY-bounds.top;}
this._pos={x:x,y:y};}
grab(){if(isTouchDevice){this._target.addEventListener('touchstart',this._eventHandlers.mousedown);this._target.addEventListener('touchend',this._eventHandlers.mouseup);this._target.addEventListener('touchmove',this._eventHandlers.mousemove);}
this._target.addEventListener('mousedown',this._eventHandlers.mousedown);this._target.addEventListener('mouseup',this._eventHandlers.mouseup);this._target.addEventListener('mousemove',this._eventHandlers.mousemove);this._target.addEventListener('wheel',this._eventHandlers.mousewheel);document.addEventListener('click',this._eventHandlers.mousedisable);this._target.addEventListener('contextmenu',this._eventHandlers.mousedisable);}
ungrab(){this._resetWheelStepTimers();if(isTouchDevice){this._target.removeEventListener('touchstart',this._eventHandlers.mousedown);this._target.removeEventListener('touchend',this._eventHandlers.mouseup);this._target.removeEventListener('touchmove',this._eventHandlers.mousemove);}
this._target.removeEventListener('mousedown',this._eventHandlers.mousedown);this._target.removeEventListener('mouseup',this._eventHandlers.mouseup);this._target.removeEventListener('mousemove',this._eventHandlers.mousemove);this._target.removeEventListener('wheel',this._eventHandlers.mousewheel);document.removeEventListener('click',this._eventHandlers.mousedisable);this._target.removeEventListener('contextmenu',this._eventHandlers.mousedisable);}}
const useFallback=!supportsCursorURIs||isTouchDevice;class Cursor{constructor(){this._target=null;this._canvas=document.createElement('canvas');if(useFallback){this._canvas.style.position='fixed';this._canvas.style.zIndex='65535';this._canvas.style.pointerEvents='none';this._canvas.style.visibility='hidden';}
this._position={x:0,y:0};this._hotSpot={x:0,y:0};this._eventHandlers={'mouseover':this._handleMouseOver.bind(this),'mouseleave':this._handleMouseLeave.bind(this),'mousemove':this._handleMouseMove.bind(this),'mouseup':this._handleMouseUp.bind(this),'touchstart':this._handleTouchStart.bind(this),'touchmove':this._handleTouchMove.bind(this),'touchend':this._handleTouchEnd.bind(this),};}
attach(target){if(this._target){this.detach();}
this._target=target;if(useFallback){document.body.appendChild(this._canvas);const options={capture:true,passive:true};this._target.addEventListener('mouseover',this._eventHandlers.mouseover,options);this._target.addEventListener('mouseleave',this._eventHandlers.mouseleave,options);this._target.addEventListener('mousemove',this._eventHandlers.mousemove,options);this._target.addEventListener('mouseup',this._eventHandlers.mouseup,options);window.addEventListener('touchstart',this._eventHandlers.touchstart,options);this._target.addEventListener('touchmove',this._eventHandlers.touchmove,options);this._target.addEventListener('touchend',this._eventHandlers.touchend,options);}
this.clear();}
detach(){if(!this._target){return;}
if(useFallback){const options={capture:true,passive:true};this._target.removeEventListener('mouseover',this._eventHandlers.mouseover,options);this._target.removeEventListener('mouseleave',this._eventHandlers.mouseleave,options);this._target.removeEventListener('mousemove',this._eventHandlers.mousemove,options);this._target.removeEventListener('mouseup',this._eventHandlers.mouseup,options);window.removeEventListener('touchstart',this._eventHandlers.touchstart,options);this._target.removeEventListener('touchmove',this._eventHandlers.touchmove,options);this._target.removeEventListener('touchend',this._eventHandlers.touchend,options);document.body.removeChild(this._canvas);}
this._target=null;}
change(rgba,hotx,hoty,w,h){if((w===0)||(h===0)){this.clear();return;}
this._position.x=this._position.x+this._hotSpot.x-hotx;this._position.y=this._position.y+this._hotSpot.y-hoty;this._hotSpot.x=hotx;this._hotSpot.y=hoty;let ctx=this._canvas.getContext('2d');this._canvas.width=w;this._canvas.height=h;let img;try{img=new ImageData(new Uint8ClampedArray(rgba),w,h);}catch(ex){img=ctx.createImageData(w,h);img.data.set(new Uint8ClampedArray(rgba));}
ctx.clearRect(0,0,w,h);ctx.putImageData(img,0,0);if(useFallback){this._updatePosition();}else{let url=this._canvas.toDataURL();this._target.style.cursor='url('+url+')'+hotx+' '+hoty+', default';}}
clear(){this._target.style.cursor='none';this._canvas.width=0;this._canvas.height=0;this._position.x=this._position.x+this._hotSpot.x;this._position.y=this._position.y+this._hotSpot.y;this._hotSpot.x=0;this._hotSpot.y=0;}
_handleMouseOver(event){this._handleMouseMove(event);}
_handleMouseLeave(event){this._updateVisibility(event.relatedTarget);}
_handleMouseMove(event){this._updateVisibility(event.target);this._position.x=event.clientX-this._hotSpot.x;this._position.y=event.clientY-this._hotSpot.y;this._updatePosition();}
_handleMouseUp(event){let target=document.elementFromPoint(event.clientX,event.clientY);this._updateVisibility(target);if(this._captureIsActive()){window.setTimeout(()=>{target=document.elementFromPoint(event.clientX,event.clientY);this._updateVisibility(target);},0);}}
_handleTouchStart(event){this._handleTouchMove(event);}
_handleTouchMove(event){this._updateVisibility(event.target);this._position.x=event.changedTouches[0].clientX-this._hotSpot.x;this._position.y=event.changedTouches[0].clientY-this._hotSpot.y;this._updatePosition();}
_handleTouchEnd(event){let target=document.elementFromPoint(event.changedTouches[0].clientX,event.changedTouches[0].clientY);this._updateVisibility(target);}
_showCursor(){if(this._canvas.style.visibility==='hidden'){this._canvas.style.visibility='';}}
_hideCursor(){if(this._canvas.style.visibility!=='hidden'){this._canvas.style.visibility='hidden';}}
_shouldShowCursor(target){if(!target){return false;}
if(target===this._target){return true;}
if(!this._target.contains(target)){return false;}
if(window.getComputedStyle(target).cursor!=='none'){return false;}
return true;}
_updateVisibility(target){if(this._captureIsActive()){target=document.captureElement;}
if(this._shouldShowCursor(target)){this._showCursor();}else{this._hideCursor();}}
_updatePosition(){this._canvas.style.left=this._position.x+"px";this._canvas.style.top=this._position.y+"px";}
_captureIsActive(){return document.captureElement&&document.documentElement.contains(document.captureElement);}}
const MAX_RQ_GROW_SIZE=40*1024*1024;class Websock{constructor(){this._websocket=null;this._rQi=0;this._rQlen=0;this._rQbufferSize=1024*1024*4;this._rQ=null;this._sQbufferSize=1024*10;this._sQlen=0;this._sQ=null;this._eventHandlers={message:()=>{},open:()=>{},close:()=>{},error:()=>{}};}
get sQ(){return this._sQ;}
get rQ(){return this._rQ;}
get rQi(){return this._rQi;}
set rQi(val){this._rQi=val;}
get rQlen(){return this._rQlen-this._rQi;}
rQpeek8(){return this._rQ[this._rQi];}
rQskipBytes(bytes){this._rQi+=bytes;}
rQshift8(){return this._rQshift(1);}
rQshift16(){return this._rQshift(2);}
rQshift32(){return this._rQshift(4);}
_rQshift(bytes){let res=0;for(let byte=bytes-1;byte>=0;byte--){res+=this._rQ[this._rQi++]<<(byte*8);}
return res;}
rQshiftStr(len){if(typeof(len)==='undefined'){len=this.rQlen;}
let str="";for(let i=0;i<len;i+=4096){let part=this.rQshiftBytes(Math.min(4096,len-i));str+=String.fromCharCode.apply(null,part);}
return str;}
rQshiftBytes(len){if(typeof(len)==='undefined'){len=this.rQlen;}
this._rQi+=len;return new Uint8Array(this._rQ.buffer,this._rQi-len,len);}
rQshiftTo(target,len){if(len===undefined){len=this.rQlen;}
target.set(new Uint8Array(this._rQ.buffer,this._rQi,len));this._rQi+=len;}
rQslice(start,end=this.rQlen){return new Uint8Array(this._rQ.buffer,this._rQi+start,end-start);}
rQwait(msg,num,goback){if(this.rQlen<num){if(goback){if(this._rQi<goback){throw new Error("rQwait cannot backup "+goback+" bytes");}
this._rQi-=goback;}
return true;}
return false;}
flush(){if(this._sQlen>0&&this._websocket.readyState===WebSocket.OPEN){this._websocket.send(this._encode_message());this._sQlen=0;}}
send(arr){this._sQ.set(arr,this._sQlen);this._sQlen+=arr.length;this.flush();}
send_string(str){this.send(str.split('').map(chr=>chr.charCodeAt(0)));}
off(evt){this._eventHandlers[evt]=()=>{};}
on(evt,handler){this._eventHandlers[evt]=handler;}
_allocate_buffers(){this._rQ=new Uint8Array(this._rQbufferSize);this._sQ=new Uint8Array(this._sQbufferSize);}
init(){this._allocate_buffers();this._rQi=0;this._websocket=null;}
open(uri,protocols){this.init();this._websocket=new WebSocket(uri,protocols);this._websocket.binaryType='arraybuffer';this._websocket.onmessage=this._recv_message.bind(this);this._websocket.onopen=()=>{Debug('>> WebSock.onopen');if(this._websocket.protocol){Info("Server choose sub-protocol: "+this._websocket.protocol);}
this._eventHandlers.open();Debug("<< WebSock.onopen");};this._websocket.onclose=(e)=>{Debug(">> WebSock.onclose");this._eventHandlers.close(e);Debug("<< WebSock.onclose");};this._websocket.onerror=(e)=>{Debug(">> WebSock.onerror: "+e);this._eventHandlers.error(e);Debug("<< WebSock.onerror: "+e);};}
close(){if(this._websocket){if((this._websocket.readyState===WebSocket.OPEN)||(this._websocket.readyState===WebSocket.CONNECTING)){Info("Closing WebSocket connection");this._websocket.close();}
this._websocket.onmessage=()=>{};}}
_encode_message(){return new Uint8Array(this._sQ.buffer,0,this._sQlen);}
_expand_compact_rQ(min_fit){const required_buffer_size=(this._rQlen-this._rQi+min_fit)*8;const resizeNeeded=this._rQbufferSize<required_buffer_size;if(resizeNeeded){this._rQbufferSize=Math.max(this._rQbufferSize*2,required_buffer_size);}
if(this._rQbufferSize>MAX_RQ_GROW_SIZE){this._rQbufferSize=MAX_RQ_GROW_SIZE;if(this._rQbufferSize-this.rQlen<min_fit){throw new Error("Receive Queue buffer exceeded "+MAX_RQ_GROW_SIZE+" bytes, and the new message could not fit");}}
if(resizeNeeded){const old_rQbuffer=this._rQ.buffer;this._rQ=new Uint8Array(this._rQbufferSize);this._rQ.set(new Uint8Array(old_rQbuffer,this._rQi,this._rQlen-this._rQi));}else{{this._rQ.set(new Uint8Array(this._rQ.buffer,this._rQi,this._rQlen-this._rQi));}}
this._rQlen=this._rQlen-this._rQi;this._rQi=0;}
_decode_message(data){const u8=new Uint8Array(data);if(u8.length>this._rQbufferSize-this._rQlen){this._expand_compact_rQ(u8.length);}
this._rQ.set(u8,this._rQlen);this._rQlen+=u8.length;}
_recv_message(e){this._decode_message(e.data);if(this.rQlen>0){this._eventHandlers.message();if(this._rQlen==this._rQi){this._rQlen=0;this._rQi=0;}}else{Debug("Ignoring empty message");}}}
const PC2=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],totrot=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28];const z=0x0;let a,b,c,d,e,f;a=1<<16;b=1<<24;c=a|b;d=1<<2;e=1<<10;f=d|e;const SP1=[c|e,z|z,a|z,c|f,c|d,a|f,z|d,a|z,z|e,c|e,c|f,z|e,b|f,c|d,b|z,z|d,z|f,b|e,b|e,a|e,a|e,c|z,c|z,b|f,a|d,b|d,b|d,a|d,z|z,z|f,a|f,b|z,a|z,c|f,z|d,c|z,c|e,b|z,b|z,z|e,c|d,a|z,a|e,b|d,z|e,z|d,b|f,a|f,c|f,a|d,c|z,b|f,b|d,z|f,a|f,c|e,z|f,b|e,b|e,z|z,a|d,a|e,z|z,c|d];a=1<<20;b=1<<31;c=a|b;d=1<<5;e=1<<15;f=d|e;const SP2=[c|f,b|e,z|e,a|f,a|z,z|d,c|d,b|f,b|d,c|f,c|e,b|z,b|e,a|z,z|d,c|d,a|e,a|d,b|f,z|z,b|z,z|e,a|f,c|z,a|d,b|d,z|z,a|e,z|f,c|e,c|z,z|f,z|z,a|f,c|d,a|z,b|f,c|z,c|e,z|e,c|z,b|e,z|d,c|f,a|f,z|d,z|e,b|z,z|f,c|e,a|z,b|d,a|d,b|f,b|d,a|d,a|e,z|z,b|e,z|f,b|z,c|d,c|f,a|e];a=1<<17;b=1<<27;c=a|b;d=1<<3;e=1<<9;f=d|e;const SP3=[z|f,c|e,z|z,c|d,b|e,z|z,a|f,b|e,a|d,b|d,b|d,a|z,c|f,a|d,c|z,z|f,b|z,z|d,c|e,z|e,a|e,c|z,c|d,a|f,b|f,a|e,a|z,b|f,z|d,c|f,z|e,b|z,c|e,b|z,a|d,z|f,a|z,c|e,b|e,z|z,z|e,a|d,c|f,b|e,b|d,z|e,z|z,c|d,b|f,a|z,b|z,c|f,z|d,a|f,a|e,b|d,c|z,b|f,z|f,c|z,a|f,z|d,c|d,a|e];a=1<<13;b=1<<23;c=a|b;d=1<<0;e=1<<7;f=d|e;const SP4=[c|d,a|f,a|f,z|e,c|e,b|f,b|d,a|d,z|z,c|z,c|z,c|f,z|f,z|z,b|e,b|d,z|d,a|z,b|z,c|d,z|e,b|z,a|d,a|e,b|f,z|d,a|e,b|e,a|z,c|e,c|f,z|f,b|e,b|d,c|z,c|f,z|f,z|z,z|z,c|z,a|e,b|e,b|f,z|d,c|d,a|f,a|f,z|e,c|f,z|f,z|d,a|z,b|d,a|d,c|e,b|f,a|d,a|e,b|z,c|d,z|e,b|z,a|z,c|e];a=1<<25;b=1<<30;c=a|b;d=1<<8;e=1<<19;f=d|e;const SP5=[z|d,a|f,a|e,c|d,z|e,z|d,b|z,a|e,b|f,z|e,a|d,b|f,c|d,c|e,z|f,b|z,a|z,b|e,b|e,z|z,b|d,c|f,c|f,a|d,c|e,b|d,z|z,c|z,a|f,a|z,c|z,z|f,z|e,c|d,z|d,a|z,b|z,a|e,c|d,b|f,a|d,b|z,c|e,a|f,b|f,z|d,a|z,c|e,c|f,z|f,c|z,c|f,a|e,z|z,b|e,c|z,z|f,a|d,b|d,z|e,z|z,b|e,a|f,b|d];a=1<<22;b=1<<29;c=a|b;d=1<<4;e=1<<14;f=d|e;const SP6=[b|d,c|z,z|e,c|f,c|z,z|d,c|f,a|z,b|e,a|f,a|z,b|d,a|d,b|e,b|z,z|f,z|z,a|d,b|f,z|e,a|e,b|f,z|d,c|d,c|d,z|z,a|f,c|e,z|f,a|e,c|e,b|z,b|e,z|d,c|d,a|e,c|f,a|z,z|f,b|d,a|z,b|e,b|z,z|f,b|d,c|f,a|e,c|z,a|f,c|e,z|z,c|d,z|d,z|e,c|z,a|f,z|e,a|d,b|f,z|z,c|e,b|z,a|d,b|f];a=1<<21;b=1<<26;c=a|b;d=1<<1;e=1<<11;f=d|e;const SP7=[a|z,c|d,b|f,z|z,z|e,b|f,a|f,c|e,c|f,a|z,z|z,b|d,z|d,b|z,c|d,z|f,b|e,a|f,a|d,b|e,b|d,c|z,c|e,a|d,c|z,z|e,z|f,c|f,a|e,z|d,b|z,a|e,b|z,a|e,a|z,b|f,b|f,c|d,c|d,z|d,a|d,b|z,b|e,a|z,c|e,z|f,a|f,c|e,z|f,b|d,c|f,c|z,a|e,z|z,z|d,c|f,z|z,a|f,c|z,z|e,b|d,b|e,z|e,a|d];a=1<<18;b=1<<28;c=a|b;d=1<<6;e=1<<12;f=d|e;const SP8=[b|f,z|e,a|z,c|f,b|z,b|f,z|d,b|z,a|d,c|z,c|f,a|e,c|e,a|f,z|e,z|d,c|z,b|d,b|e,z|f,a|e,a|d,c|d,c|e,z|f,z|z,z|z,c|d,b|d,b|e,a|f,a|z,a|f,a|z,c|e,z|e,z|d,c|d,z|e,a|f,b|e,z|d,b|d,c|z,c|d,b|z,a|z,b|f,z|z,c|f,a|d,b|d,c|z,b|e,b|f,z|z,c|f,a|e,a|e,z|f,z|f,a|d,b|z,c|e];class DES{constructor(password){this.keys=[];const pc1m=[],pcr=[],kn=[];for(let j=0,l=56;j<56;++j,l-=8){l+=l<-5?65:l<-3?31:l<-1?63:l===27?35:0;const m=l&0x7;pc1m[j]=((password[l>>>3]&(1<<m))!==0)?1:0;}
for(let i=0;i<16;++i){const m=i<<1;const n=m+1;kn[m]=kn[n]=0;for(let o=28;o<59;o+=28){for(let j=o-28;j<o;++j){const l=j+totrot[i];pcr[j]=l<o?pc1m[l]:pc1m[l-28];}}
for(let j=0;j<24;++j){if(pcr[PC2[j]]!==0){kn[m]|=1<<(23-j);}
if(pcr[PC2[j+24]]!==0){kn[n]|=1<<(23-j);}}}
for(let i=0,rawi=0,KnLi=0;i<16;++i){const raw0=kn[rawi++];const raw1=kn[rawi++];this.keys[KnLi]=(raw0&0x00fc0000)<<6;this.keys[KnLi]|=(raw0&0x00000fc0)<<10;this.keys[KnLi]|=(raw1&0x00fc0000)>>>10;this.keys[KnLi]|=(raw1&0x00000fc0)>>>6;++KnLi;this.keys[KnLi]=(raw0&0x0003f000)<<12;this.keys[KnLi]|=(raw0&0x0000003f)<<16;this.keys[KnLi]|=(raw1&0x0003f000)>>>4;this.keys[KnLi]|=(raw1&0x0000003f);++KnLi;}}
enc8(text){const b=text.slice();let i=0,l,r,x;l=b[i++]<<24|b[i++]<<16|b[i++]<<8|b[i++];r=b[i++]<<24|b[i++]<<16|b[i++]<<8|b[i++];x=((l>>>4)^r)&0x0f0f0f0f;r^=x;l^=(x<<4);x=((l>>>16)^r)&0x0000ffff;r^=x;l^=(x<<16);x=((r>>>2)^l)&0x33333333;l^=x;r^=(x<<2);x=((r>>>8)^l)&0x00ff00ff;l^=x;r^=(x<<8);r=(r<<1)|((r>>>31)&1);x=(l^r)&0xaaaaaaaa;l^=x;r^=x;l=(l<<1)|((l>>>31)&1);for(let i=0,keysi=0;i<8;++i){x=(r<<28)|(r>>>4);x^=this.keys[keysi++];let fval=SP7[x&0x3f];fval|=SP5[(x>>>8)&0x3f];fval|=SP3[(x>>>16)&0x3f];fval|=SP1[(x>>>24)&0x3f];x=r^this.keys[keysi++];fval|=SP8[x&0x3f];fval|=SP6[(x>>>8)&0x3f];fval|=SP4[(x>>>16)&0x3f];fval|=SP2[(x>>>24)&0x3f];l^=fval;x=(l<<28)|(l>>>4);x^=this.keys[keysi++];fval=SP7[x&0x3f];fval|=SP5[(x>>>8)&0x3f];fval|=SP3[(x>>>16)&0x3f];fval|=SP1[(x>>>24)&0x3f];x=l^this.keys[keysi++];fval|=SP8[x&0x0000003f];fval|=SP6[(x>>>8)&0x3f];fval|=SP4[(x>>>16)&0x3f];fval|=SP2[(x>>>24)&0x3f];r^=fval;}
r=(r<<31)|(r>>>1);x=(l^r)&0xaaaaaaaa;l^=x;r^=x;l=(l<<31)|(l>>>1);x=((l>>>8)^r)&0x00ff00ff;r^=x;l^=(x<<8);x=((l>>>2)^r)&0x33333333;r^=x;l^=(x<<2);x=((r>>>16)^l)&0x0000ffff;l^=x;r^=(x<<16);x=((r>>>4)^l)&0x0f0f0f0f;l^=x;r^=(x<<4);x=[r,l];for(i=0;i<8;i++){b[i]=(x[i>>>2]>>>(8*(3-(i%4))))%256;if(b[i]<0){b[i]+=256;}}
return b;}
encrypt(t){return this.enc8(t.slice(0,8)).concat(this.enc8(t.slice(8,16)));}}
var XtScancode={"Again":0xe005,"AltLeft":0x38,"AltRight":0xe038,"ArrowDown":0xe050,"ArrowLeft":0xe04b,"ArrowRight":0xe04d,"ArrowUp":0xe048,"AudioVolumeDown":0xe02e,"AudioVolumeMute":0xe020,"AudioVolumeUp":0xe030,"Backquote":0x29,"Backslash":0x2b,"Backspace":0xe,"BracketLeft":0x1a,"BracketRight":0x1b,"BrowserBack":0xe06a,"BrowserFavorites":0xe066,"BrowserForward":0xe069,"BrowserHome":0xe032,"BrowserRefresh":0xe067,"BrowserSearch":0xe065,"BrowserStop":0xe068,"CapsLock":0x3a,"Comma":0x33,"ContextMenu":0xe05d,"ControlLeft":0x1d,"ControlRight":0xe01d,"Convert":0x79,"Copy":0xe078,"Cut":0xe03c,"Delete":0xe053,"Digit0":0xb,"Digit1":0x2,"Digit2":0x3,"Digit3":0x4,"Digit4":0x5,"Digit5":0x6,"Digit6":0x7,"Digit7":0x8,"Digit8":0x9,"Digit9":0xa,"Eject":0xe07d,"End":0xe04f,"Enter":0x1c,"Equal":0xd,"Escape":0x1,"F1":0x3b,"F10":0x44,"F11":0x57,"F12":0x58,"F13":0x5d,"F14":0x5e,"F15":0x5f,"F16":0x55,"F17":0xe003,"F18":0xe077,"F19":0xe004,"F2":0x3c,"F20":0x5a,"F21":0x74,"F22":0xe079,"F23":0x6d,"F24":0x6f,"F3":0x3d,"F4":0x3e,"F5":0x3f,"F6":0x40,"F7":0x41,"F8":0x42,"F9":0x43,"Find":0xe041,"Help":0xe075,"Hiragana":0x77,"Home":0xe047,"Insert":0xe052,"IntlBackslash":0x56,"IntlRo":0x73,"IntlYen":0x7d,"KanaMode":0x70,"Katakana":0x78,"KeyA":0x1e,"KeyB":0x30,"KeyC":0x2e,"KeyD":0x20,"KeyE":0x12,"KeyF":0x21,"KeyG":0x22,"KeyH":0x23,"KeyI":0x17,"KeyJ":0x24,"KeyK":0x25,"KeyL":0x26,"KeyM":0x32,"KeyN":0x31,"KeyO":0x18,"KeyP":0x19,"KeyQ":0x10,"KeyR":0x13,"KeyS":0x1f,"KeyT":0x14,"KeyU":0x16,"KeyV":0x2f,"KeyW":0x11,"KeyX":0x2d,"KeyY":0x15,"KeyZ":0x2c,"Lang3":0x78,"Lang4":0x77,"Lang5":0x76,"LaunchApp1":0xe06b,"LaunchApp2":0xe021,"LaunchMail":0xe06c,"MediaPlayPause":0xe022,"MediaSelect":0xe06d,"MediaStop":0xe024,"MediaTrackNext":0xe019,"MediaTrackPrevious":0xe010,"MetaLeft":0xe05b,"MetaRight":0xe05c,"Minus":0xc,"NonConvert":0x7b,"NumLock":0x45,"Numpad0":0x52,"Numpad1":0x4f,"Numpad2":0x50,"Numpad3":0x51,"Numpad4":0x4b,"Numpad5":0x4c,"Numpad6":0x4d,"Numpad7":0x47,"Numpad8":0x48,"Numpad9":0x49,"NumpadAdd":0x4e,"NumpadComma":0x7e,"NumpadDecimal":0x53,"NumpadDivide":0xe035,"NumpadEnter":0xe01c,"NumpadEqual":0x59,"NumpadMultiply":0x37,"NumpadParenLeft":0xe076,"NumpadParenRight":0xe07b,"NumpadSubtract":0x4a,"Open":0x64,"PageDown":0xe051,"PageUp":0xe049,"Paste":0x65,"Pause":0xe046,"Period":0x34,"Power":0xe05e,"PrintScreen":0x54,"Props":0xe006,"Quote":0x28,"ScrollLock":0x46,"Semicolon":0x27,"ShiftLeft":0x2a,"ShiftRight":0x36,"Slash":0x35,"Sleep":0xe05f,"Space":0x39,"Suspend":0xe025,"Tab":0xf,"Undo":0xe007,"WakeUp":0xe063,};const encodings={encodingRaw:0,encodingCopyRect:1,encodingRRE:2,encodingHextile:5,encodingTight:7,encodingTightPNG:-260,pseudoEncodingQualityLevel9:-23,pseudoEncodingQualityLevel0:-32,pseudoEncodingDesktopSize:-223,pseudoEncodingLastRect:-224,pseudoEncodingCursor:-239,pseudoEncodingQEMUExtendedKeyEvent:-258,pseudoEncodingDesktopName:-307,pseudoEncodingExtendedDesktopSize:-308,pseudoEncodingXvp:-309,pseudoEncodingFence:-312,pseudoEncodingContinuousUpdates:-313,pseudoEncodingCompressLevel9:-247,pseudoEncodingCompressLevel0:-256,pseudoEncodingVMwareCursor:0x574d5664,pseudoEncodingExtendedClipboard:0xc0a1e5ce};if(typeof Object.assign!='function'){Object.defineProperty(Object,"assign",{value:function assign(target,varArgs){if(target==null){throw new TypeError('Cannot convert undefined or null to object');}
const to=Object(target);for(let index=1;index<arguments.length;index++){const nextSource=arguments[index];if(nextSource!=null){for(let nextKey in nextSource){if(Object.prototype.hasOwnProperty.call(nextSource,nextKey)){to[nextKey]=nextSource[nextKey];}}}}
return to;},writable:true,configurable:true});}
(()=>{function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};const evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
CustomEvent.prototype=window.Event.prototype;if(typeof window.CustomEvent!=="function"){window.CustomEvent=CustomEvent;}})();Number.isInteger=Number.isInteger||function isInteger(value){return typeof value==='number'&&isFinite(value)&&Math.floor(value)===value;};class RawDecoder{constructor(){this._lines=0;}
decodeRect(x,y,width,height,sock,display,depth){if(this._lines===0){this._lines=height;}
const pixelSize=depth==8?1:4;const bytesPerLine=width*pixelSize;if(sock.rQwait("RAW",bytesPerLine)){return false;}
const cur_y=y+(height-this._lines);const curr_height=Math.min(this._lines,Math.floor(sock.rQlen/bytesPerLine));let data=sock.rQ;let index=sock.rQi;if(depth==8){const pixels=width*curr_height;const newdata=new Uint8Array(pixels*4);for(let i=0;i<pixels;i++){newdata[i*4+0]=((data[index+i]>>0)&0x3)*255/3;newdata[i*4+1]=((data[index+i]>>2)&0x3)*255/3;newdata[i*4+2]=((data[index+i]>>4)&0x3)*255/3;newdata[i*4+4]=0;}
data=newdata;index=0;}
display.blitImage(x,cur_y,width,curr_height,data,index);sock.rQskipBytes(curr_height*bytesPerLine);this._lines-=curr_height;if(this._lines>0){return false;}
return true;}}
class CopyRectDecoder{decodeRect(x,y,width,height,sock,display,depth){if(sock.rQwait("COPYRECT",4)){return false;}
let deltaX=sock.rQshift16();let deltaY=sock.rQshift16();display.copyImage(deltaX,deltaY,x,y,width,height);return true;}}
class RREDecoder{constructor(){this._subrects=0;}
decodeRect(x,y,width,height,sock,display,depth){if(this._subrects===0){if(sock.rQwait("RRE",4+4)){return false;}
this._subrects=sock.rQshift32();let color=sock.rQshiftBytes(4);display.fillRect(x,y,width,height,color);}
while(this._subrects>0){if(sock.rQwait("RRE",4+8)){return false;}
let color=sock.rQshiftBytes(4);let sx=sock.rQshift16();let sy=sock.rQshift16();let swidth=sock.rQshift16();let sheight=sock.rQshift16();display.fillRect(x+sx,y+sy,swidth,sheight,color);this._subrects--;}
return true;}}
class HextileDecoder{constructor(){this._tiles=0;this._lastsubencoding=0;}
decodeRect(x,y,width,height,sock,display,depth){if(this._tiles===0){this._tiles_x=Math.ceil(width/16);this._tiles_y=Math.ceil(height/16);this._total_tiles=this._tiles_x*this._tiles_y;this._tiles=this._total_tiles;}
while(this._tiles>0){let bytes=1;if(sock.rQwait("HEXTILE",bytes)){return false;}
let rQ=sock.rQ;let rQi=sock.rQi;let subencoding=rQ[rQi];if(subencoding>30){throw new Error("Illegal hextile subencoding (subencoding: "+
subencoding+")");}
const curr_tile=this._total_tiles-this._tiles;const tile_x=curr_tile%this._tiles_x;const tile_y=Math.floor(curr_tile/this._tiles_x);const tx=x+tile_x*16;const ty=y+tile_y*16;const tw=Math.min(16,(x+width)-tx);const th=Math.min(16,(y+height)-ty);if(subencoding&0x01){bytes+=tw*th*4;}else{if(subencoding&0x02){bytes+=4;}
if(subencoding&0x04){bytes+=4;}
if(subencoding&0x08){bytes++;if(sock.rQwait("HEXTILE",bytes)){return false;}
let subrects=rQ[rQi+bytes-1];if(subencoding&0x10){bytes+=subrects*(4+2);}else{bytes+=subrects*2;}}}
if(sock.rQwait("HEXTILE",bytes)){return false;}
rQi++;if(subencoding===0){if(this._lastsubencoding&0x01){Debug("     Ignoring blank after RAW");}else{display.fillRect(tx,ty,tw,th,this._background);}}else if(subencoding&0x01){display.blitImage(tx,ty,tw,th,rQ,rQi);rQi+=bytes-1;}else{if(subencoding&0x02){this._background=[rQ[rQi],rQ[rQi+1],rQ[rQi+2],rQ[rQi+3]];rQi+=4;}
if(subencoding&0x04){this._foreground=[rQ[rQi],rQ[rQi+1],rQ[rQi+2],rQ[rQi+3]];rQi+=4;}
display.startTile(tx,ty,tw,th,this._background);if(subencoding&0x08){let subrects=rQ[rQi];rQi++;for(let s=0;s<subrects;s++){let color;if(subencoding&0x10){color=[rQ[rQi],rQ[rQi+1],rQ[rQi+2],rQ[rQi+3]];rQi+=4;}else{color=this._foreground;}
const xy=rQ[rQi];rQi++;const sx=(xy>>4);const sy=(xy&0x0f);const wh=rQ[rQi];rQi++;const sw=(wh>>4)+1;const sh=(wh&0x0f)+1;display.subTile(sx,sy,sw,sh,color);}}
display.finishTile();}
sock.rQi=rQi;this._lastsubencoding=subencoding;this._tiles--;}
return true;}}
class TightDecoder{constructor(){this._ctl=null;this._filter=null;this._numColors=0;this._palette=new Uint8Array(1024);this._len=0;this._zlibs=[];for(let i=0;i<4;i++){this._zlibs[i]=new Inflate();}}
decodeRect(x,y,width,height,sock,display,depth){if(this._ctl===null){if(sock.rQwait("TIGHT compression-control",1)){return false;}
this._ctl=sock.rQshift8();for(let i=0;i<4;i++){if((this._ctl>>i)&1){this._zlibs[i].reset();Info("Reset zlib stream "+i);}}
this._ctl=this._ctl>>4;}
let ret;if(this._ctl===0x08){ret=this._fillRect(x,y,width,height,sock,display,depth);}else if(this._ctl===0x09){ret=this._jpegRect(x,y,width,height,sock,display,depth);}else if(this._ctl===0x0A){ret=this._pngRect(x,y,width,height,sock,display,depth);}else if((this._ctl&0x80)==0){ret=this._basicRect(this._ctl,x,y,width,height,sock,display,depth);}else{throw new Error("Illegal tight compression received (ctl: "+
this._ctl+")");}
if(ret){this._ctl=null;}
return ret;}
_fillRect(x,y,width,height,sock,display,depth){if(sock.rQwait("TIGHT",3)){return false;}
const rQi=sock.rQi;const rQ=sock.rQ;display.fillRect(x,y,width,height,[rQ[rQi+2],rQ[rQi+1],rQ[rQi]],false);sock.rQskipBytes(3);return true;}
_jpegRect(x,y,width,height,sock,display,depth){let data=this._readData(sock);if(data===null){return false;}
display.imageRect(x,y,width,height,"image/jpeg",data);return true;}
_pngRect(x,y,width,height,sock,display,depth){throw new Error("PNG received in standard Tight rect");}
_basicRect(ctl,x,y,width,height,sock,display,depth){if(this._filter===null){if(ctl&0x4){if(sock.rQwait("TIGHT",1)){return false;}
this._filter=sock.rQshift8();}else{this._filter=0;}}
let streamId=ctl&0x3;let ret;switch(this._filter){case 0:ret=this._copyFilter(streamId,x,y,width,height,sock,display,depth);break;case 1:ret=this._paletteFilter(streamId,x,y,width,height,sock,display,depth);break;case 2:ret=this._gradientFilter(streamId,x,y,width,height,sock,display,depth);break;default:throw new Error("Illegal tight filter received (ctl: "+
this._filter+")");}
if(ret){this._filter=null;}
return ret;}
_copyFilter(streamId,x,y,width,height,sock,display,depth){const uncompressedSize=width*height*3;let data;if(uncompressedSize<12){if(sock.rQwait("TIGHT",uncompressedSize)){return false;}
data=sock.rQshiftBytes(uncompressedSize);}else{data=this._readData(sock);if(data===null){return false;}
this._zlibs[streamId].setInput(data);data=this._zlibs[streamId].inflate(uncompressedSize);this._zlibs[streamId].setInput(null);}
display.blitRgbImage(x,y,width,height,data,0,false);return true;}
_paletteFilter(streamId,x,y,width,height,sock,display,depth){if(this._numColors===0){if(sock.rQwait("TIGHT palette",1)){return false;}
const numColors=sock.rQpeek8()+1;const paletteSize=numColors*3;if(sock.rQwait("TIGHT palette",1+paletteSize)){return false;}
this._numColors=numColors;sock.rQskipBytes(1);sock.rQshiftTo(this._palette,paletteSize);}
const bpp=(this._numColors<=2)?1:8;const rowSize=Math.floor((width*bpp+7)/8);const uncompressedSize=rowSize*height;let data;if(uncompressedSize<12){if(sock.rQwait("TIGHT",uncompressedSize)){return false;}
data=sock.rQshiftBytes(uncompressedSize);}else{data=this._readData(sock);if(data===null){return false;}
this._zlibs[streamId].setInput(data);data=this._zlibs[streamId].inflate(uncompressedSize);this._zlibs[streamId].setInput(null);}
if(this._numColors==2){this._monoRect(x,y,width,height,data,this._palette,display);}else{this._paletteRect(x,y,width,height,data,this._palette,display);}
this._numColors=0;return true;}
_monoRect(x,y,width,height,data,palette,display){const dest=this._getScratchBuffer(width*height*4);const w=Math.floor((width+7)/8);const w1=Math.floor(width/8);for(let y=0;y<height;y++){let dp,sp,x;for(x=0;x<w1;x++){for(let b=7;b>=0;b--){dp=(y*width+x*8+7-b)*4;sp=(data[y*w+x]>>b&1)*3;dest[dp]=palette[sp];dest[dp+1]=palette[sp+1];dest[dp+2]=palette[sp+2];dest[dp+3]=255;}}
for(let b=7;b>=8-width%8;b--){dp=(y*width+x*8+7-b)*4;sp=(data[y*w+x]>>b&1)*3;dest[dp]=palette[sp];dest[dp+1]=palette[sp+1];dest[dp+2]=palette[sp+2];dest[dp+3]=255;}}
display.blitRgbxImage(x,y,width,height,dest,0,false);}
_paletteRect(x,y,width,height,data,palette,display){const dest=this._getScratchBuffer(width*height*4);const total=width*height*4;for(let i=0,j=0;i<total;i+=4,j++){const sp=data[j]*3;dest[i]=palette[sp];dest[i+1]=palette[sp+1];dest[i+2]=palette[sp+2];dest[i+3]=255;}
display.blitRgbxImage(x,y,width,height,dest,0,false);}
_gradientFilter(streamId,x,y,width,height,sock,display,depth){throw new Error("Gradient filter not implemented");}
_readData(sock){if(this._len===0){if(sock.rQwait("TIGHT",3)){return null;}
let byte;byte=sock.rQshift8();this._len=byte&0x7f;if(byte&0x80){byte=sock.rQshift8();this._len|=(byte&0x7f)<<7;if(byte&0x80){byte=sock.rQshift8();this._len|=byte<<14;}}}
if(sock.rQwait("TIGHT",this._len)){return null;}
let data=sock.rQshiftBytes(this._len);this._len=0;return data;}
_getScratchBuffer(size){if(!this._scratchBuffer||(this._scratchBuffer.length<size)){this._scratchBuffer=new Uint8Array(size);}
return this._scratchBuffer;}}
class TightPNGDecoder extends TightDecoder{_pngRect(x,y,width,height,sock,display,depth){let data=this._readData(sock);if(data===null){return false;}
display.imageRect(x,y,width,height,"image/png",data);return true;}
_basicRect(ctl,x,y,width,height,sock,display,depth){throw new Error("BasicCompression received in TightPNG rect");}}
const DISCONNECT_TIMEOUT=3;const DEFAULT_BACKGROUND='rgb(40, 40, 40)';const extendedClipboardFormatText=1;const extendedClipboardActionCaps=1<<24;const extendedClipboardActionRequest=1<<25;const extendedClipboardActionPeek=1<<26;const extendedClipboardActionNotify=1<<27;const extendedClipboardActionProvide=1<<28;class RFB extends EventTargetMixin{constructor(target,url,options){if(!target){throw new Error("Must specify target");}
if(!url){throw new Error("Must specify URL");}
super();this._target=target;this._url=url;options=options||{};this._rfb_credentials=options.credentials||{};this._shared='shared'in options?!!options.shared:true;this._repeaterID=options.repeaterID||'';this._wsProtocols=options.wsProtocols||[];this._rfb_connection_state='';this._rfb_init_state='';this._rfb_auth_scheme=-1;this._rfb_clean_disconnect=true;this._rfb_version=0;this._rfb_max_version=3.8;this._rfb_tightvnc=false;this._rfb_vencrypt_state=0;this._rfb_xvp_ver=0;this._fb_width=0;this._fb_height=0;this._fb_name="";this._capabilities={power:false};this._supportsFence=false;this._supportsContinuousUpdates=false;this._enabledContinuousUpdates=false;this._supportsSetDesktopSize=false;this._screen_id=0;this._screen_flags=0;this._qemuExtKeyEventSupported=false;this._clipboardText=null;this._clipboardServerCapabilitiesActions={};this._clipboardServerCapabilitiesFormats={};this._sock=null;this._display=null;this._flushing=false;this._keyboard=null;this._mouse=null;this._disconnTimer=null;this._resizeTimeout=null;this._decoders={};this._FBU={rects:0,x:0,y:0,width:0,height:0,encoding:null,};this._mouse_buttonMask=0;this._mouse_arr=[];this._viewportDragging=false;this._viewportDragPos={};this._viewportHasMoved=false;this._eventHandlers={focusCanvas:this._focusCanvas.bind(this),windowResize:this._windowResize.bind(this),};Debug(">> RFB.constructor");this._screen=document.createElement('div');this._screen.style.display='flex';this._screen.style.width='100%';this._screen.style.height='100%';this._screen.style.overflow='auto';this._screen.style.background=DEFAULT_BACKGROUND;this._canvas=document.createElement('canvas');this._canvas.style.margin='auto';this._canvas.style.outline='none';this._canvas.style.flexShrink='0';this._canvas.width=0;this._canvas.height=0;this._canvas.tabIndex=-1;this._screen.appendChild(this._canvas);this._cursor=new Cursor();this._cursorImage=RFB.cursors.none;this._decoders[encodings.encodingRaw]=new RawDecoder();this._decoders[encodings.encodingCopyRect]=new CopyRectDecoder();this._decoders[encodings.encodingRRE]=new RREDecoder();this._decoders[encodings.encodingHextile]=new HextileDecoder();this._decoders[encodings.encodingTight]=new TightDecoder();this._decoders[encodings.encodingTightPNG]=new TightPNGDecoder();try{this._display=new Display(this._canvas);}catch(exc){Error$1("Display exception: "+exc);throw exc;}
this._display.onflush=this._onFlush.bind(this);this._keyboard=new Keyboard(this._canvas);this._keyboard.onkeyevent=this._handleKeyEvent.bind(this);this._mouse=new Mouse(this._canvas);this._mouse.onmousebutton=this._handleMouseButton.bind(this);this._mouse.onmousemove=this._handleMouseMove.bind(this);this._sock=new Websock();this._sock.on('message',()=>{this._handle_message();});this._sock.on('open',()=>{if((this._rfb_connection_state==='connecting')&&(this._rfb_init_state==='')){this._rfb_init_state='ProtocolVersion';Debug("Starting VNC handshake");}else{this._fail("Unexpected server connection while "+
this._rfb_connection_state);}});this._sock.on('close',(e)=>{Debug("WebSocket on-close event");let msg="";if(e.code){msg="(code: "+e.code;if(e.reason){msg+=", reason: "+e.reason;}
msg+=")";}
switch(this._rfb_connection_state){case 'connecting':this._fail("Connection closed "+msg);break;case 'connected':this._updateConnectionState('disconnecting');this._updateConnectionState('disconnected');break;case 'disconnecting':this._updateConnectionState('disconnected');break;case 'disconnected':this._fail("Unexpected server disconnect "+
"when already disconnected "+msg);break;default:this._fail("Unexpected server disconnect before connecting "+
msg);break;}
this._sock.off('close');});this._sock.on('error',e=>Warn("WebSocket on-error event"));setTimeout(this._updateConnectionState.bind(this,'connecting'));Debug("<< RFB.constructor");this.dragViewport=false;this.focusOnClick=true;this._viewOnly=false;this._clipViewport=false;this._scaleViewport=false;this._resizeSession=false;this._showDotCursor=false;if(options.showDotCursor!==undefined){Warn("Specifying showDotCursor as a RFB constructor argument is deprecated");this._showDotCursor=options.showDotCursor;}
this._qualityLevel=6;}
get viewOnly(){return this._viewOnly;}
set viewOnly(viewOnly){this._viewOnly=viewOnly;if(this._rfb_connection_state==="connecting"||this._rfb_connection_state==="connected"){if(viewOnly){this._keyboard.ungrab();this._mouse.ungrab();}else{this._keyboard.grab();this._mouse.grab();}}}
get capabilities(){return this._capabilities;}
get touchButton(){return this._mouse.touchButton;}
set touchButton(button){this._mouse.touchButton=button;}
get clipViewport(){return this._clipViewport;}
set clipViewport(viewport){this._clipViewport=viewport;this._updateClip();}
get scaleViewport(){return this._scaleViewport;}
set scaleViewport(scale){this._scaleViewport=scale;if(scale&&this._clipViewport){this._updateClip();}
this._updateScale();if(!scale&&this._clipViewport){this._updateClip();}}
get resizeSession(){return this._resizeSession;}
set resizeSession(resize){this._resizeSession=resize;if(resize){this._requestRemoteResize();}}
get showDotCursor(){return this._showDotCursor;}
set showDotCursor(show){this._showDotCursor=show;this._refreshCursor();}
get background(){return this._screen.style.background;}
set background(cssValue){this._screen.style.background=cssValue;}
get qualityLevel(){return this._qualityLevel;}
set qualityLevel(qualityLevel){if(!Number.isInteger(qualityLevel)||qualityLevel<0||qualityLevel>9){Error$1("qualityLevel must be an integer between 0 and 9");return;}
if(this._qualityLevel===qualityLevel){return;}
this._qualityLevel=qualityLevel;if(this._rfb_connection_state==='connected'){this._sendEncodings();}}
disconnect(){this._updateConnectionState('disconnecting');this._sock.off('error');this._sock.off('message');this._sock.off('open');}
sendCredentials(creds){this._rfb_credentials=creds;setTimeout(this._init_msg.bind(this),0);}
sendCtrlAltDel(){if(this._rfb_connection_state!=='connected'||this._viewOnly){return;}
Info("Sending Ctrl-Alt-Del");this.sendKey(KeyTable.XK_Control_L,"ControlLeft",true);this.sendKey(KeyTable.XK_Alt_L,"AltLeft",true);this.sendKey(KeyTable.XK_Delete,"Delete",true);this.sendKey(KeyTable.XK_Delete,"Delete",false);this.sendKey(KeyTable.XK_Alt_L,"AltLeft",false);this.sendKey(KeyTable.XK_Control_L,"ControlLeft",false);}
machineShutdown(){this._xvpOp(1,2);}
machineReboot(){this._xvpOp(1,3);}
machineReset(){this._xvpOp(1,4);}
sendKey(keysym,code,down){if(this._rfb_connection_state!=='connected'||this._viewOnly){return;}
if(down===undefined){this.sendKey(keysym,code,true);this.sendKey(keysym,code,false);return;}
const scancode=XtScancode[code];if(this._qemuExtKeyEventSupported&&scancode){keysym=keysym||0;Info("Sending key ("+(down?"down":"up")+"): keysym "+keysym+", scancode "+scancode);RFB.messages.QEMUExtendedKeyEvent(this._sock,keysym,down,scancode);}else{if(!keysym){return;}
Info("Sending keysym ("+(down?"down":"up")+"): "+keysym);RFB.messages.keyEvent(this._sock,keysym,down?1:0);}}
focus(){this._canvas.focus();}
blur(){this._canvas.blur();}
clipboardPasteFrom(text){if(this._rfb_connection_state!=='connected'||this._viewOnly){return;}
if(this._clipboardServerCapabilitiesFormats[extendedClipboardFormatText]&&this._clipboardServerCapabilitiesActions[extendedClipboardActionNotify]){this._clipboardText=text;RFB.messages.extendedClipboardNotify(this._sock,[extendedClipboardFormatText]);}else{let data=new Uint8Array(text.length);for(let i=0;i<text.length;i++){data[i]=text.charCodeAt(i);}
RFB.messages.clientCutText(this._sock,data);}}
_connect(){Debug(">> RFB.connect");Info("connecting to "+this._url);try{this._sock.open(this._url,this._wsProtocols);}catch(e){if(e.name==='SyntaxError'){this._fail("Invalid host or port ("+e+")");}else{this._fail("Error when opening socket ("+e+")");}}
this._target.appendChild(this._screen);this._cursor.attach(this._canvas);this._refreshCursor();window.addEventListener('resize',this._eventHandlers.windowResize);this._canvas.addEventListener("mousedown",this._eventHandlers.focusCanvas);this._canvas.addEventListener("touchstart",this._eventHandlers.focusCanvas);Debug("<< RFB.connect");}
_disconnect(){Debug(">> RFB.disconnect");this._cursor.detach();this._canvas.removeEventListener("mousedown",this._eventHandlers.focusCanvas);this._canvas.removeEventListener("touchstart",this._eventHandlers.focusCanvas);window.removeEventListener('resize',this._eventHandlers.windowResize);this._keyboard.ungrab();this._mouse.ungrab();this._sock.close();try{this._target.removeChild(this._screen);}catch(e){if(e.name==='NotFoundError');else{throw e;}}
clearTimeout(this._resizeTimeout);Debug("<< RFB.disconnect");}
_focusCanvas(event){if(event.defaultPrevented){return;}
if(!this.focusOnClick){return;}
this.focus();}
_setDesktopName(name){this._fb_name=name;this.dispatchEvent(new CustomEvent("desktopname",{detail:{name:this._fb_name}}));}
_windowResize(event){window.requestAnimationFrame(()=>{this._updateClip();this._updateScale();});if(this._resizeSession){clearTimeout(this._resizeTimeout);this._resizeTimeout=setTimeout(this._requestRemoteResize.bind(this),500);}}
_updateClip(){const cur_clip=this._display.clipViewport;let new_clip=this._clipViewport;if(this._scaleViewport){new_clip=false;}
if(cur_clip!==new_clip){this._display.clipViewport=new_clip;}
if(new_clip){const size=this._screenSize();this._display.viewportChangeSize(size.w,size.h);this._fixScrollbars();}}
_updateScale(){if(!this._scaleViewport){this._display.scale=1.0;}else{const size=this._screenSize();this._display.autoscale(size.w,size.h);}
this._fixScrollbars();}
_requestRemoteResize(){clearTimeout(this._resizeTimeout);this._resizeTimeout=null;if(!this._resizeSession||this._viewOnly||!this._supportsSetDesktopSize){return;}
const size=this._screenSize();RFB.messages.setDesktopSize(this._sock,Math.floor(size.w),Math.floor(size.h),this._screen_id,this._screen_flags);Debug('Requested new desktop size: '+
size.w+'x'+size.h);}
_screenSize(){let r=this._screen.getBoundingClientRect();return{w:r.width,h:r.height};}
_fixScrollbars(){const orig=this._screen.style.overflow;this._screen.style.overflow='hidden';this._screen.getBoundingClientRect();this._screen.style.overflow=orig;}
_updateConnectionState(state){const oldstate=this._rfb_connection_state;if(state===oldstate){Debug("Already in state '"+state+"', ignoring");return;}
if(oldstate==='disconnected'){Error$1("Tried changing state of a disconnected RFB object");return;}
switch(state){case 'connected':if(oldstate!=='connecting'){Error$1("Bad transition to connected state, "+
"previous connection state: "+oldstate);return;}
break;case 'disconnected':if(oldstate!=='disconnecting'){Error$1("Bad transition to disconnected state, "+
"previous connection state: "+oldstate);return;}
break;case 'connecting':if(oldstate!==''){Error$1("Bad transition to connecting state, "+
"previous connection state: "+oldstate);return;}
break;case 'disconnecting':if(oldstate!=='connected'&&oldstate!=='connecting'){Error$1("Bad transition to disconnecting state, "+
"previous connection state: "+oldstate);return;}
break;default:Error$1("Unknown connection state: "+state);return;}
this._rfb_connection_state=state;Debug("New state '"+state+"', was '"+oldstate+"'.");if(this._disconnTimer&&state!=='disconnecting'){Debug("Clearing disconnect timer");clearTimeout(this._disconnTimer);this._disconnTimer=null;this._sock.off('close');}
switch(state){case 'connecting':this._connect();break;case 'connected':this.dispatchEvent(new CustomEvent("connect",{detail:{}}));break;case 'disconnecting':this._disconnect();this._disconnTimer=setTimeout(()=>{Error$1("Disconnection timed out.");this._updateConnectionState('disconnected');},DISCONNECT_TIMEOUT*1000);break;case 'disconnected':this.dispatchEvent(new CustomEvent("disconnect",{detail:{clean:this._rfb_clean_disconnect}}));break;}}
_fail(details){switch(this._rfb_connection_state){case 'disconnecting':Error$1("Failed when disconnecting: "+details);break;case 'connected':Error$1("Failed while connected: "+details);break;case 'connecting':Error$1("Failed when connecting: "+details);break;default:Error$1("RFB failure: "+details);break;}
this._rfb_clean_disconnect=false;this._updateConnectionState('disconnecting');this._updateConnectionState('disconnected');return false;}
_setCapability(cap,val){this._capabilities[cap]=val;this.dispatchEvent(new CustomEvent("capabilities",{detail:{capabilities:this._capabilities}}));}
_handle_message(){if(this._sock.rQlen===0){Warn("handle_message called on an empty receive queue");return;}
switch(this._rfb_connection_state){case 'disconnected':Error$1("Got data while disconnected");break;case 'connected':while(true){if(this._flushing){break;}
if(!this._normal_msg()){break;}
if(this._sock.rQlen===0){break;}}
break;default:this._init_msg();break;}}
_handleKeyEvent(keysym,code,down){this.sendKey(keysym,code,down);}
_handleMouseButton(x,y,down,bmask){if(down){this._mouse_buttonMask|=bmask;}else{this._mouse_buttonMask&=~bmask;}
if(this.dragViewport){if(down&&!this._viewportDragging){this._viewportDragging=true;this._viewportDragPos={'x':x,'y':y};this._viewportHasMoved=false;return;}else{this._viewportDragging=false;if(this._viewportHasMoved){return;}
RFB.messages.pointerEvent(this._sock,this._display.absX(x),this._display.absY(y),bmask);}}
if(this._viewOnly){return;}
if(this._rfb_connection_state!=='connected'){return;}
RFB.messages.pointerEvent(this._sock,this._display.absX(x),this._display.absY(y),this._mouse_buttonMask);}
_handleMouseMove(x,y){if(this._viewportDragging){const deltaX=this._viewportDragPos.x-x;const deltaY=this._viewportDragPos.y-y;if(this._viewportHasMoved||(Math.abs(deltaX)>dragThreshold||Math.abs(deltaY)>dragThreshold)){this._viewportHasMoved=true;this._viewportDragPos={'x':x,'y':y};this._display.viewportChangePos(deltaX,deltaY);}
return;}
if(this._viewOnly){return;}
if(this._rfb_connection_state!=='connected'){return;}
RFB.messages.pointerEvent(this._sock,this._display.absX(x),this._display.absY(y),this._mouse_buttonMask);}
_negotiate_protocol_version(){if(this._sock.rQwait("version",12)){return false;}
const sversion=this._sock.rQshiftStr(12).substr(4,7);Info("Server ProtocolVersion: "+sversion);let is_repeater=0;switch(sversion){case "000.000":is_repeater=1;break;case "003.003":case "003.006":case "003.889":this._rfb_version=3.3;break;case "003.007":this._rfb_version=3.7;break;case "003.008":case "004.000":case "004.001":case "005.000":this._rfb_version=3.8;break;default:return this._fail("Invalid server version "+sversion);}
if(is_repeater){let repeaterID="ID:"+this._repeaterID;while(repeaterID.length<250){repeaterID+="\0";}
this._sock.send_string(repeaterID);return true;}
if(this._rfb_version>this._rfb_max_version){this._rfb_version=this._rfb_max_version;}
const cversion="00"+parseInt(this._rfb_version,10)+
".00"+((this._rfb_version*10)%10);this._sock.send_string("RFB "+cversion+"\n");Debug('Sent ProtocolVersion: '+cversion);this._rfb_init_state='Security';}
_negotiate_security(){function includes(item,array){for(let i=0;i<array.length;i++){if(array[i]===item){return true;}}
return false;}
if(this._rfb_version>=3.7){const num_types=this._sock.rQshift8();if(this._sock.rQwait("security type",num_types,1)){return false;}
if(num_types===0){this._rfb_init_state="SecurityReason";this._security_context="no security types";this._security_status=1;return this._init_msg();}
const types=this._sock.rQshiftBytes(num_types);Debug("Server security types: "+types);if(includes(1,types)){this._rfb_auth_scheme=1;}else if(includes(22,types)){this._rfb_auth_scheme=22;}else if(includes(16,types)){this._rfb_auth_scheme=16;}else if(includes(2,types)){this._rfb_auth_scheme=2;}else if(includes(19,types)){this._rfb_auth_scheme=19;}else{return this._fail("Unsupported security types (types: "+types+")");}
this._sock.send([this._rfb_auth_scheme]);}else{if(this._sock.rQwait("security scheme",4)){return false;}
this._rfb_auth_scheme=this._sock.rQshift32();if(this._rfb_auth_scheme==0){this._rfb_init_state="SecurityReason";this._security_context="authentication scheme";this._security_status=1;return this._init_msg();}}
this._rfb_init_state='Authentication';Debug('Authenticating using scheme: '+this._rfb_auth_scheme);return this._init_msg();}
_handle_security_reason(){if(this._sock.rQwait("reason length",4)){return false;}
const strlen=this._sock.rQshift32();let reason="";if(strlen>0){if(this._sock.rQwait("reason",strlen,4)){return false;}
reason=this._sock.rQshiftStr(strlen);}
if(reason!==""){this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._security_status,reason:reason}}));return this._fail("Security negotiation failed on "+
this._security_context+
" (reason: "+reason+")");}else{this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._security_status}}));return this._fail("Security negotiation failed on "+
this._security_context);}}
_negotiate_xvp_auth(){if(this._rfb_credentials.username===undefined||this._rfb_credentials.password===undefined||this._rfb_credentials.target===undefined){this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password","target"]}}));return false;}
const xvp_auth_str=String.fromCharCode(this._rfb_credentials.username.length)+
String.fromCharCode(this._rfb_credentials.target.length)+
this._rfb_credentials.username+
this._rfb_credentials.target;this._sock.send_string(xvp_auth_str);this._rfb_auth_scheme=2;return this._negotiate_authentication();}
_negotiate_vencrypt_auth(){if(this._rfb_vencrypt_state==0){if(this._sock.rQwait("vencrypt version",2)){return false;}
const major=this._sock.rQshift8();const minor=this._sock.rQshift8();if(!(major==0&&minor==2)){return this._fail("Unsupported VeNCrypt version "+major+"."+minor);}
this._sock.send([0,2]);this._rfb_vencrypt_state=1;}
if(this._rfb_vencrypt_state==1){if(this._sock.rQwait("vencrypt ack",1)){return false;}
const res=this._sock.rQshift8();if(res!=0){return this._fail("VeNCrypt failure "+res);}
this._rfb_vencrypt_state=2;}
if(this._rfb_vencrypt_state==2){if(this._sock.rQwait("vencrypt subtypes length",1)){return false;}
const subtypes_length=this._sock.rQshift8();if(subtypes_length<1){return this._fail("VeNCrypt subtypes empty");}
this._rfb_vencrypt_subtypes_length=subtypes_length;this._rfb_vencrypt_state=3;}
if(this._rfb_vencrypt_state==3){if(this._sock.rQwait("vencrypt subtypes",4*this._rfb_vencrypt_subtypes_length)){return false;}
const subtypes=[];for(let i=0;i<this._rfb_vencrypt_subtypes_length;i++){subtypes.push(this._sock.rQshift32());}
if(subtypes.indexOf(256)!=-1){this._sock.send([0,0,1,0]);this._rfb_vencrypt_state=4;}else{return this._fail("VeNCrypt Plain subtype not offered by server");}}
if(this._rfb_vencrypt_state==4){if(!this._rfb_credentials.username||!this._rfb_credentials.password){this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}}));return false;}
const user=encodeUTF8(this._rfb_credentials.username);const pass=encodeUTF8(this._rfb_credentials.password);this._sock.send([0,0,0,user.length]);this._sock.send([0,0,0,pass.length]);this._sock.send_string(user);this._sock.send_string(pass);this._rfb_init_state="SecurityResult";return true;}}
_negotiate_std_vnc_auth(){if(this._sock.rQwait("auth challenge",16)){return false;}
if(this._rfb_credentials.password===undefined){this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}}));return false;}
const challenge=Array.prototype.slice.call(this._sock.rQshiftBytes(16));const response=RFB.genDES(this._rfb_credentials.password,challenge);this._sock.send(response);this._rfb_init_state="SecurityResult";return true;}
_negotiate_tight_unix_auth(){if(this._rfb_credentials.username===undefined||this._rfb_credentials.password===undefined){this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}}));return false;}
this._sock.send([0,0,0,this._rfb_credentials.username.length]);this._sock.send([0,0,0,this._rfb_credentials.password.length]);this._sock.send_string(this._rfb_credentials.username);this._sock.send_string(this._rfb_credentials.password);this._rfb_init_state="SecurityResult";return true;}
_negotiate_tight_tunnels(numTunnels){const clientSupportedTunnelTypes={0:{vendor:'TGHT',signature:'NOTUNNEL'}};const serverSupportedTunnelTypes={};for(let i=0;i<numTunnels;i++){const cap_code=this._sock.rQshift32();const cap_vendor=this._sock.rQshiftStr(4);const cap_signature=this._sock.rQshiftStr(8);serverSupportedTunnelTypes[cap_code]={vendor:cap_vendor,signature:cap_signature};}
Debug("Server Tight tunnel types: "+serverSupportedTunnelTypes);if(serverSupportedTunnelTypes[1]&&(serverSupportedTunnelTypes[1].vendor==="SICR")&&(serverSupportedTunnelTypes[1].signature==="SCHANNEL")){Debug("Detected Siemens server. Assuming NOTUNNEL support.");serverSupportedTunnelTypes[0]={vendor:'TGHT',signature:'NOTUNNEL'};}
if(serverSupportedTunnelTypes[0]){if(serverSupportedTunnelTypes[0].vendor!=clientSupportedTunnelTypes[0].vendor||serverSupportedTunnelTypes[0].signature!=clientSupportedTunnelTypes[0].signature){return this._fail("Client's tunnel type had the incorrect "+
"vendor or signature");}
Debug("Selected tunnel type: "+clientSupportedTunnelTypes[0]);this._sock.send([0,0,0,0]);return false;}else{return this._fail("Server wanted tunnels, but doesn't support "+
"the notunnel type");}}
_negotiate_tight_auth(){if(!this._rfb_tightvnc){if(this._sock.rQwait("num tunnels",4)){return false;}
const numTunnels=this._sock.rQshift32();if(numTunnels>0&&this._sock.rQwait("tunnel capabilities",16*numTunnels,4)){return false;}
this._rfb_tightvnc=true;if(numTunnels>0){this._negotiate_tight_tunnels(numTunnels);return false;}}
if(this._sock.rQwait("sub auth count",4)){return false;}
const subAuthCount=this._sock.rQshift32();if(subAuthCount===0){this._rfb_init_state='SecurityResult';return true;}
if(this._sock.rQwait("sub auth capabilities",16*subAuthCount,4)){return false;}
const clientSupportedTypes={'STDVNOAUTH__':1,'STDVVNCAUTH_':2,'TGHTULGNAUTH':129};const serverSupportedTypes=[];for(let i=0;i<subAuthCount;i++){this._sock.rQshift32();const capabilities=this._sock.rQshiftStr(12);serverSupportedTypes.push(capabilities);}
Debug("Server Tight authentication types: "+serverSupportedTypes);for(let authType in clientSupportedTypes){if(serverSupportedTypes.indexOf(authType)!=-1){this._sock.send([0,0,0,clientSupportedTypes[authType]]);Debug("Selected authentication type: "+authType);switch(authType){case 'STDVNOAUTH__':this._rfb_init_state='SecurityResult';return true;case 'STDVVNCAUTH_':this._rfb_auth_scheme=2;return this._init_msg();case 'TGHTULGNAUTH':this._rfb_auth_scheme=129;return this._init_msg();default:return this._fail("Unsupported tiny auth scheme "+
"(scheme: "+authType+")");}}}
return this._fail("No supported sub-auth types!");}
_negotiate_authentication(){switch(this._rfb_auth_scheme){case 1:if(this._rfb_version>=3.8){this._rfb_init_state='SecurityResult';return true;}
this._rfb_init_state='ClientInitialisation';return this._init_msg();case 22:return this._negotiate_xvp_auth();case 2:return this._negotiate_std_vnc_auth();case 16:return this._negotiate_tight_auth();case 19:return this._negotiate_vencrypt_auth();case 129:return this._negotiate_tight_unix_auth();default:return this._fail("Unsupported auth scheme (scheme: "+
this._rfb_auth_scheme+")");}}
_handle_security_result(){if(this._sock.rQwait('VNC auth response ',4)){return false;}
const status=this._sock.rQshift32();if(status===0){this._rfb_init_state='ClientInitialisation';Debug('Authentication OK');return this._init_msg();}else{if(this._rfb_version>=3.8){this._rfb_init_state="SecurityReason";this._security_context="security result";this._security_status=status;return this._init_msg();}else{this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:status}}));return this._fail("Security handshake failed");}}}
_negotiate_server_init(){if(this._sock.rQwait("server initialization",24)){return false;}
const width=this._sock.rQshift16();const height=this._sock.rQshift16();const bpp=this._sock.rQshift8();const depth=this._sock.rQshift8();const big_endian=this._sock.rQshift8();const true_color=this._sock.rQshift8();const red_max=this._sock.rQshift16();const green_max=this._sock.rQshift16();const blue_max=this._sock.rQshift16();const red_shift=this._sock.rQshift8();const green_shift=this._sock.rQshift8();const blue_shift=this._sock.rQshift8();this._sock.rQskipBytes(3);const name_length=this._sock.rQshift32();if(this._sock.rQwait('server init name',name_length,24)){return false;}
let name=this._sock.rQshiftStr(name_length);name=decodeUTF8(name,true);if(this._rfb_tightvnc){if(this._sock.rQwait('TightVNC extended server init header',8,24+name_length)){return false;}
const numServerMessages=this._sock.rQshift16();const numClientMessages=this._sock.rQshift16();const numEncodings=this._sock.rQshift16();this._sock.rQskipBytes(2);const totalMessagesLength=(numServerMessages+numClientMessages+numEncodings)*16;if(this._sock.rQwait('TightVNC extended server init header',totalMessagesLength,32+name_length)){return false;}
this._sock.rQskipBytes(16*numServerMessages);this._sock.rQskipBytes(16*numClientMessages);this._sock.rQskipBytes(16*numEncodings);}
Info("Screen: "+width+"x"+height+
", bpp: "+bpp+", depth: "+depth+
", big_endian: "+big_endian+
", true_color: "+true_color+
", red_max: "+red_max+
", green_max: "+green_max+
", blue_max: "+blue_max+
", red_shift: "+red_shift+
", green_shift: "+green_shift+
", blue_shift: "+blue_shift);this._setDesktopName(name);this._resize(width,height);if(!this._viewOnly){this._keyboard.grab();}
if(!this._viewOnly){this._mouse.grab();}
this._fb_depth=24;if(this._fb_name==="Intel(r) AMT KVM"){Warn("Intel AMT KVM only supports 8/16 bit depths. Using low color mode.");this._fb_depth=8;}
RFB.messages.pixelFormat(this._sock,this._fb_depth,true);this._sendEncodings();RFB.messages.fbUpdateRequest(this._sock,false,0,0,this._fb_width,this._fb_height);this._updateConnectionState('connected');return true;}
_sendEncodings(){const encs=[];encs.push(encodings.encodingCopyRect);if(this._fb_depth==24){encs.push(encodings.encodingTight);encs.push(encodings.encodingTightPNG);encs.push(encodings.encodingHextile);encs.push(encodings.encodingRRE);}
encs.push(encodings.encodingRaw);encs.push(encodings.pseudoEncodingQualityLevel0+this._qualityLevel);encs.push(encodings.pseudoEncodingCompressLevel0+2);encs.push(encodings.pseudoEncodingDesktopSize);encs.push(encodings.pseudoEncodingLastRect);encs.push(encodings.pseudoEncodingQEMUExtendedKeyEvent);encs.push(encodings.pseudoEncodingExtendedDesktopSize);encs.push(encodings.pseudoEncodingXvp);encs.push(encodings.pseudoEncodingFence);encs.push(encodings.pseudoEncodingContinuousUpdates);encs.push(encodings.pseudoEncodingDesktopName);encs.push(encodings.pseudoEncodingExtendedClipboard);if(this._fb_depth==24){encs.push(encodings.pseudoEncodingVMwareCursor);encs.push(encodings.pseudoEncodingCursor);}
RFB.messages.clientEncodings(this._sock,encs);}
_init_msg(){switch(this._rfb_init_state){case 'ProtocolVersion':return this._negotiate_protocol_version();case 'Security':return this._negotiate_security();case 'Authentication':return this._negotiate_authentication();case 'SecurityResult':return this._handle_security_result();case 'SecurityReason':return this._handle_security_reason();case 'ClientInitialisation':this._sock.send([this._shared?1:0]);this._rfb_init_state='ServerInitialisation';return true;case 'ServerInitialisation':return this._negotiate_server_init();default:return this._fail("Unknown init state (state: "+
this._rfb_init_state+")");}}
_handle_set_colour_map_msg(){Debug("SetColorMapEntries");return this._fail("Unexpected SetColorMapEntries message");}
_handle_server_cut_text(){Debug("ServerCutText");if(this._sock.rQwait("ServerCutText header",7,1)){return false;}
this._sock.rQskipBytes(3);let length=this._sock.rQshift32();length=toSigned32bit(length);if(this._sock.rQwait("ServerCutText content",Math.abs(length),8)){return false;}
if(length>=0){const text=this._sock.rQshiftStr(length);if(this._viewOnly){return true;}
this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:text}}));}else{length=Math.abs(length);const flags=this._sock.rQshift32();let formats=flags&0x0000FFFF;let actions=flags&0xFF000000;let isCaps=(!!(actions&extendedClipboardActionCaps));if(isCaps){this._clipboardServerCapabilitiesFormats={};this._clipboardServerCapabilitiesActions={};for(let i=0;i<=15;i++){let index=1<<i;if((formats&index)){this._clipboardServerCapabilitiesFormats[index]=true;this._sock.rQshift32();}}
for(let i=24;i<=31;i++){let index=1<<i;this._clipboardServerCapabilitiesActions[index]=!!(actions&index);}
let clientActions=[extendedClipboardActionCaps,extendedClipboardActionRequest,extendedClipboardActionPeek,extendedClipboardActionNotify,extendedClipboardActionProvide];RFB.messages.extendedClipboardCaps(this._sock,clientActions,{extendedClipboardFormatText:0});}else if(actions===extendedClipboardActionRequest){if(this._viewOnly){return true;}
if(this._clipboardText!=null&&this._clipboardServerCapabilitiesActions[extendedClipboardActionProvide]){if(formats&extendedClipboardFormatText){RFB.messages.extendedClipboardProvide(this._sock,[extendedClipboardFormatText],[this._clipboardText]);}}}else if(actions===extendedClipboardActionPeek){if(this._viewOnly){return true;}
if(this._clipboardServerCapabilitiesActions[extendedClipboardActionNotify]){if(this._clipboardText!=null){RFB.messages.extendedClipboardNotify(this._sock,[extendedClipboardFormatText]);}else{RFB.messages.extendedClipboardNotify(this._sock,[]);}}}else if(actions===extendedClipboardActionNotify){if(this._viewOnly){return true;}
if(this._clipboardServerCapabilitiesActions[extendedClipboardActionRequest]){if(formats&extendedClipboardFormatText){RFB.messages.extendedClipboardRequest(this._sock,[extendedClipboardFormatText]);}}}else if(actions===extendedClipboardActionProvide){if(this._viewOnly){return true;}
if(!(formats&extendedClipboardFormatText)){return true;}
this._clipboardText=null;let zlibStream=this._sock.rQshiftBytes(length-4);let streamInflator=new Inflate();let textData=null;streamInflator.setInput(zlibStream);for(let i=0;i<=15;i++){let format=1<<i;if(formats&format){let size=0x00;let sizeArray=streamInflator.inflate(4);size|=(sizeArray[0]<<24);size|=(sizeArray[1]<<16);size|=(sizeArray[2]<<8);size|=(sizeArray[3]);let chunk=streamInflator.inflate(size);if(format===extendedClipboardFormatText){textData=chunk;}}}
streamInflator.setInput(null);if(textData!==null){let tmpText="";for(let i=0;i<textData.length;i++){tmpText+=String.fromCharCode(textData[i]);}
textData=tmpText;textData=decodeUTF8(textData);if((textData.length>0)&&"\0"===textData.charAt(textData.length-1)){textData=textData.slice(0,-1);}
textData=textData.replace("\r\n","\n");this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:textData}}));}}else{return this._fail("Unexpected action in extended clipboard message: "+actions);}}
return true;}
_handle_server_fence_msg(){if(this._sock.rQwait("ServerFence header",8,1)){return false;}
this._sock.rQskipBytes(3);let flags=this._sock.rQshift32();let length=this._sock.rQshift8();if(this._sock.rQwait("ServerFence payload",length,9)){return false;}
if(length>64){Warn("Bad payload length ("+length+") in fence response");length=64;}
const payload=this._sock.rQshiftStr(length);this._supportsFence=true;if(!(flags&(1<<31))){return this._fail("Unexpected fence response");}
flags&=(1<<0)|(1<<1);RFB.messages.clientFence(this._sock,flags,payload);return true;}
_handle_xvp_msg(){if(this._sock.rQwait("XVP version and message",3,1)){return false;}
this._sock.rQskipBytes(1);const xvp_ver=this._sock.rQshift8();const xvp_msg=this._sock.rQshift8();switch(xvp_msg){case 0:Error$1("XVP Operation Failed");break;case 1:this._rfb_xvp_ver=xvp_ver;Info("XVP extensions enabled (version "+this._rfb_xvp_ver+")");this._setCapability("power",true);break;default:this._fail("Illegal server XVP message (msg: "+xvp_msg+")");break;}
return true;}
_normal_msg(){let msg_type;if(this._FBU.rects>0){msg_type=0;}else{msg_type=this._sock.rQshift8();}
let first,ret;switch(msg_type){case 0:ret=this._framebufferUpdate();if(ret&&!this._enabledContinuousUpdates){RFB.messages.fbUpdateRequest(this._sock,true,0,0,this._fb_width,this._fb_height);}
return ret;case 1:return this._handle_set_colour_map_msg();case 2:Debug("Bell");this.dispatchEvent(new CustomEvent("bell",{detail:{}}));return true;case 3:return this._handle_server_cut_text();case 150:first=!this._supportsContinuousUpdates;this._supportsContinuousUpdates=true;this._enabledContinuousUpdates=false;if(first){this._enabledContinuousUpdates=true;this._updateContinuousUpdates();Info("Enabling continuous updates.");}
return true;case 248:return this._handle_server_fence_msg();case 250:return this._handle_xvp_msg();default:this._fail("Unexpected server message (type "+msg_type+")");Debug("sock.rQslice(0, 30): "+this._sock.rQslice(0,30));return true;}}
_onFlush(){this._flushing=false;if(this._sock.rQlen>0){this._handle_message();}}
_framebufferUpdate(){if(this._FBU.rects===0){if(this._sock.rQwait("FBU header",3,1)){return false;}
this._sock.rQskipBytes(1);this._FBU.rects=this._sock.rQshift16();if(this._display.pending()){this._flushing=true;this._display.flush();return false;}}
while(this._FBU.rects>0){if(this._FBU.encoding===null){if(this._sock.rQwait("rect header",12)){return false;}
const hdr=this._sock.rQshiftBytes(12);this._FBU.x=(hdr[0]<<8)+hdr[1];this._FBU.y=(hdr[2]<<8)+hdr[3];this._FBU.width=(hdr[4]<<8)+hdr[5];this._FBU.height=(hdr[6]<<8)+hdr[7];this._FBU.encoding=parseInt((hdr[8]<<24)+(hdr[9]<<16)+
(hdr[10]<<8)+hdr[11],10);}
if(!this._handleRect()){return false;}
this._FBU.rects--;this._FBU.encoding=null;}
this._display.flip();return true;}
_handleRect(){switch(this._FBU.encoding){case encodings.pseudoEncodingLastRect:this._FBU.rects=1;return true;case encodings.pseudoEncodingVMwareCursor:return this._handleVMwareCursor();case encodings.pseudoEncodingCursor:return this._handleCursor();case encodings.pseudoEncodingQEMUExtendedKeyEvent:try{const keyboardEvent=document.createEvent("keyboardEvent");if(keyboardEvent.code!==undefined){this._qemuExtKeyEventSupported=true;}}catch(err){}
return true;case encodings.pseudoEncodingDesktopName:return this._handleDesktopName();case encodings.pseudoEncodingDesktopSize:this._resize(this._FBU.width,this._FBU.height);return true;case encodings.pseudoEncodingExtendedDesktopSize:return this._handleExtendedDesktopSize();default:return this._handleDataRect();}}
_handleVMwareCursor(){const hotx=this._FBU.x;const hoty=this._FBU.y;const w=this._FBU.width;const h=this._FBU.height;if(this._sock.rQwait("VMware cursor encoding",1)){return false;}
const cursor_type=this._sock.rQshift8();this._sock.rQshift8();let rgba;const bytesPerPixel=4;if(cursor_type==0){const PIXEL_MASK=0xffffff00|0;rgba=new Array(w*h*bytesPerPixel);if(this._sock.rQwait("VMware cursor classic encoding",(w*h*bytesPerPixel)*2,2)){return false;}
let and_mask=new Array(w*h);for(let pixel=0;pixel<(w*h);pixel++){and_mask[pixel]=this._sock.rQshift32();}
let xor_mask=new Array(w*h);for(let pixel=0;pixel<(w*h);pixel++){xor_mask[pixel]=this._sock.rQshift32();}
for(let pixel=0;pixel<(w*h);pixel++){if(and_mask[pixel]==0){let bgr=xor_mask[pixel];let r=bgr>>8&0xff;let g=bgr>>16&0xff;let b=bgr>>24&0xff;rgba[(pixel*bytesPerPixel)]=r;rgba[(pixel*bytesPerPixel)+1]=g;rgba[(pixel*bytesPerPixel)+2]=b;rgba[(pixel*bytesPerPixel)+3]=0xff;}else if((and_mask[pixel]&PIXEL_MASK)==PIXEL_MASK){if(xor_mask[pixel]==0){rgba[(pixel*bytesPerPixel)]=0x00;rgba[(pixel*bytesPerPixel)+1]=0x00;rgba[(pixel*bytesPerPixel)+2]=0x00;rgba[(pixel*bytesPerPixel)+3]=0x00;}else if((xor_mask[pixel]&PIXEL_MASK)==PIXEL_MASK){rgba[(pixel*bytesPerPixel)]=0x00;rgba[(pixel*bytesPerPixel)+1]=0x00;rgba[(pixel*bytesPerPixel)+2]=0x00;rgba[(pixel*bytesPerPixel)+3]=0xff;}else{rgba[(pixel*bytesPerPixel)]=0x00;rgba[(pixel*bytesPerPixel)+1]=0x00;rgba[(pixel*bytesPerPixel)+2]=0x00;rgba[(pixel*bytesPerPixel)+3]=0xff;}}else{rgba[(pixel*bytesPerPixel)]=0x00;rgba[(pixel*bytesPerPixel)+1]=0x00;rgba[(pixel*bytesPerPixel)+2]=0x00;rgba[(pixel*bytesPerPixel)+3]=0xff;}}}else if(cursor_type==1){if(this._sock.rQwait("VMware cursor alpha encoding",(w*h*4),2)){return false;}
rgba=new Array(w*h*bytesPerPixel);for(let pixel=0;pixel<(w*h);pixel++){let data=this._sock.rQshift32();rgba[(pixel*4)]=data>>24&0xff;rgba[(pixel*4)+1]=data>>16&0xff;rgba[(pixel*4)+2]=data>>8&0xff;rgba[(pixel*4)+3]=data&0xff;}}else{Warn("The given cursor type is not supported: "
+cursor_type+" given.");return false;}
this._updateCursor(rgba,hotx,hoty,w,h);return true;}
_handleCursor(){const hotx=this._FBU.x;const hoty=this._FBU.y;const w=this._FBU.width;const h=this._FBU.height;const pixelslength=w*h*4;const masklength=Math.ceil(w/8)*h;let bytes=pixelslength+masklength;if(this._sock.rQwait("cursor encoding",bytes)){return false;}
const pixels=this._sock.rQshiftBytes(pixelslength);const mask=this._sock.rQshiftBytes(masklength);let rgba=new Uint8Array(w*h*4);let pix_idx=0;for(let y=0;y<h;y++){for(let x=0;x<w;x++){let mask_idx=y*Math.ceil(w/8)+Math.floor(x/8);let alpha=(mask[mask_idx]<<(x%8))&0x80?255:0;rgba[pix_idx]=pixels[pix_idx+2];rgba[pix_idx+1]=pixels[pix_idx+1];rgba[pix_idx+2]=pixels[pix_idx];rgba[pix_idx+3]=alpha;pix_idx+=4;}}
this._updateCursor(rgba,hotx,hoty,w,h);return true;}
_handleDesktopName(){if(this._sock.rQwait("DesktopName",4)){return false;}
let length=this._sock.rQshift32();if(this._sock.rQwait("DesktopName",length,4)){return false;}
let name=this._sock.rQshiftStr(length);name=decodeUTF8(name,true);this._setDesktopName(name);return true;}
_handleExtendedDesktopSize(){if(this._sock.rQwait("ExtendedDesktopSize",4)){return false;}
const number_of_screens=this._sock.rQpeek8();let bytes=4+(number_of_screens*16);if(this._sock.rQwait("ExtendedDesktopSize",bytes)){return false;}
const firstUpdate=!this._supportsSetDesktopSize;this._supportsSetDesktopSize=true;if(firstUpdate){this._requestRemoteResize();}
this._sock.rQskipBytes(1);this._sock.rQskipBytes(3);for(let i=0;i<number_of_screens;i+=1){if(i===0){this._screen_id=this._sock.rQshiftBytes(4);this._sock.rQskipBytes(2);this._sock.rQskipBytes(2);this._sock.rQskipBytes(2);this._sock.rQskipBytes(2);this._screen_flags=this._sock.rQshiftBytes(4);}else{this._sock.rQskipBytes(16);}}
if(this._FBU.x===1&&this._FBU.y!==0){let msg="";switch(this._FBU.y){case 1:msg="Resize is administratively prohibited";break;case 2:msg="Out of resources";break;case 3:msg="Invalid screen layout";break;default:msg="Unknown reason";break;}
Warn("Server did not accept the resize request: "
+msg);}else{this._resize(this._FBU.width,this._FBU.height);}
return true;}
_handleDataRect(){let decoder=this._decoders[this._FBU.encoding];if(!decoder){this._fail("Unsupported encoding (encoding: "+
this._FBU.encoding+")");return false;}
try{return decoder.decodeRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,this._sock,this._display,this._fb_depth);}catch(err){this._fail("Error decoding rect: "+err);return false;}}
_updateContinuousUpdates(){if(!this._enabledContinuousUpdates){return;}
RFB.messages.enableContinuousUpdates(this._sock,true,0,0,this._fb_width,this._fb_height);}
_resize(width,height){this._fb_width=width;this._fb_height=height;this._display.resize(this._fb_width,this._fb_height);this._updateClip();this._updateScale();this._updateContinuousUpdates();}
_xvpOp(ver,op){if(this._rfb_xvp_ver<ver){return;}
Info("Sending XVP operation "+op+" (version "+ver+")");RFB.messages.xvpOp(this._sock,ver,op);}
_updateCursor(rgba,hotx,hoty,w,h){this._cursorImage={rgbaPixels:rgba,hotx:hotx,hoty:hoty,w:w,h:h,};this._refreshCursor();}
_shouldShowDotCursor(){if(!this._showDotCursor){return false;}
for(let i=3;i<this._cursorImage.rgbaPixels.length;i+=4){if(this._cursorImage.rgbaPixels[i]){return false;}}
return true;}
_refreshCursor(){if(this._rfb_connection_state!=="connecting"&&this._rfb_connection_state!=="connected"){return;}
const image=this._shouldShowDotCursor()?RFB.cursors.dot:this._cursorImage;this._cursor.change(image.rgbaPixels,image.hotx,image.hoty,image.w,image.h);}
static genDES(password,challenge){const passwordChars=password.split('').map(c=>c.charCodeAt(0));return(new DES(passwordChars)).encrypt(challenge);}}
RFB.messages={keyEvent(sock,keysym,down){const buff=sock._sQ;const offset=sock._sQlen;buff[offset]=4;buff[offset+1]=down;buff[offset+2]=0;buff[offset+3]=0;buff[offset+4]=(keysym>>24);buff[offset+5]=(keysym>>16);buff[offset+6]=(keysym>>8);buff[offset+7]=keysym;sock._sQlen+=8;sock.flush();},QEMUExtendedKeyEvent(sock,keysym,down,keycode){function getRFBkeycode(xt_scancode){const upperByte=(keycode>>8);const lowerByte=(keycode&0x00ff);if(upperByte===0xe0&&lowerByte<0x7f){return lowerByte|0x80;}
return xt_scancode;}
const buff=sock._sQ;const offset=sock._sQlen;buff[offset]=255;buff[offset+1]=0;buff[offset+2]=(down>>8);buff[offset+3]=down;buff[offset+4]=(keysym>>24);buff[offset+5]=(keysym>>16);buff[offset+6]=(keysym>>8);buff[offset+7]=keysym;const RFBkeycode=getRFBkeycode(keycode);buff[offset+8]=(RFBkeycode>>24);buff[offset+9]=(RFBkeycode>>16);buff[offset+10]=(RFBkeycode>>8);buff[offset+11]=RFBkeycode;sock._sQlen+=12;sock.flush();},pointerEvent(sock,x,y,mask){const buff=sock._sQ;const offset=sock._sQlen;buff[offset]=5;buff[offset+1]=mask;buff[offset+2]=x>>8;buff[offset+3]=x;buff[offset+4]=y>>8;buff[offset+5]=y;sock._sQlen+=6;sock.flush();},_buildExtendedClipboardFlags(actions,formats){let data=new Uint8Array(4);let formatFlag=0x00000000;let actionFlag=0x00000000;for(let i=0;i<actions.length;i++){actionFlag|=actions[i];}
for(let i=0;i<formats.length;i++){formatFlag|=formats[i];}
data[0]=actionFlag>>24;data[1]=0x00;data[2]=0x00;data[3]=formatFlag;return data;},extendedClipboardProvide(sock,formats,inData){let deflator=new Deflator();let dataToDeflate=[];for(let i=0;i<formats.length;i++){if(formats[i]!=extendedClipboardFormatText){throw new Error("Unsupported extended clipboard format for Provide message.");}
inData[i]=inData[i].replace(/\r\n|\r|\n/gm,"\r\n");let text=encodeUTF8(inData[i]+"\0");dataToDeflate.push((text.length>>24)&0xFF,(text.length>>16)&0xFF,(text.length>>8)&0xFF,(text.length&0xFF));for(let j=0;j<text.length;j++){dataToDeflate.push(text.charCodeAt(j));}}
let deflatedData=deflator.deflate(new Uint8Array(dataToDeflate));let data=new Uint8Array(4+deflatedData.length);data.set(RFB.messages._buildExtendedClipboardFlags([extendedClipboardActionProvide],formats));data.set(deflatedData,4);RFB.messages.clientCutText(sock,data,true);},extendedClipboardNotify(sock,formats){let flags=RFB.messages._buildExtendedClipboardFlags([extendedClipboardActionNotify],formats);RFB.messages.clientCutText(sock,flags,true);},extendedClipboardRequest(sock,formats){let flags=RFB.messages._buildExtendedClipboardFlags([extendedClipboardActionRequest],formats);RFB.messages.clientCutText(sock,flags,true);},extendedClipboardCaps(sock,actions,formats){let formatKeys=Object.keys(formats);let data=new Uint8Array(4+(4*formatKeys.length));formatKeys.map(x=>parseInt(x));formatKeys.sort((a,b)=>a-b);data.set(RFB.messages._buildExtendedClipboardFlags(actions,[]));let loopOffset=4;for(let i=0;i<formatKeys.length;i++){data[loopOffset]=formats[formatKeys[i]]>>24;data[loopOffset+1]=formats[formatKeys[i]]>>16;data[loopOffset+2]=formats[formatKeys[i]]>>8;data[loopOffset+3]=formats[formatKeys[i]]>>0;loopOffset+=4;data[3]|=(1<<formatKeys[i]);}
RFB.messages.clientCutText(sock,data,true);},clientCutText(sock,data,extended=false){const buff=sock._sQ;const offset=sock._sQlen;buff[offset]=6;buff[offset+1]=0;buff[offset+2]=0;buff[offset+3]=0;let length;if(extended){length=toUnsigned32bit(-data.length);}else{length=data.length;}
buff[offset+4]=length>>24;buff[offset+5]=length>>16;buff[offset+6]=length>>8;buff[offset+7]=length;sock._sQlen+=8;let dataOffset=0;let remaining=data.length;while(remaining>0){let flushSize=Math.min(remaining,(sock._sQbufferSize-sock._sQlen));for(let i=0;i<flushSize;i++){buff[sock._sQlen+i]=data[dataOffset+i];}
sock._sQlen+=flushSize;sock.flush();remaining-=flushSize;dataOffset+=flushSize;}},setDesktopSize(sock,width,height,id,flags){const buff=sock._sQ;const offset=sock._sQlen;buff[offset]=251;buff[offset+1]=0;buff[offset+2]=width>>8;buff[offset+3]=width;buff[offset+4]=height>>8;buff[offset+5]=height;buff[offset+6]=1;buff[offset+7]=0;buff[offset+8]=id>>24;buff[offset+9]=id>>16;buff[offset+10]=id>>8;buff[offset+11]=id;buff[offset+12]=0;buff[offset+13]=0;buff[offset+14]=0;buff[offset+15]=0;buff[offset+16]=width>>8;buff[offset+17]=width;buff[offset+18]=height>>8;buff[offset+19]=height;buff[offset+20]=flags>>24;buff[offset+21]=flags>>16;buff[offset+22]=flags>>8;buff[offset+23]=flags;sock._sQlen+=24;sock.flush();},clientFence(sock,flags,payload){const buff=sock._sQ;const offset=sock._sQlen;buff[offset]=248;buff[offset+1]=0;buff[offset+2]=0;buff[offset+3]=0;buff[offset+4]=flags>>24;buff[offset+5]=flags>>16;buff[offset+6]=flags>>8;buff[offset+7]=flags;const n=payload.length;buff[offset+8]=n;for(let i=0;i<n;i++){buff[offset+9+i]=payload.charCodeAt(i);}
sock._sQlen+=9+n;sock.flush();},enableContinuousUpdates(sock,enable,x,y,width,height){const buff=sock._sQ;const offset=sock._sQlen;buff[offset]=150;buff[offset+1]=enable;buff[offset+2]=x>>8;buff[offset+3]=x;buff[offset+4]=y>>8;buff[offset+5]=y;buff[offset+6]=width>>8;buff[offset+7]=width;buff[offset+8]=height>>8;buff[offset+9]=height;sock._sQlen+=10;sock.flush();},pixelFormat(sock,depth,true_color){const buff=sock._sQ;const offset=sock._sQlen;let bpp;if(depth>16){bpp=32;}else if(depth>8){bpp=16;}else{bpp=8;}
const bits=Math.floor(depth/3);buff[offset]=0;buff[offset+1]=0;buff[offset+2]=0;buff[offset+3]=0;buff[offset+4]=bpp;buff[offset+5]=depth;buff[offset+6]=0;buff[offset+7]=true_color?1:0;buff[offset+8]=0;buff[offset+9]=(1<<bits)-1;buff[offset+10]=0;buff[offset+11]=(1<<bits)-1;buff[offset+12]=0;buff[offset+13]=(1<<bits)-1;buff[offset+14]=bits*2;buff[offset+15]=bits*1;buff[offset+16]=bits*0;buff[offset+17]=0;buff[offset+18]=0;buff[offset+19]=0;sock._sQlen+=20;sock.flush();},clientEncodings(sock,encodings){const buff=sock._sQ;const offset=sock._sQlen;buff[offset]=2;buff[offset+1]=0;buff[offset+2]=encodings.length>>8;buff[offset+3]=encodings.length;let j=offset+4;for(let i=0;i<encodings.length;i++){const enc=encodings[i];buff[j]=enc>>24;buff[j+1]=enc>>16;buff[j+2]=enc>>8;buff[j+3]=enc;j+=4;}
sock._sQlen+=j-offset;sock.flush();},fbUpdateRequest(sock,incremental,x,y,w,h){const buff=sock._sQ;const offset=sock._sQlen;if(typeof(x)==="undefined"){x=0;}
if(typeof(y)==="undefined"){y=0;}
buff[offset]=3;buff[offset+1]=incremental?1:0;buff[offset+2]=(x>>8)&0xFF;buff[offset+3]=x&0xFF;buff[offset+4]=(y>>8)&0xFF;buff[offset+5]=y&0xFF;buff[offset+6]=(w>>8)&0xFF;buff[offset+7]=w&0xFF;buff[offset+8]=(h>>8)&0xFF;buff[offset+9]=h&0xFF;sock._sQlen+=10;sock.flush();},xvpOp(sock,ver,op){const buff=sock._sQ;const offset=sock._sQlen;buff[offset]=250;buff[offset+1]=0;buff[offset+2]=ver;buff[offset+3]=op;sock._sQlen+=4;sock.flush();}};RFB.cursors={none:{rgbaPixels:new Uint8Array(),w:0,h:0,hotx:0,hoty:0,},dot:{rgbaPixels:new Uint8Array([255,255,255,255,0,0,0,255,255,255,255,255,0,0,0,255,0,0,0,0,0,0,0,255,255,255,255,255,0,0,0,255,255,255,255,255,]),w:3,h:3,hotx:1,hoty:1,}};export default RFB;